(function(ut,p){typeof exports=="object"&&typeof module<"u"?p(exports,require("three"),require("three/examples/jsm/loaders/GLTFLoader.js"),require("three/examples/jsm/loaders/DRACOLoader.js"),require("three/examples/jsm/loaders/KTX2Loader.js")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/loaders/GLTFLoader.js","three/examples/jsm/loaders/DRACOLoader.js","three/examples/jsm/loaders/KTX2Loader.js"],p):(ut=typeof globalThis<"u"?globalThis:ut||self,p(ut.ThreeLoader3DTiles={},ut.THREE,ut.THREE,ut.THREE,ut.THREE))})(this,function(ut,p,Fu,Lu,Du){"use strict";function Ii(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const Oi=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),xi=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);xi&&parseFloat(xi[1]);function Gu(e,t){return vi(e||{},t)}function vi(e,t){const n={...e};for(const[s,r]of Object.entries(t))r&&typeof r=="object"&&!Array.isArray(r)?n[s]=vi(n[s]||{},t[s]):n[s]=t[s];return n}const Fi="latest";function Nu(){var e;return(e=globalThis._loadersgl_)!==null&&e!==void 0&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},typeof __VERSION__>"u"?(console.warn("loaders.gl: The __VERSION__ variable is not injected using babel plugin. Latest unstable workers would be fetched from the CDN."),globalThis._loadersgl_.version=Fi):globalThis._loadersgl_.version=__VERSION__),globalThis._loadersgl_.version}const Pu=Nu();function Kt(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const ne=typeof process!="object"||String(process)!=="[object process]"||process.browser,Uu=typeof window<"u"&&typeof window.orientation<"u",Li=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Li&&parseFloat(Li[1]);let Hu=class{constructor(t,n){this.name=void 0,this.workerThread=void 0,this.isRunning=!0,this.result=void 0,this._resolve=()=>{},this._reject=()=>{},this.name=t,this.workerThread=n,this.result=new Promise((s,r)=>{this._resolve=s,this._reject=r})}postMessage(t,n){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:n})}done(t){Kt(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Kt(this.isRunning),this.isRunning=!1,this._reject(t)}},Rs=class{terminate(){}};const Ss=new Map;function ku(e){Kt(e.source&&!e.url||!e.source&&e.url);let t=Ss.get(e.source||e.url);return t||(e.url&&(t=$u(e.url),Ss.set(e.url,t)),e.source&&(t=Di(e.source),Ss.set(e.source,t))),Kt(t),t}function $u(e){if(!e.startsWith("http"))return e;const t=Vu(e);return Di(t)}function Di(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Vu(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Gi(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const s=n||new Set;if(e){if(Ni(e))s.add(e);else if(Ni(e.buffer))s.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(const r in e)Gi(e[r],t,s)}}return n===void 0?Array.from(s):[]}function Ni(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const Is=()=>{};let Os=class{static isSupported(){return typeof Worker<"u"&&ne||typeof Rs<"u"&&!ne}constructor(t){this.name=void 0,this.source=void 0,this.url=void 0,this.terminated=!1,this.worker=void 0,this.onMessage=void 0,this.onError=void 0,this._loadableURL="";const{name:n,source:s,url:r}=t;Kt(s||r),this.name=n,this.source=s,this.url=r,this.onMessage=Is,this.onError=i=>console.log(i),this.worker=ne?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Is,this.onError=Is,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,n){n=n||Gi(t),this.worker.postMessage(t,n)}_getErrorFromErrorEvent(t){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,t.message&&(n+=`${t.message} in `),t.lineno&&(n+=`:${t.lineno}:${t.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=ku({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},t.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},t.onmessageerror=n=>console.error(n),t}_createNodeWorker(){let t;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new Rs(s,{eval:!1})}else if(this.source)t=new Rs(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",n=>{this.onMessage(n)}),t.on("error",n=>{this.onError(n)}),t.on("exit",n=>{}),t}},Ju=class{static isSupported(){return Os.isSupported()}constructor(t){this.name="unnamed",this.source=void 0,this.url=void 0,this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=()=>{},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(i,o,a)=>i.done(a),s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(i,o)=>i.error(o);const r=new Promise(i=>(this.jobQueue.push({name:t,onMessage:n,onError:s,onStart:i}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:t,backlog:this.jobQueue.length});const s=new Hu(n.name,t);t.onMessage=r=>n.onMessage(s,r.type,r.payload),t.onError=r=>n.onError(s,r),n.onStart(s);try{await s.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!ne||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Os({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Uu?this.maxMobileConcurrency:this.maxConcurrency}};const Wu={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};let xs=class Oe{static isSupported(){return Os.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Oe._workerFarm=Oe._workerFarm||new Oe({}),Oe._workerFarm.setProps(t),Oe._workerFarm}constructor(t){this.props=void 0,this.workerPools=new Map,this.props={...Wu},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:n,source:s,url:r}=t;let i=this.workerPools.get(n);return i||(i=new Ju({name:n,source:s,url:r}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};xs._workerFarm=void 0;function ju(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=t[e.id]||{},s=ne?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=n.workerUrl;if(!r&&e.id==="compression"&&(r=t.workerUrl),t._workerType==="test"&&(ne?r=`modules/${e.module}/dist/${s}`:r=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let i=e.version;i==="latest"&&(i=Fi);const o=i?`@${i}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${s}`}return Kt(r),r}function zu(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pu;Kt(e,"no worker provided");const n=e.version;return!(!t||!n)}const Pi=Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"}));function Ku(e,t){return!xs.isSupported()||!ne&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&(t==null?void 0:t.worker)}async function qu(e,t,n,s,r){const i=e.id,o=ju(e,n),c=xs.getWorkerFarm(n).getWorkerPool({name:i,url:o});n=JSON.parse(JSON.stringify(n)),s=JSON.parse(JSON.stringify(s||{}));const l=await c.startJob("process-on-worker",Xu.bind(null,r));return l.postMessage("process",{input:t,options:n,context:s}),await(await l.result).result}async function Xu(e,t,n,s){switch(n){case"done":t.done(s);break;case"error":t.error(new Error(s.error));break;case"process":const{id:r,input:i,options:o}=s;try{const a=await e(i,o);t.postMessage("done",{id:r,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:r,error:c})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function Qu(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const s=new Uint8Array(e),r=new Uint8Array(t);for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}function Yu(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=t.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),r=s.reduce((a,c)=>a+c.byteLength,0),i=new Uint8Array(r);let o=0;for(const a of s)i.set(a,o),o+=a.byteLength;return i.buffer}async function Zu(e){const t=[];for await(const n of e)t.push(n);return Yu(...t)}let th="";const Ui={};function eh(e){for(const t in Ui)if(e.startsWith(t)){const n=Ui[t];e=e.replace(t,n)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${th}${e}`),e}function ib(e){return e}function nh(e){return e&&typeof e=="object"&&e.isBuffer}function Hi(e){if(nh(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function ki(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function sh(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}const rh=e=>typeof e=="boolean",xe=e=>typeof e=="function",ve=e=>e!==null&&typeof e=="object",$i=e=>ve(e)&&e.constructor==={}.constructor,ih=e=>!!e&&typeof e[Symbol.iterator]=="function",oh=e=>e&&typeof e[Symbol.asyncIterator]=="function",se=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,re=e=>typeof Blob<"u"&&e instanceof Blob,ah=e=>e&&typeof e=="object"&&e.isBuffer,ch=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||ve(e)&&xe(e.tee)&&xe(e.cancel)&&xe(e.getReader),lh=e=>ve(e)&&xe(e.read)&&xe(e.pipe)&&rh(e.readable),Vi=e=>ch(e)||lh(e),uh=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,hh=/^([-\w.]+\/[-\w.+]+)/;function fh(e){const t=hh.exec(e);return t?t[1]:e}function Ji(e){const t=uh.exec(e);return t?t[1]:""}const Wi=/\?.*/;function dh(e){const t=e.match(Wi);return t&&t[0]}function vs(e){return e.replace(Wi,"")}function gn(e){return se(e)?e.url:re(e)?e.name||"":typeof e=="string"?e:""}function Fs(e){if(se(e)){const t=e,n=t.headers.get("content-type")||"",s=vs(t.url);return fh(n)||Ji(s)}return re(e)?e.type||"":typeof e=="string"?Ji(e):""}function mh(e){return se(e)?e.headers["content-length"]||-1:re(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function ji(e){if(se(e))return e;const t={},n=mh(e);n>=0&&(t["content-length"]=String(n));const s=gn(e),r=Fs(e);r&&(t["content-type"]=r);const i=await ph(e);i&&(t["x-first-bytes"]=i),typeof e=="string"&&(e=new TextEncoder().encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:s}),o}async function gh(e){if(!e.ok){const t=await Ah(e);throw new Error(t)}}async function Ah(e){let t=`Failed to fetch resource ${e.url} (${e.status}): `;try{const n=e.headers.get("Content-Type");let s=e.statusText;n!=null&&n.includes("application/json")&&(s+=` ${await e.text()}`),t+=s,t=t.length>60?`${t.slice(0,60)}...`:t}catch{}return t}async function ph(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const n=e.slice(0,5);return await new Promise(s=>{const r=new FileReader;r.onload=i=>{var o;return s(i==null||(o=i.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(n)})}if(e instanceof ArrayBuffer){const n=e.slice(0,5);return`data:base64,${yh(n)}`}return null}function yh(e){let t="";const n=new Uint8Array(e);for(let s=0;s<n.byteLength;s++)t+=String.fromCharCode(n[s]);return btoa(t)}function Bh(e){return!Th(e)&&!Eh(e)}function Th(e){return e.startsWith("http:")||e.startsWith("https:")}function Eh(e){return e.startsWith("data:")}async function Fe(e,t){if(typeof e=="string"){const r=eh(e);if(Bh(r)){var n;if((n=globalThis.loaders)!==null&&n!==void 0&&n.fetchNode){var s;return(s=globalThis.loaders)===null||s===void 0?void 0:s.fetchNode(r,t)}}return await fetch(r,t)}return await ji(e)}function Ch(e){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=e||t;return!!(n&&n.indexOf("Electron")>=0)}function Le(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Ch()}const An=globalThis.window||globalThis.self||globalThis.global,De=globalThis.process||{},zi=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Le();function bh(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch{return null}}let wh=class{constructor(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=bh(s),this.id=t,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let t={};if(this.storage){const n=this.storage.getItem(this.id);t=n?JSON.parse(n):{}}return Object.assign(this.config,t),this}};function _h(e){let t;return e<10?t="".concat(e.toFixed(2),"ms"):e<100?t="".concat(e.toFixed(1),"ms"):e<1e3?t="".concat(e.toFixed(0),"ms"):t="".concat((e/1e3).toFixed(2),"s"),t}function Mh(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}function Ls(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>s&&(n=Math.min(n,s/e.width));const i=e.width*n,o=e.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(i,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let pn;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(pn||(pn={}));const Rh=10;function Ki(e){return typeof e!="string"?e:(e=e.toUpperCase(),pn[e]||pn.WHITE)}function Sh(e,t,n){if(!Le&&typeof e=="string"){if(t){const s=Ki(t);e="\x1B[".concat(s,"m").concat(e,"\x1B[39m")}if(n){const s=Ki(n);e="\x1B[".concat(s+Rh,"m").concat(e,"\x1B[49m")}}return e}function Ih(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(e),s=Object.getOwnPropertyNames(n),r=e;for(const i of s){const o=r[i];typeof o=="function"&&(t.find(a=>i===a)||(r[i]=o.bind(e)))}}function yn(e,t){if(!e)throw new Error(t||"Assertion failed")}function Ae(){let e;if(Le()&&An.performance){var t,n;e=An==null||(t=An.performance)===null||t===void 0||(n=t.now)===null||n===void 0?void 0:n.call(t)}else if("hrtime"in De){var s;const r=De==null||(s=De.hrtime)===null||s===void 0?void 0:s.call(De);e=r[0]*1e3+r[1]/1e6}else e=Date.now();return e}const pe={debug:Le()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Oh={enabled:!0,level:0};function At(){}const qi={},Xi={once:!0};let Bn=class{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=zi,this._startTs=Ae(),this._deltaTs=Ae(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new wh("__probe-".concat(this.id,"__"),Oh),this.timeStamp("".concat(this.id," started")),Ih(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ae()-this._startTs).toPrecision(10))}getDelta(){return Number((Ae()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,n){this._storage.setConfiguration({[t]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,n){yn(t,n)}warn(t){return this._getLogFunction(0,t,pe.warn,arguments,Xi)}error(t){return this._getLogFunction(0,t,pe.error,arguments)}deprecated(t,n){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(t,n){return this.error("`".concat(t,"` has been removed. Use `").concat(n,"` instead"))}probe(t,n){return this._getLogFunction(t,n,pe.log,arguments,{time:!0,once:!0})}log(t,n){return this._getLogFunction(t,n,pe.debug,arguments)}info(t,n){return this._getLogFunction(t,n,console.info,arguments)}once(t,n){return this._getLogFunction(t,n,pe.debug||pe.info,arguments,Xi)}table(t,n,s){return n?this._getLogFunction(t,n,console.table||At,s&&[s],{tag:Lh(n)}):At}image(t){let{logLevel:n,priority:s,image:r,message:i="",scale:o=1}=t;return this._shouldLog(n||s)?Le()?Fh({image:r,message:i,scale:o}):vh():At}time(t,n){return this._getLogFunction(t,n,console.time?console.time:console.info)}timeEnd(t,n){return this._getLogFunction(t,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,n){return this._getLogFunction(t,n,console.timeStamp||At)}group(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=Yi({logLevel:t,message:n,opts:s}),{collapsed:i}=s;return r.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,n,Object.assign({},s,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||At)}withGroup(t,n,s){this.group(t,n)();try{s()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Qi(t)}_getLogFunction(t,n,s,r,i){if(this._shouldLog(t)){i=Yi({logLevel:t,message:n,args:r,opts:i}),s=s||i.method,yn(s),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=Ae();const o=i.tag||i.message;if(i.once&&o)if(!qi[o])qi[o]=Ae();else return At;return n=xh(this.id,i.message,i),s.bind(console,n,...i.args)}return At}};Bn.VERSION=zi;function Qi(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return yn(Number.isFinite(t)&&t>=0),t}function Yi(e){const{logLevel:t,message:n}=e;e.logLevel=Qi(t);const s=e.args?Array.from(e.args):[];for(;s.length&&s.shift()!==n;);switch(typeof t){case"string":case"function":n!==void 0&&s.unshift(n),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return yn(r==="string"||r==="object"),Object.assign(e,{args:s},e.opts)}function xh(e,t,n){if(typeof t=="string"){const s=n.time?Mh(_h(n.total)):"";t=n.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),t=Sh(t,n.color,n.background)}return t}function vh(e){return console.warn("removed"),At}function Fh(e){let{image:t,message:n="",scale:s=1}=e;if(typeof t=="string"){const i=new Image;return i.onload=()=>{const o=Ls(i,n,s);console.log(...o)},i.src=t,At}const r=t.nodeName||"";if(r.toLowerCase()==="img")return console.log(...Ls(t,n,s)),At;if(r.toLowerCase()==="canvas"){const i=new Image;return i.onload=()=>console.log(...Ls(i,n,s)),i.src=t.toDataURL(),At}return At}function Lh(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}const Zi=new Bn({id:"@probe.gl/log"}),to=new Bn({id:"loaders.gl"});let Dh=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},Gh=class{constructor(){this.console=void 0,this.console=console}log(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.log.bind(this.console,...n)}info(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.info.bind(this.console,...n)}warn(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.warn.bind(this.console,...n)}error(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.error.bind(this.console,...n)}};const eo={fetch:null,mimeType:void 0,nothrow:!1,log:new Gh,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Oi,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Nh={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function no(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}function so(){const e=no();return e.globalOptions=e.globalOptions||{...eo},e.globalOptions}function Ph(e,t,n,s){return n=n||[],n=Array.isArray(n)?n:[n],Uh(e,n),kh(t,e,s)}function Uh(e,t){ro(e,null,eo,Nh,t);for(const n of t){const s=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},i=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};ro(s,n.id,r,i,t)}}function ro(e,t,n,s,r){const i=t||"Top level",o=t?`${t}.`:"";for(const a in e){const c=!t&&ve(e[a]),l=a==="baseUri"&&!t,u=a==="workerUrl"&&t;if(!(a in n)&&!l&&!u){if(a in s)to.warn(`${i} loader option '${o}${a}' no longer supported, use '${s[a]}'`)();else if(!c){const h=Hh(a,r);to.warn(`${i} loader option '${o}${a}' not recognized. ${h}`)()}}}}function Hh(e,t){const n=e.toLowerCase();let s="";for(const r of t)for(const i in r.options){if(e===i)return`Did you mean '${r.id}.${i}'?`;const o=i.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(s=s||`Did you mean '${r.id}.${i}'?`)}return s}function kh(e,t,n){const r={...e.options||{}};return $h(r,n),r.log===null&&(r.log=new Dh),io(r,so()),io(r,t),r}function io(e,t){for(const n in t)if(n in t){const s=t[n];$i(s)&&$i(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function $h(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function Ds(e){var t;return e?(Array.isArray(e)&&(e=e[0]),Array.isArray((t=e)===null||t===void 0?void 0:t.extensions)):!1}function oo(e){var t,n;Ii(e,"null loader"),Ii(Ds(e),"invalid loader");let s;return Array.isArray(e)&&(s=e[1],e=e[0],e={...e,options:{...e.options,...s}}),((t=e)!==null&&t!==void 0&&t.parseTextSync||(n=e)!==null&&n!==void 0&&n.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const Vh=()=>{const e=no();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function Jh(){return Vh()}const Wh=new Bn({id:"loaders.gl"}),jh=/\.([^.]+)$/;async function zh(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!co(e))return null;let r=ao(e,t,{...n,nothrow:!0},s);if(r)return r;if(re(e)&&(e=await e.slice(0,10).arrayBuffer(),r=ao(e,t,n,s)),!r&&!(n!=null&&n.nothrow))throw new Error(lo(e));return r}function ao(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!co(e))return null;if(t&&!Array.isArray(t))return oo(t);let r=[];t&&(r=r.concat(t)),n!=null&&n.ignoreRegisteredLoaders||r.push(...Jh()),qh(r);const i=Kh(e,r,n,s);if(!i&&!(n!=null&&n.nothrow))throw new Error(lo(e));return i}function Kh(e,t,n,s){const r=gn(e),i=Fs(e),o=vs(r)||(s==null?void 0:s.url);let a=null,c="";if(n!=null&&n.mimeType&&(a=Gs(t,n==null?void 0:n.mimeType),c=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||Xh(t,o),c=c||(a?`matched url ${o}`:""),a=a||Gs(t,i),c=c||(a?`matched MIME type ${i}`:""),a=a||Yh(t,e),c=c||(a?`matched initial data ${ho(e)}`:""),n!=null&&n.fallbackMimeType&&(a=a||Gs(t,n==null?void 0:n.fallbackMimeType),c=c||(a?`matched fallback MIME type ${i}`:"")),c){var l;Wh.log(1,`selectLoader selected ${(l=a)===null||l===void 0?void 0:l.name}: ${c}.`)}return a}function co(e){return!(e instanceof Response&&e.status===204)}function lo(e){const t=gn(e),n=Fs(e);let s="No valid loader found (";s+=t?`${ki(t)}, `:"no url provided, ",s+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=e?ho(e):"";return s+=r?` first bytes: "${r}"`:"first bytes: not available",s+=")",s}function qh(e){for(const t of e)oo(t)}function Xh(e,t){const n=t&&jh.exec(t),s=n&&n[1];return s?Qh(e,s):null}function Qh(e,t){t=t.toLowerCase();for(const n of e)for(const s of n.extensions)if(s.toLowerCase()===t)return n;return null}function Gs(e,t){for(const n of e)if(n.mimeTypes&&n.mimeTypes.includes(t)||t===`application/x.${n.id}`)return n;return null}function Yh(e,t){if(!t)return null;for(const n of e)if(typeof t=="string"){if(Zh(t,n))return n}else if(ArrayBuffer.isView(t)){if(uo(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer&&uo(t,0,n))return n;return null}function Zh(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>e.startsWith(s))}function uo(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>tf(e,t,n,r))}function tf(e,t,n,s){if(s instanceof ArrayBuffer)return Qu(s,e,s.byteLength);switch(typeof s){case"function":return s(e);case"string":const r=Ns(e,t,s.length);return s===r;default:return!1}}function ho(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?Ns(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Ns(e,0,t):""}function Ns(e,t,n){if(e.byteLength<t+n)return"";const s=new DataView(e);let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(s.getUint8(t+i));return r}const ef=256*1024;function*nf(e,t){const n=(t==null?void 0:t.chunkSize)||ef;let s=0;const r=new TextEncoder;for(;s<e.length;){const i=Math.min(e.length-s,n),o=e.slice(s,s+i);s+=i,yield r.encode(o)}}const sf=256*1024;function rf(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=sf}=t;let s=0;for(;s<e.byteLength;){const r=Math.min(e.byteLength-s,n),i=new ArrayBuffer(r),o=new Uint8Array(e,s,r);new Uint8Array(i).set(o),s+=r,yield i}}()}const of=1024*1024;async function*af(e,t){const n=(t==null?void 0:t.chunkSize)||of;let s=0;for(;s<e.size;){const r=s+n,i=await e.slice(s,r).arrayBuffer();s=r,yield i}}function fo(e,t){return Oi?cf(e,t):lf(e)}async function*cf(e,t){const n=e.getReader();let s;try{for(;;){const r=s||n.read();t!=null&&t._streamReadAhead&&(s=n.read());const{done:i,value:o}=await r;if(i)return;yield Hi(o)}}catch{n.releaseLock()}}async function*lf(e,t){for await(const n of e)yield Hi(n)}function uf(e,t){if(typeof e=="string")return nf(e,t);if(e instanceof ArrayBuffer)return rf(e,t);if(re(e))return af(e,t);if(Vi(e))return fo(e,t);if(se(e))return fo(e.body,t);throw new Error("makeIterator")}const mo="Cannot convert supplied data type";function hf(e,t,n){if(t.text&&typeof e=="string")return e;if(ah(e)&&(e=e.buffer),e instanceof ArrayBuffer){const s=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let s=e.buffer;const r=e.byteLength||e.length;return(e.byteOffset!==0||r!==s.byteLength)&&(s=s.slice(e.byteOffset,e.byteOffset+r)),s}throw new Error(mo)}async function ff(e,t,n){const s=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||s)return hf(e,t);if(re(e)&&(e=await ji(e)),se(e)){const r=e;return await gh(r),t.binary?await r.arrayBuffer():await r.text()}if(Vi(e)&&(e=uf(e,n)),ih(e)||oh(e))return Zu(e);throw new Error(mo)}function go(e,t){const n=so(),s=e||n;return typeof s.fetch=="function"?s.fetch:ve(s.fetch)?r=>Fe(r,s.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:Fe}function df(e,t,n){if(n)return n;const s={fetch:go(t,e),...e};if(s.url){const r=vs(s.url);s.baseUrl=r,s.queryString=dh(s.url),s.filename=ki(r),s.baseUrl=sh(r)}return Array.isArray(s.loaders)||(s.loaders=null),s}function mf(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const s=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...s]:s}return n&&n.length?n:void 0}async function Tn(e,t,n,s){t&&!Array.isArray(t)&&!Ds(t)&&(s=void 0,n=t,t=void 0),e=await e,n=n||{};const r=gn(e),o=mf(t,s),a=await zh(e,o,n);return a?(n=Ph(n,a,o,r),s=df({url:r,_parse:Tn,loaders:o},n,s||null),await gf(a,e,n,s)):null}async function gf(e,t,n,s){if(zu(e),n=Gu(e.options,n),se(t)){const i=t,{ok:o,redirected:a,status:c,statusText:l,type:u,url:h}=i,f=Object.fromEntries(i.headers.entries());s.response={headers:f,ok:o,redirected:a,status:c,statusText:l,type:u,url:h}}t=await ff(t,e,n);const r=e;if(r.parseTextSync&&typeof t=="string")return r.parseTextSync(t,n,s);if(Ku(e,n))return await qu(e,t,n,s,Tn);if(r.parseText&&typeof t=="string")return await r.parseText(t,n,s);if(r.parse)return await r.parse(t,n,s);throw Kt(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}function Af(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function pf(e){let t=1/0,n=1/0,s=1/0,r=-1/0,i=-1/0,o=-1/0;const a=e.POSITION?e.POSITION.value:[],c=a&&a.length;for(let l=0;l<c;l+=3){const u=a[l],h=a[l+1],f=a[l+2];t=u<t?u:t,n=h<n?h:n,s=f<s?f:s,r=u>r?u:r,i=h>i?h:i,o=f>o?f:o}return[[t,n,s],[r,i,o]]}function yf(e,t,n){const s=Af(t.value),r=n||Bf(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:s}]},nullable:!1,metadata:r}}function Bf(e){const t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}async function Ps(e,t,n,s){let r,i;!Array.isArray(t)&&!Ds(t)?(r=[],i=t):(r=t,i=n);const o=go(i);let a=e;return typeof e=="string"&&(a=await o(e)),re(e)&&(a=await o(e)),Array.isArray(r)?await Tn(a,r,i):await Tn(a,r,i)}async function Us(e,t,n,s){return s._parse(e,t,n,s)}function it(e,t){if(!e)throw new Error(t||"loader assertion failed.")}function Tf(e,t,n){const s=n!==void 0?new Uint8Array(e).subarray(t,t+n):new Uint8Array(e).subarray(t);return new Uint8Array(s).buffer}function Ef(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=(e=window.location)===null||e===void 0?void 0:e.pathname;return(t==null?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}function Cf(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function bf(){const e=[];for(let r=0;r<arguments.length;r++)e[r]=r<0||arguments.length<=r?void 0:arguments[r];let t="",n=!1,s;for(let r=e.length-1;r>=-1&&!n;r--){let i;r>=0?i=e[r]:(s===void 0&&(s=Ef()),i=s),i.length!==0&&(t=`${i}/${t}`,n=i.charCodeAt(0)===Ge)}return t=wf(t,!n),n?`/${t}`:t.length>0?t:"."}const Ge=47,Hs=46;function wf(e,t){let n="",s=-1,r=0,i,o=!1;for(let a=0;a<=e.length;++a){if(a<e.length)i=e.charCodeAt(a);else{if(i===Ge)break;i=Ge}if(i===Ge){if(!(s===a-1||r===1))if(s!==a-1&&r===2){if(n.length<2||!o||n.charCodeAt(n.length-1)!==Hs||n.charCodeAt(n.length-2)!==Hs){if(n.length>2){const c=n.length-1;let l=c;for(;l>=0&&n.charCodeAt(l)!==Ge;--l);if(l!==c){n=l===-1?"":n.slice(0,l),s=a,r=0,o=!1;continue}}else if(n.length===2||n.length===1){n="",s=a,r=0,o=!1;continue}}t&&(n.length>0?n+="/..":n="..",o=!0)}else{const c=e.slice(s+1,a);n.length>0?n+=`/${c}`:n=c,o=!1}s=a,r=0}else i===Hs&&r!==-1?++r:r=-1}return n}const _f=1/Math.PI*180,Mf=1/180*Math.PI,Rf={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Rf}};const Y=globalThis.mathgl.config;function Sf(e,{precision:t=Y.precision}={}){return e=Ff(e),"".concat(parseFloat(e.toPrecision(t)))}function ie(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ks(e){return Of(e)}function If(e){return xf(e)}function Of(e,t){return $s(e,n=>n*Mf,t)}function xf(e,t){return $s(e,n=>n*_f,t)}function vf(e,t,n){return $s(e,s=>Math.max(t,Math.min(n,s)))}function qt(e,t,n){const s=Y.EPSILON;n&&(Y.EPSILON=n);try{if(e===t)return!0;if(ie(e)&&ie(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!qt(e[r],t[r]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=Y.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{Y.EPSILON=s}}function Ff(e){return Math.round(e/Y.EPSILON)*Y.EPSILON}function Lf(e){return e.clone?e.clone():new Array(e.length)}function $s(e,t,n){if(ie(e)){const s=e;n=n||Lf(s);for(let r=0;r<n.length&&r<s.length;++r){const i=typeof e=="number"?e:e[r];n[r]=t(i,r,n)}return n}return t(e)}function Df(e){function t(){var n=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}let Vs=class extends Df(Array){clone(){return new this.constructor().copy(this)}fromArray(t,n=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=t[s+n];return this.check()}toArray(t=[],n=0){for(let s=0;s<this.ELEMENTS;++s)t[n+s]=this[s];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:ie(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Y)}formatString(t){let n="";for(let s=0;s<this.ELEMENTS;++s)n+=(s>0?", ":"")+Sf(this[s],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!qt(this[n],t[n]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==t[n])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,n,s){if(s===void 0)return this.lerp(this,t,n);for(let r=0;r<this.ELEMENTS;++r){const i=t[r],o=typeof n=="number"?n:n[r];this[r]=i+s*(o-i)}return this.check()}min(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(t[n],this[n]);return this.check()}max(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(t[n],this[n]);return this.check()}clamp(t,n){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t[s]),n[s]);return this.check()}add(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=n[s];return this.check()}subtract(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=n[s];return this.check()}scale(t){if(typeof t=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;else for(let n=0;n<this.ELEMENTS&&n<t.length;++n)this[n]*=t[n];return this.check()}multiplyByScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}check(){if(Y.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)t=t&&Number.isFinite(this[n]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=t;return this.check()}addScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,n){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t),n);return this.check()}get elements(){return this}};function Gf(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}function k(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(JSON.stringify(e)));return e}function Ne(e,t,n=""){if(Y.debug&&!Gf(e,t))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return e}function J(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}let Js=class extends Vs{get x(){return this[0]}set x(t){this[0]=k(t)}get y(){return this[1]}set y(t){this[1]=k(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*this[n];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let n=0;for(let s=0;s<this.ELEMENTS;++s){const r=this[s]-t[s];n+=r*r}return k(n)}dot(t){let n=0;for(let s=0;s<this.ELEMENTS;++s)n+=this[s]*t[s];return k(n)}normalize(){const t=this.magnitude();if(t!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t;return this.check()}multiply(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=n[s];return this.check()}divide(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=n[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return J(t>=0&&t<this.ELEMENTS,"index is out of range"),k(this[t])}setComponent(t,n){return J(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=n,this.check()}addVectors(t,n){return this.copy(t).add(n)}subVectors(t,n){return this.copy(t).subtract(n)}multiplyVectors(t,n){return this.copy(t).multiply(n)}addScaledVector(t,n){return this.add(new this.constructor(t).multiplyScalar(n))}};const Pe=1e-6;let bt=typeof Float32Array<"u"?Float32Array:Array;function Nf(){const e=new bt(2);return bt!=Float32Array&&(e[0]=0,e[1]=0),e}function Pf(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e}function Uf(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r+n[4],e[1]=n[1]*s+n[3]*r+n[5],e}function Ao(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[3]*r+n[6],e[1]=n[1]*s+n[4]*r+n[7],e}function po(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[4]*r+n[12],e[1]=n[1]*s+n[5]*r+n[13],e}(function(){const e=Nf();return function(t,n,s,r,i,o){let a,c;for(n||(n=2),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],i(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}})();function yo(e,t,n){const s=t[0],r=t[1],i=n[3]*s+n[7]*r||1;return e[0]=(n[0]*s+n[4]*r)/i,e[1]=(n[1]*s+n[5]*r)/i,e}function Bo(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[3]*s+n[7]*r+n[11]*i||1;return e[0]=(n[0]*s+n[4]*r+n[8]*i)/o,e[1]=(n[1]*s+n[5]*r+n[9]*i)/o,e[2]=(n[2]*s+n[6]*r+n[10]*i)/o,e}function Hf(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e[2]=t[2],e}function kf(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e[2]=t[2],e[3]=t[3],e}function To(e,t,n){const s=t[0],r=t[1],i=t[2];return e[0]=n[0]*s+n[3]*r+n[6]*i,e[1]=n[1]*s+n[4]*r+n[7]*i,e[2]=n[2]*s+n[5]*r+n[8]*i,e[3]=t[3],e}class En extends Js{constructor(t=0,n=0){super(2),ie(t)&&arguments.length===1?this.copy(t):(Y.debug&&(k(t),k(n)),this[0]=t,this[1]=n)}set(t,n){return this[0]=t,this[1]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return Y.debug&&(k(t.x),k(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return po(this,this,t),this.check()}transformAsVector(t){return yo(this,this,t),this.check()}transformByMatrix3(t){return Ao(this,this,t),this.check()}transformByMatrix2x3(t){return Uf(this,this,t),this.check()}transformByMatrix2(t){return Pf(this,this,t),this.check()}}function Eo(){const e=new bt(3);return bt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Co(e){const t=e[0],n=e[1],s=e[2];return Math.sqrt(t*t+n*n+s*s)}function bo(e,t,n){const s=new bt(3);return s[0]=e,s[1]=t,s[2]=n,s}function $f(e,t){const n=t[0],s=t[1],r=t[2];let i=n*n+s*s+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Ws(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Cn(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[0],a=n[1],c=n[2];return e[0]=r*c-i*a,e[1]=i*o-s*c,e[2]=s*a-r*o,e}function js(e,t,n){const s=t[0],r=t[1],i=t[2];let o=n[3]*s+n[7]*r+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*s+n[4]*r+n[8]*i+n[12])/o,e[1]=(n[1]*s+n[5]*r+n[9]*i+n[13])/o,e[2]=(n[2]*s+n[6]*r+n[10]*i+n[14])/o,e}function wo(e,t,n){const s=t[0],r=t[1],i=t[2];return e[0]=s*n[0]+r*n[3]+i*n[6],e[1]=s*n[1]+r*n[4]+i*n[7],e[2]=s*n[2]+r*n[5]+i*n[8],e}function _o(e,t,n){const s=n[0],r=n[1],i=n[2],o=n[3],a=t[0],c=t[1],l=t[2];let u=r*l-i*c,h=i*a-s*l,f=s*c-r*a,d=r*f-i*h,m=i*u-s*f,g=s*h-r*u;const A=o*2;return u*=A,h*=A,f*=A,d*=2,m*=2,g*=2,e[0]=a+u+d,e[1]=c+h+m,e[2]=l+f+g,e}function Vf(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[0],i[1]=r[1]*Math.cos(s)-r[2]*Math.sin(s),i[2]=r[1]*Math.sin(s)+r[2]*Math.cos(s),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Jf(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[2]*Math.sin(s)+r[0]*Math.cos(s),i[1]=r[1],i[2]=r[2]*Math.cos(s)-r[0]*Math.sin(s),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Wf(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[0]*Math.cos(s)-r[1]*Math.sin(s),i[1]=r[0]*Math.sin(s)+r[1]*Math.cos(s),i[2]=r[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function jf(e,t){const n=e[0],s=e[1],r=e[2],i=t[0],o=t[1],a=t[2],c=Math.sqrt((n*n+s*s+r*r)*(i*i+o*o+a*a)),l=c&&Ws(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}const zf=Co;(function(){const e=Eo();return function(t,n,s,r,i,o){let a,c;for(n||(n=3),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();const zs=[0,0,0];let bn,w=class Su extends Js{static get ZERO(){return bn||(bn=new Su(0,0,0),Object.freeze(bn)),bn}constructor(t=0,n=0,s=0){super(-0,-0,-0),arguments.length===1&&ie(t)?this.copy(t):(Y.debug&&(k(t),k(n),k(s)),this[0]=t,this[1]=n,this[2]=s)}set(t,n,s){return this[0]=t,this[1]=n,this[2]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Y.debug&&(k(t.x),k(t.y),k(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=k(t)}angle(t){return jf(this,t)}cross(t){return Cn(this,this,t),this.check()}rotateX({radians:t,origin:n=zs}){return Vf(this,this,n,t),this.check()}rotateY({radians:t,origin:n=zs}){return Jf(this,this,n,t),this.check()}rotateZ({radians:t,origin:n=zs}){return Wf(this,this,n,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return js(this,this,t),this.check()}transformAsVector(t){return Bo(this,this,t),this.check()}transformByMatrix3(t){return wo(this,this,t),this.check()}transformByMatrix2(t){return Hf(this,this,t),this.check()}transformByQuaternion(t){return _o(this,this,t),this.check()}},wn,Kf=class Iu extends Js{static get ZERO(){return wn||(wn=new Iu(0,0,0,0),Object.freeze(wn)),wn}constructor(t=0,n=0,s=0,r=0){super(-0,-0,-0,-0),ie(t)&&arguments.length===1?this.copy(t):(Y.debug&&(k(t),k(n),k(s),k(r)),this[0]=t,this[1]=n,this[2]=s,this[3]=r)}set(t,n,s,r){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return Y.debug&&(k(t.x),k(t.y),k(t.z),k(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=k(t)}get w(){return this[3]}set w(t){this[3]=k(t)}transform(t){return js(this,this,t),this.check()}transformByMatrix3(t){return To(this,this,t),this.check()}transformByMatrix2(t){return kf(this,this,t),this.check()}transformByQuaternion(t){return _o(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}},Mo=class extends Vs{toString(){let t="[";if(Y.printRowMajor){t+="row-major:";for(let n=0;n<this.RANK;++n)for(let s=0;s<this.RANK;++s)t+=" ".concat(this[s*this.RANK+n])}else{t+="column-major:";for(let n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+="]",t}getElementIndex(t,n){return n*this.RANK+t}getElement(t,n){return this[n*this.RANK+t]}setElement(t,n,s){return this[n*this.RANK+t]=k(s),this}getColumn(t,n=new Array(this.RANK).fill(-0)){const s=t*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[s+r];return n}setColumn(t,n){const s=t*this.RANK;for(let r=0;r<this.RANK;++r)this[s+r]=n[r];return this}};function qf(){const e=new bt(9);return bt!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Xf(e,t){if(e===t){const n=t[1],s=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=s,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Qf(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=u*o-a*l,f=-u*i+a*c,d=l*i-o*c;let m=n*h+s*f+r*d;return m?(m=1/m,e[0]=h*m,e[1]=(-u*s+r*l)*m,e[2]=(a*s-r*o)*m,e[3]=f*m,e[4]=(u*n-r*c)*m,e[5]=(-a*n+r*i)*m,e[6]=d*m,e[7]=(-l*n+s*c)*m,e[8]=(o*n-s*i)*m,e):null}function Yf(e){const t=e[0],n=e[1],s=e[2],r=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8];return t*(l*i-o*c)+n*(-l*r+o*a)+s*(c*r-i*a)}function Ro(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=n[0],d=n[1],m=n[2],g=n[3],A=n[4],y=n[5],b=n[6],E=n[7],C=n[8];return e[0]=f*s+d*o+m*l,e[1]=f*r+d*a+m*u,e[2]=f*i+d*c+m*h,e[3]=g*s+A*o+y*l,e[4]=g*r+A*a+y*u,e[5]=g*i+A*c+y*h,e[6]=b*s+E*o+C*l,e[7]=b*r+E*a+C*u,e[8]=b*i+E*c+C*h,e}function Zf(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=n[0],d=n[1];return e[0]=s,e[1]=r,e[2]=i,e[3]=o,e[4]=a,e[5]=c,e[6]=f*s+d*o+l,e[7]=f*r+d*a+u,e[8]=f*i+d*c+h,e}function td(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=Math.sin(n),d=Math.cos(n);return e[0]=d*s+f*o,e[1]=d*r+f*a,e[2]=d*i+f*c,e[3]=d*o-f*s,e[4]=d*a-f*r,e[5]=d*c-f*i,e[6]=l,e[7]=u,e[8]=h,e}function So(e,t,n){const s=n[0],r=n[1];return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ed(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n+n,a=s+s,c=r+r,l=n*o,u=s*o,h=s*a,f=r*o,d=r*a,m=r*c,g=i*o,A=i*a,y=i*c;return e[0]=1-h-m,e[3]=u-y,e[6]=f+A,e[1]=u+y,e[4]=1-l-m,e[7]=d-g,e[2]=f-A,e[5]=d+g,e[8]=1-l-h,e}var Ks;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(Ks||(Ks={}));const nd=Object.freeze([1,0,0,0,1,0,0,0,1]);let z=class extends Mo{static get IDENTITY(){return rd()}static get ZERO(){return sd()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Ks}constructor(t,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):n.length>0?this.copy([t,...n]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(nd)}fromObject(t){return this.check()}fromQuaternion(t){return ed(this,t),this.check()}set(t,n,s,r,i,o,a,c,l){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(t,n,s,r,i,o,a,c,l){return this[0]=t,this[1]=r,this[2]=a,this[3]=n,this[4]=i,this[5]=c,this[6]=s,this[7]=o,this[8]=l,this.check()}determinant(){return Yf(this)}transpose(){return Xf(this,this),this.check()}invert(){return Qf(this,this),this.check()}multiplyLeft(t){return Ro(this,t,this),this.check()}multiplyRight(t){return Ro(this,this,t),this.check()}rotate(t){return td(this,this,t),this.check()}scale(t){return Array.isArray(t)?So(this,this,t):So(this,this,[t,t]),this.check()}translate(t){return Zf(this,this,t),this.check()}transform(t,n){let s;switch(t.length){case 2:s=Ao(n||[-0,-0],t,this);break;case 3:s=wo(n||[-0,-0,-0],t,this);break;case 4:s=To(n||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ne(s,t.length),s}transformVector(t,n){return this.transform(t,n)}transformVector2(t,n){return this.transform(t,n)}transformVector3(t,n){return this.transform(t,n)}},_n,Mn=null;function sd(){return _n||(_n=new z([0,0,0,0,0,0,0,0,0]),Object.freeze(_n)),_n}function rd(){return Mn||(Mn=new z,Object.freeze(Mn)),Mn}function id(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function od(e,t){if(e===t){const n=t[1],s=t[2],r=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=i,e[11]=t[14],e[12]=r,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function ad(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=t[9],f=t[10],d=t[11],m=t[12],g=t[13],A=t[14],y=t[15],b=n*a-s*o,E=n*c-r*o,C=n*l-i*o,_=s*c-r*a,B=s*l-i*a,F=r*l-i*c,v=u*g-h*m,O=u*A-f*m,x=u*y-d*m,D=h*A-f*g,N=h*y-d*g,G=f*y-d*A;let S=b*G-E*N+C*D+_*x-B*O+F*v;return S?(S=1/S,e[0]=(a*G-c*N+l*D)*S,e[1]=(r*N-s*G-i*D)*S,e[2]=(g*F-A*B+y*_)*S,e[3]=(f*B-h*F-d*_)*S,e[4]=(c*x-o*G-l*O)*S,e[5]=(n*G-r*x+i*O)*S,e[6]=(A*C-m*F-y*E)*S,e[7]=(u*F-f*C+d*E)*S,e[8]=(o*N-a*x+l*v)*S,e[9]=(s*x-n*N-i*v)*S,e[10]=(m*B-g*C+y*b)*S,e[11]=(h*C-u*B-d*b)*S,e[12]=(a*O-o*D-c*v)*S,e[13]=(n*D-s*O+r*v)*S,e[14]=(g*E-m*_-A*b)*S,e[15]=(u*_-h*E+f*b)*S,e):null}function cd(e){const t=e[0],n=e[1],s=e[2],r=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],f=e[11],d=e[12],m=e[13],g=e[14],A=e[15],y=t*o-n*i,b=t*a-s*i,E=n*a-s*o,C=l*m-u*d,_=l*g-h*d,B=u*g-h*m,F=t*B-n*_+s*C,v=i*B-o*_+a*C,O=l*E-u*b+h*y,x=d*E-m*b+g*y;return c*F-r*v+A*O-f*x}function Io(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=t[9],d=t[10],m=t[11],g=t[12],A=t[13],y=t[14],b=t[15];let E=n[0],C=n[1],_=n[2],B=n[3];return e[0]=E*s+C*a+_*h+B*g,e[1]=E*r+C*c+_*f+B*A,e[2]=E*i+C*l+_*d+B*y,e[3]=E*o+C*u+_*m+B*b,E=n[4],C=n[5],_=n[6],B=n[7],e[4]=E*s+C*a+_*h+B*g,e[5]=E*r+C*c+_*f+B*A,e[6]=E*i+C*l+_*d+B*y,e[7]=E*o+C*u+_*m+B*b,E=n[8],C=n[9],_=n[10],B=n[11],e[8]=E*s+C*a+_*h+B*g,e[9]=E*r+C*c+_*f+B*A,e[10]=E*i+C*l+_*d+B*y,e[11]=E*o+C*u+_*m+B*b,E=n[12],C=n[13],_=n[14],B=n[15],e[12]=E*s+C*a+_*h+B*g,e[13]=E*r+C*c+_*f+B*A,e[14]=E*i+C*l+_*d+B*y,e[15]=E*o+C*u+_*m+B*b,e}function ld(e,t,n){const s=n[0],r=n[1],i=n[2];let o,a,c,l,u,h,f,d,m,g,A,y;return t===e?(e[12]=t[0]*s+t[4]*r+t[8]*i+t[12],e[13]=t[1]*s+t[5]*r+t[9]*i+t[13],e[14]=t[2]*s+t[6]*r+t[10]*i+t[14],e[15]=t[3]*s+t[7]*r+t[11]*i+t[15]):(o=t[0],a=t[1],c=t[2],l=t[3],u=t[4],h=t[5],f=t[6],d=t[7],m=t[8],g=t[9],A=t[10],y=t[11],e[0]=o,e[1]=a,e[2]=c,e[3]=l,e[4]=u,e[5]=h,e[6]=f,e[7]=d,e[8]=m,e[9]=g,e[10]=A,e[11]=y,e[12]=o*s+u*r+m*i+t[12],e[13]=a*s+h*r+g*i+t[13],e[14]=c*s+f*r+A*i+t[14],e[15]=l*s+d*r+y*i+t[15]),e}function ud(e,t,n){const s=n[0],r=n[1],i=n[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function hd(e,t,n,s){let r=s[0],i=s[1],o=s[2],a=Math.sqrt(r*r+i*i+o*o),c,l,u,h,f,d,m,g,A,y,b,E,C,_,B,F,v,O,x,D,N,G,S,j;return a<Pe?null:(a=1/a,r*=a,i*=a,o*=a,l=Math.sin(n),c=Math.cos(n),u=1-c,h=t[0],f=t[1],d=t[2],m=t[3],g=t[4],A=t[5],y=t[6],b=t[7],E=t[8],C=t[9],_=t[10],B=t[11],F=r*r*u+c,v=i*r*u+o*l,O=o*r*u-i*l,x=r*i*u-o*l,D=i*i*u+c,N=o*i*u+r*l,G=r*o*u+i*l,S=i*o*u-r*l,j=o*o*u+c,e[0]=h*F+g*v+E*O,e[1]=f*F+A*v+C*O,e[2]=d*F+y*v+_*O,e[3]=m*F+b*v+B*O,e[4]=h*x+g*D+E*N,e[5]=f*x+A*D+C*N,e[6]=d*x+y*D+_*N,e[7]=m*x+b*D+B*N,e[8]=h*G+g*S+E*j,e[9]=f*G+A*S+C*j,e[10]=d*G+y*S+_*j,e[11]=m*G+b*S+B*j,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function fd(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*r+l*s,e[5]=o*r+u*s,e[6]=a*r+h*s,e[7]=c*r+f*s,e[8]=l*r-i*s,e[9]=u*r-o*s,e[10]=h*r-a*s,e[11]=f*r-c*s,e}function dd(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[0],o=t[1],a=t[2],c=t[3],l=t[8],u=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r-l*s,e[1]=o*r-u*s,e[2]=a*r-h*s,e[3]=c*r-f*s,e[8]=i*s+l*r,e[9]=o*s+u*r,e[10]=a*s+h*r,e[11]=c*s+f*r,e}function md(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[0],o=t[1],a=t[2],c=t[3],l=t[4],u=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r+l*s,e[1]=o*r+u*s,e[2]=a*r+h*s,e[3]=c*r+f*s,e[4]=l*r-i*s,e[5]=u*r-o*s,e[6]=h*r-a*s,e[7]=f*r-c*s,e}function gd(e,t){const n=t[0],s=t[1],r=t[2],i=t[4],o=t[5],a=t[6],c=t[8],l=t[9],u=t[10];return e[0]=Math.sqrt(n*n+s*s+r*r),e[1]=Math.sqrt(i*i+o*o+a*a),e[2]=Math.sqrt(c*c+l*l+u*u),e}function Ad(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n+n,a=s+s,c=r+r,l=n*o,u=s*o,h=s*a,f=r*o,d=r*a,m=r*c,g=i*o,A=i*a,y=i*c;return e[0]=1-h-m,e[1]=u+y,e[2]=f-A,e[3]=0,e[4]=u-y,e[5]=1-l-m,e[6]=d+g,e[7]=0,e[8]=f+A,e[9]=d-g,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pd(e,t,n,s,r,i,o){const a=1/(n-t),c=1/(r-s),l=1/(i-o);return e[0]=i*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i*2*c,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+s)*c,e[10]=(o+i)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*l,e[15]=0,e}function yd(e,t,n,s,r){const i=1/Math.tan(t/2);if(e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0){const o=1/(s-r);e[10]=(r+s)*o,e[14]=2*r*s*o}else e[10]=-1,e[14]=-2*s;return e}const Bd=yd;function Td(e,t,n,s,r,i,o){const a=1/(t-n),c=1/(s-r),l=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*a,e[13]=(r+s)*c,e[14]=(o+i)*l,e[15]=1,e}const Ed=Td;function Cd(e,t,n,s){let r,i,o,a,c,l,u,h,f,d;const m=t[0],g=t[1],A=t[2],y=s[0],b=s[1],E=s[2],C=n[0],_=n[1],B=n[2];return Math.abs(m-C)<Pe&&Math.abs(g-_)<Pe&&Math.abs(A-B)<Pe?id(e):(h=m-C,f=g-_,d=A-B,r=1/Math.sqrt(h*h+f*f+d*d),h*=r,f*=r,d*=r,i=b*d-E*f,o=E*h-y*d,a=y*f-b*h,r=Math.sqrt(i*i+o*o+a*a),r?(r=1/r,i*=r,o*=r,a*=r):(i=0,o=0,a=0),c=f*a-d*o,l=d*i-h*a,u=h*o-f*i,r=Math.sqrt(c*c+l*l+u*u),r?(r=1/r,c*=r,l*=r,u*=r):(c=0,l=0,u=0),e[0]=i,e[1]=c,e[2]=h,e[3]=0,e[4]=o,e[5]=l,e[6]=f,e[7]=0,e[8]=a,e[9]=u,e[10]=d,e[11]=0,e[12]=-(i*m+o*g+a*A),e[13]=-(c*m+l*g+u*A),e[14]=-(h*m+f*g+d*A),e[15]=1,e)}function bd(){const e=new bt(4);return bt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function wd(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function _d(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Md(e){const t=e[0],n=e[1],s=e[2],r=e[3];return Math.sqrt(t*t+n*n+s*s+r*r)}function Rd(e){const t=e[0],n=e[1],s=e[2],r=e[3];return t*t+n*n+s*s+r*r}function Sd(e,t){const n=t[0],s=t[1],r=t[2],i=t[3];let o=n*n+s*s+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=s*o,e[2]=r*o,e[3]=i*o,e}function Id(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Od(e,t,n,s){const r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=r+s*(n[0]-r),e[1]=i+s*(n[1]-i),e[2]=o+s*(n[2]-o),e[3]=a+s*(n[3]-a),e}function xd(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3];return e[0]=n[0]*s+n[4]*r+n[8]*i+n[12]*o,e[1]=n[1]*s+n[5]*r+n[9]*i+n[13]*o,e[2]=n[2]*s+n[6]*r+n[10]*i+n[14]*o,e[3]=n[3]*s+n[7]*r+n[11]*i+n[15]*o,e}function vd(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[0],a=n[1],c=n[2],l=n[3],u=l*s+a*i-c*r,h=l*r+c*s-o*i,f=l*i+o*r-a*s,d=-o*s-a*r-c*i;return e[0]=u*l+d*-o+h*-c-f*-a,e[1]=h*l+d*-a+f*-o-u*-c,e[2]=f*l+d*-c+u*-a-h*-o,e[3]=t[3],e}(function(){const e=bd();return function(t,n,s,r,i,o){let a,c;for(n||(n=4),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();var qs;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(qs||(qs={}));const Fd=45*Math.PI/180,Ld=1,Xs=.1,Qs=500,Dd=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);let pt=class extends Mo{static get IDENTITY(){return Nd()}static get ZERO(){return Gd()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return qs}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,n,s,r,i,o,a,c,l,u,h,f,d,m,g,A){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=u,this[10]=h,this[11]=f,this[12]=d,this[13]=m,this[14]=g,this[15]=A,this.check()}setRowMajor(t,n,s,r,i,o,a,c,l,u,h,f,d,m,g,A){return this[0]=t,this[1]=i,this[2]=l,this[3]=d,this[4]=n,this[5]=o,this[6]=u,this[7]=m,this[8]=s,this[9]=a,this[10]=h,this[11]=g,this[12]=r,this[13]=c,this[14]=f,this[15]=A,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Dd)}fromObject(t){return this.check()}fromQuaternion(t){return Ad(this,t),this.check()}frustum(t){const{left:n,right:s,bottom:r,top:i,near:o=Xs,far:a=Qs}=t;return a===1/0?Pd(this,n,s,r,i,o):pd(this,n,s,r,i,o,a),this.check()}lookAt(t){const{eye:n,center:s=[0,0,0],up:r=[0,1,0]}=t;return Cd(this,n,s,r),this.check()}ortho(t){const{left:n,right:s,bottom:r,top:i,near:o=Xs,far:a=Qs}=t;return Ed(this,n,s,r,i,o,a),this.check()}orthographic(t){const{fovy:n=Fd,aspect:s=Ld,focalDistance:r=1,near:i=Xs,far:o=Qs}=t;Oo(n);const a=n/2,c=r*Math.tan(a),l=c*s;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:i,far:o})}perspective(t){const{fovy:n=45*Math.PI/180,aspect:s=1,near:r=.1,far:i=500}=t;return Oo(n),Bd(this,n,s,r,i),this.check()}determinant(){return cd(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const s=this.getScale(n),r=1/s[0],i=1/s[1],o=1/s[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const s=this.getScale(n),r=1/s[0],i=1/s[1],o=1/s[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*o,t}transpose(){return od(this,this),this.check()}invert(){return ad(this,this),this.check()}multiplyLeft(t){return Io(this,t,this),this.check()}multiplyRight(t){return Io(this,this,t),this.check()}rotateX(t){return fd(this,this,t),this.check()}rotateY(t){return dd(this,this,t),this.check()}rotateZ(t){return md(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,n){return hd(this,this,t,n),this.check()}scale(t){return ud(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return ld(this,this,t),this.check()}transform(t,n){return t.length===4?(n=xd(n||[-0,-0,-0,-0],t,this),Ne(n,4),n):this.transformAsPoint(t,n)}transformAsPoint(t,n){const{length:s}=t;let r;switch(s){case 2:r=po(n||[-0,-0],t,this);break;case 3:r=js(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ne(r,t.length),r}transformAsVector(t,n){let s;switch(t.length){case 2:s=yo(n||[-0,-0],t,this);break;case 3:s=Bo(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ne(s,t.length),s}transformPoint(t,n){return this.transformAsPoint(t,n)}transformVector(t,n){return this.transformAsPoint(t,n)}transformDirection(t,n){return this.transformAsVector(t,n)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,n,s){return this.identity().translate([t,n,s])}},Rn,Sn;function Gd(){return Rn||(Rn=new pt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Rn)),Rn}function Nd(){return Sn||(Sn=new pt,Object.freeze(Sn)),Sn}function Oo(e){if(e>Math.PI*2)throw Error("expected radians")}function Pd(e,t,n,s,r,i){const o=2*i/(n-t),a=2*i/(r-s),c=(n+t)/(n-t),l=(r+s)/(r-s),u=-1,h=-1,f=-2*i;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=c,e[9]=l,e[10]=u,e[11]=h,e[12]=0,e[13]=0,e[14]=f,e[15]=0,e}function xo(){const e=new bt(4);return bt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ud(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function vo(e,t,n){n=n*.5;const s=Math.sin(n);return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=Math.cos(n),e}function Fo(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=n[0],c=n[1],l=n[2],u=n[3];return e[0]=s*u+o*a+r*l-i*c,e[1]=r*u+o*c+i*a-s*l,e[2]=i*u+o*l+s*c-r*a,e[3]=o*u-s*a-r*c-i*l,e}function Hd(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c+o*a,e[1]=r*c+i*a,e[2]=i*c-r*a,e[3]=o*c-s*a,e}function kd(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c-i*a,e[1]=r*c+o*a,e[2]=i*c+s*a,e[3]=o*c-r*a,e}function $d(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c+r*a,e[1]=r*c-s*a,e[2]=i*c+o*a,e[3]=o*c-i*a,e}function Vd(e,t){const n=t[0],s=t[1],r=t[2];return e[0]=n,e[1]=s,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-s*s-r*r)),e}function In(e,t,n,s){const r=t[0],i=t[1],o=t[2],a=t[3];let c=n[0],l=n[1],u=n[2],h=n[3],f,d,m,g,A;return f=r*c+i*l+o*u+a*h,f<0&&(f=-f,c=-c,l=-l,u=-u,h=-h),1-f>Pe?(d=Math.acos(f),A=Math.sin(d),m=Math.sin((1-s)*d)/A,g=Math.sin(s*d)/A):(m=1-s,g=s),e[0]=m*r+g*c,e[1]=m*i+g*l,e[2]=m*o+g*u,e[3]=m*a+g*h,e}function Jd(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n*n+s*s+r*r+i*i,a=o?1/o:0;return e[0]=-n*a,e[1]=-s*a,e[2]=-r*a,e[3]=i*a,e}function Wd(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Lo(e,t){const n=t[0]+t[4]+t[8];let s;if(n>0)s=Math.sqrt(n+1),e[3]=.5*s,s=.5/s,e[0]=(t[5]-t[7])*s,e[1]=(t[6]-t[2])*s,e[2]=(t[1]-t[3])*s;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);const i=(r+1)%3,o=(r+2)%3;s=Math.sqrt(t[r*3+r]-t[i*3+i]-t[o*3+o]+1),e[r]=.5*s,s=.5/s,e[3]=(t[i*3+o]-t[o*3+i])*s,e[i]=(t[i*3+r]+t[r*3+i])*s,e[o]=(t[o*3+r]+t[r*3+o])*s}return e}const jd=wd,zd=_d,Kd=Id,qd=Od,Xd=Md,Qd=Rd,Do=Sd,Yd=function(){const e=Eo(),t=bo(1,0,0),n=bo(0,1,0);return function(s,r,i){const o=Ws(r,i);return o<-.999999?(Cn(e,t,r),zf(e)<1e-6&&Cn(e,n,r),$f(e,e),vo(s,e,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(Cn(e,r,i),s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=1+o,Do(s,s))}}();(function(){const e=xo(),t=xo();return function(n,s,r,i,o,a){return In(e,s,o,a),In(t,r,i,a),In(n,e,t,2*a*(1-a)),n}})(),function(){const e=qf();return function(t,n,s,r){return e[0]=s[0],e[3]=s[1],e[6]=s[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Do(t,Lo(t,e))}}();const Zd=[0,0,0,1];let Ys=class extends Vs{constructor(t=0,n=0,s=0,r=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,n,s,r)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,n,s,r){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return Lo(this,t),this.check()}fromAxisRotation(t,n){return vo(this,t,n),this.check()}identity(){return Ud(this),this.check()}setAxisAngle(t,n){return this.fromAxisRotation(t,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=k(t)}get y(){return this[1]}set y(t){this[1]=k(t)}get z(){return this[2]}set z(t){this[2]=k(t)}get w(){return this[3]}set w(t){this[3]=k(t)}len(){return Xd(this)}lengthSquared(){return Qd(this)}dot(t){return Kd(this,t)}rotationTo(t,n){return Yd(this,t,n),this.check()}add(t){return jd(this,this,t),this.check()}calculateW(){return Vd(this,this),this.check()}conjugate(){return Wd(this,this),this.check()}invert(){return Jd(this,this),this.check()}lerp(t,n,s){return s===void 0?this.lerp(this,t,n):(qd(this,t,n,s),this.check())}multiplyRight(t){return Fo(this,this,t),this.check()}multiplyLeft(t){return Fo(this,t,this),this.check()}normalize(){const t=this.len(),n=t>0?1/t:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,t===0&&(this[3]=1),this.check()}rotateX(t){return Hd(this,this,t),this.check()}rotateY(t){return kd(this,this,t),this.check()}rotateZ(t){return $d(this,this,t),this.check()}scale(t){return zd(this,this,t),this.check()}slerp(t,n,s){let r,i,o;switch(arguments.length){case 1:({start:r=Zd,target:i,ratio:o}=t);break;case 2:r=this,i=t,o=n;break;default:r=t,i=n,o=s}return In(this,r,i,o),this.check()}transformVector4(t,n=new Kf){return vd(n,t,this),Ne(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,n){return this.setAxisAngle(t,n)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}};function Ue(e){"@babel/helpers - typeof";return Ue=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ue(e)}function t0(e,t){if(Ue(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Ue(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function e0(e){var t=t0(e,"string");return Ue(t)=="symbol"?t:String(t)}function L(e,t,n){return t=e0(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const n0=.1,s0=1e-12,Go=1e-15,r0=1e-20,i0=6378137,o0=6378137,a0=6356752314245179e-9;function On(e){return e}new w;function c0(e,t=[],n=On){return"longitude"in e?(t[0]=n(e.longitude),t[1]=n(e.latitude),t[2]=e.height):"x"in e?(t[0]=n(e.x),t[1]=n(e.y),t[2]=e.z):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}function l0(e,t=[]){return c0(e,t,Y._cartographicRadians?On:ks)}function u0(e,t,n=On){return"longitude"in t?(t.longitude=n(e[0]),t.latitude=n(e[1]),t.height=e[2]):"x"in t?(t.x=n(e[0]),t.y=n(e[1]),t.z=e[2]):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}function h0(e,t){return u0(e,t,Y._cartographicRadians?On:If)}const No=1e-14,f0=new w,Po={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Zs={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},He={east:new w,north:new w,up:new w,west:new w,south:new w,down:new w},d0=new w,m0=new w,g0=new w;function Uo(e,t,n,s,r,i){const o=Po[t]&&Po[t][n];J(o&&(!s||s===o));let a,c,l;const u=f0.copy(r);if(qt(u.x,0,No)&&qt(u.y,0,No)){const f=Math.sign(u.z);a=d0.fromArray(Zs[t]),t!=="east"&&t!=="west"&&a.scale(f),c=m0.fromArray(Zs[n]),n!=="east"&&n!=="west"&&c.scale(f),l=g0.fromArray(Zs[s]),s!=="east"&&s!=="west"&&l.scale(f)}else{const{up:f,east:d,north:m}=He;d.set(-u.y,u.x,0).normalize(),e.geodeticSurfaceNormal(u,f),m.copy(f).cross(d);const{down:g,west:A,south:y}=He;g.copy(f).scale(-1),A.copy(d).scale(-1),y.copy(m).scale(-1),a=He[t],c=He[n],l=He[s]}return i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=0,i[4]=c.x,i[5]=c.y,i[6]=c.z,i[7]=0,i[8]=l.x,i[9]=l.y,i[10]=l.z,i[11]=0,i[12]=u.x,i[13]=u.y,i[14]=u.z,i[15]=1,i}const ye=new w,A0=new w,p0=new w;function y0(e,t,n=[]){const{oneOverRadii:s,oneOverRadiiSquared:r,centerToleranceSquared:i}=t;ye.from(e);const o=ye.x,a=ye.y,c=ye.z,l=s.x,u=s.y,h=s.z,f=o*o*l*l,d=a*a*u*u,m=c*c*h*h,g=f+d+m,A=Math.sqrt(1/g);if(!Number.isFinite(A))return;const y=A0;if(y.copy(e).scale(A),g<i)return y.to(n);const b=r.x,E=r.y,C=r.z,_=p0;_.set(y.x*b*2,y.y*E*2,y.z*C*2);let B=(1-A)*ye.len()/(.5*_.len()),F=0,v,O,x,D;do{B-=F,v=1/(1+B*b),O=1/(1+B*E),x=1/(1+B*C);const N=v*v,G=O*O,S=x*x,j=N*v,me=G*O,jt=S*x;D=f*N+d*G+m*S-1;const Ht=-2*(f*j*b+d*me*E+m*jt*C);F=D/Ht}while(Math.abs(D)>s0);return ye.scale([v,O,x]).to(n)}const xn=new w,Ho=new w,B0=new w,wt=new w,T0=new w,vn=new w;let Fn=class{constructor(t=0,n=0,s=0){L(this,"radii",void 0),L(this,"radiiSquared",void 0),L(this,"radiiToTheFourth",void 0),L(this,"oneOverRadii",void 0),L(this,"oneOverRadiiSquared",void 0),L(this,"minimumRadius",void 0),L(this,"maximumRadius",void 0),L(this,"centerToleranceSquared",n0),L(this,"squaredXOverSquaredZ",void 0),J(t>=0),J(n>=0),J(s>=0),this.radii=new w(t,n,s),this.radiiSquared=new w(t*t,n*n,s*s),this.radiiToTheFourth=new w(t*t*t*t,n*n*n*n,s*s*s*s),this.oneOverRadii=new w(t===0?0:1/t,n===0?0:1/n,s===0?0:1/s),this.oneOverRadiiSquared=new w(t===0?0:1/(t*t),n===0?0:1/(n*n),s===0?0:1/(s*s)),this.minimumRadius=Math.min(t,n,s),this.maximumRadius=Math.max(t,n,s),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,n=[0,0,0]){const s=Ho,r=B0,[,,i]=t;this.geodeticSurfaceNormalCartographic(t,s),r.copy(this.radiiSquared).scale(s);const o=Math.sqrt(s.dot(r));return r.scale(1/o),s.scale(i),r.add(s),r.to(n)}cartesianToCartographic(t,n=[0,0,0]){vn.from(t);const s=this.scaleToGeodeticSurface(vn,wt);if(!s)return;const r=this.geodeticSurfaceNormal(s,Ho),i=T0;i.copy(vn).subtract(s);const o=Math.atan2(r.y,r.x),a=Math.asin(r.z),c=Math.sign(Ws(i,vn))*Co(i);return h0([o,a,c],n)}eastNorthUpToFixedFrame(t,n=new pt){return Uo(this,"east","north","up",t,n)}localFrameToFixedFrame(t,n,s,r,i=new pt){return Uo(this,t,n,s,r,i)}geocentricSurfaceNormal(t,n=[0,0,0]){return xn.from(t).normalize().to(n)}geodeticSurfaceNormalCartographic(t,n=[0,0,0]){const s=l0(t),r=s[0],i=s[1],o=Math.cos(i);return xn.set(o*Math.cos(r),o*Math.sin(r),Math.sin(i)).normalize(),xn.to(n)}geodeticSurfaceNormal(t,n=[0,0,0]){return xn.from(t).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(t,n){return y0(t,this,n)}scaleToGeocentricSurface(t,n=[0,0,0]){wt.from(t);const s=wt.x,r=wt.y,i=wt.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(s*s*o.x+r*r*o.y+i*i*o.z);return wt.multiplyScalar(a).to(n)}transformPositionToScaledSpace(t,n=[0,0,0]){return wt.from(t).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(t,n=[0,0,0]){return wt.from(t).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(t,n=0,s=[0,0,0]){J(qt(this.radii.x,this.radii.y,Go)),J(this.radii.z>0),wt.from(t);const r=wt.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-n))return wt.set(0,0,r).to(s)}};L(Fn,"WGS84",new Fn(i0,o0,a0));const ht={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new w,new w;const ke=new w,ko=new w;let E0=class Ou{constructor(t=[0,0,0],n=0){L(this,"center",void 0),L(this,"radius",void 0),this.radius=-0,this.center=new w,this.fromCenterRadius(t,n)}fromCenterRadius(t,n){return this.center.from(t),this.radius=n,this}fromCornerPoints(t,n){return n=ke.from(n),this.center=new w().from(t).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Ou(this.center,this.radius)}union(t){const n=this.center,s=this.radius,r=t.center,i=t.radius,o=ke.copy(r).subtract(n),a=o.magnitude();if(s>=a+i)return this.clone();if(i>=a+s)return t.clone();const c=(s+a+i)*.5;return ko.copy(o).scale((-s+c)/a).add(n),this.center.copy(ko),this.radius=c,this}expand(t){const s=ke.from(t).subtract(this.center).magnitude();return s>this.radius&&(this.radius=s),this}transform(t){this.center.transform(t);const n=gd(ke,t);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(t){const n=this.distanceTo(t);return n*n}distanceTo(t){const s=ke.from(t).subtract(this.center);return Math.max(0,s.len()-this.radius)}intersectPlane(t){const n=this.center,s=this.radius,i=t.normal.dot(n)+t.distance;return i<-s?ht.OUTSIDE:i<s?ht.INTERSECTING:ht.INSIDE}};const C0=new w,b0=new w,Ln=new w,Dn=new w,Gn=new w,w0=new w,_0=new w,kt={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};let M0=class xu{constructor(t=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){L(this,"center",void 0),L(this,"halfAxes",void 0),this.center=new w().from(t),this.halfAxes=new z(n)}get halfSize(){const t=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new w(t).len(),new w(n).len(),new w(s).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),r=new w(t).normalize(),i=new w(n).normalize(),o=new w(s).normalize();return new Ys().fromMatrix3(new z([...r,...i,...o]))}fromCenterHalfSizeQuaternion(t,n,s){const r=new Ys(s),i=new z().fromQuaternion(r);return i[0]=i[0]*n[0],i[1]=i[1]*n[0],i[2]=i[2]*n[0],i[3]=i[3]*n[1],i[4]=i[4]*n[1],i[5]=i[5]*n[1],i[6]=i[6]*n[2],i[7]=i[7]*n[2],i[8]=i[8]*n[2],this.center=new w().from(t),this.halfAxes=i,this}clone(){return new xu(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new E0){const n=this.halfAxes,s=n.getColumn(0,Ln),r=n.getColumn(1,Dn),i=n.getColumn(2,Gn),o=C0.copy(s).add(r).add(i);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const n=this.center,s=t.normal,r=this.halfAxes,i=s.x,o=s.y,a=s.z,c=Math.abs(i*r[kt.COLUMN0ROW0]+o*r[kt.COLUMN0ROW1]+a*r[kt.COLUMN0ROW2])+Math.abs(i*r[kt.COLUMN1ROW0]+o*r[kt.COLUMN1ROW1]+a*r[kt.COLUMN1ROW2])+Math.abs(i*r[kt.COLUMN2ROW0]+o*r[kt.COLUMN2ROW1]+a*r[kt.COLUMN2ROW2]),l=s.dot(n)+t.distance;return l<=-c?ht.OUTSIDE:l>=c?ht.INSIDE:ht.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const n=b0.from(t).subtract(this.center),s=this.halfAxes,r=s.getColumn(0,Ln),i=s.getColumn(1,Dn),o=s.getColumn(2,Gn),a=r.magnitude(),c=i.magnitude(),l=o.magnitude();r.normalize(),i.normalize(),o.normalize();let u=0,h;return h=Math.abs(n.dot(r))-a,h>0&&(u+=h*h),h=Math.abs(n.dot(i))-c,h>0&&(u+=h*h),h=Math.abs(n.dot(o))-l,h>0&&(u+=h*h),u}computePlaneDistances(t,n,s=[-0,-0]){let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,Ln),l=a.getColumn(1,Dn),u=a.getColumn(2,Gn),h=w0.copy(c).add(l).add(u).add(o),f=_0.copy(h).subtract(t);let d=n.dot(f);return r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).add(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).subtract(l).add(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).subtract(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).add(l).add(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).add(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).subtract(l).add(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).subtract(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),s[0]=r,s[1]=i,s}transform(t){this.center.transformAsPoint(t);const n=this.halfAxes.getColumn(0,Ln);n.transformAsPoint(t);const s=this.halfAxes.getColumn(1,Dn);s.transformAsPoint(t);const r=this.halfAxes.getColumn(2,Gn);return r.transformAsPoint(t),this.halfAxes=new z([...n,...s,...r]),this}getTransform(){throw new Error("not implemented")}};const $o=new w,Vo=new w;let Lt=class vu{constructor(t=[0,0,1],n=0){L(this,"normal",void 0),L(this,"distance",void 0),this.normal=new w,this.distance=-0,this.fromNormalDistance(t,n)}fromNormalDistance(t,n){return J(Number.isFinite(n)),this.normal.from(t).normalize(),this.distance=n,this}fromPointNormal(t,n){t=$o.from(t),this.normal.from(n).normalize();const s=-this.normal.dot(t);return this.distance=s,this}fromCoefficients(t,n,s,r){return this.normal.set(t,n,s),J(qt(this.normal.len(),1)),this.distance=r,this}clone(){return new vu(this.normal,this.distance)}equals(t){return qt(this.distance,t.distance)&&qt(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const n=Vo.copy(this.normal).transformAsVector(t).normalize(),s=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(s,n)}projectPointOntoPlane(t,n=[0,0,0]){const s=$o.from(t),r=this.getPointDistance(s),i=Vo.copy(this.normal).scale(r);return s.subtract(i).to(n)}};const Jo=[new w([1,0,0]),new w([0,1,0]),new w([0,0,1])],Wo=new w,R0=new w;let $e=class mn{constructor(t=[]){L(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*Jo.length;const n=t.center,s=t.radius;let r=0;for(const i of Jo){let o=this.planes[r],a=this.planes[r+1];o||(o=this.planes[r]=new Lt),a||(a=this.planes[r+1]=new Lt);const c=Wo.copy(i).scale(-s).add(n);o.fromPointNormal(c,i);const l=Wo.copy(i).scale(s).add(n),u=R0.copy(i).negate();a.fromPointNormal(l,u),r+=2}return this}computeVisibility(t){let n=ht.INSIDE;for(const s of this.planes)switch(t.intersectPlane(s)){case ht.OUTSIDE:return ht.OUTSIDE;case ht.INTERSECTING:n=ht.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(t,n){if(J(Number.isFinite(n),"parentPlaneMask is required."),n===mn.MASK_OUTSIDE||n===mn.MASK_INSIDE)return n;let s=mn.MASK_INSIDE;const r=this.planes;for(let i=0;i<this.planes.length;++i){const o=i<31?1<<i:0;if(i<31&&!(n&o))continue;const a=r[i],c=t.intersectPlane(a);if(c===ht.OUTSIDE)return mn.MASK_OUTSIDE;c===ht.INTERSECTING&&(s|=o)}return s}};L($e,"MASK_OUTSIDE",4294967295),L($e,"MASK_INSIDE",0),L($e,"MASK_INDETERMINATE",2147483647);const S0=new w,I0=new w,O0=new w,x0=new w,v0=new w;class Nn{constructor(t={}){L(this,"left",void 0),L(this,"_left",void 0),L(this,"right",void 0),L(this,"_right",void 0),L(this,"top",void 0),L(this,"_top",void 0),L(this,"bottom",void 0),L(this,"_bottom",void 0),L(this,"near",void 0),L(this,"_near",void 0),L(this,"far",void 0),L(this,"_far",void 0),L(this,"_cullingVolume",new $e([new Lt,new Lt,new Lt,new Lt,new Lt,new Lt])),L(this,"_perspectiveMatrix",new pt),L(this,"_infinitePerspective",new pt);const{near:n=1,far:s=5e8}=t;this.left=t.left,this._left=void 0,this.right=t.right,this._right=void 0,this.top=t.top,this._top=void 0,this.bottom=t.bottom,this._bottom=void 0,this.near=n,this._near=n,this.far=s,this._far=s}clone(){return new Nn({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}equals(t){return t&&t instanceof Nn&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far}get projectionMatrix(){return this._update(),this._perspectiveMatrix}get infiniteProjectionMatrix(){return this._update(),this._infinitePerspective}computeCullingVolume(t,n,s){J(t,"position is required."),J(n,"direction is required."),J(s,"up is required.");const r=this._cullingVolume.planes;s=S0.copy(s).normalize();const i=I0.copy(n).cross(s).normalize(),o=O0.copy(n).multiplyByScalar(this.near).add(t),a=x0.copy(n).multiplyByScalar(this.far).add(t);let c=v0;return c.copy(i).multiplyByScalar(this.left).add(o).subtract(t).cross(s),r[0].fromPointNormal(t,c),c.copy(i).multiplyByScalar(this.right).add(o).subtract(t).cross(s).negate(),r[1].fromPointNormal(t,c),c.copy(s).multiplyByScalar(this.bottom).add(o).subtract(t).cross(i).negate(),r[2].fromPointNormal(t,c),c.copy(s).multiplyByScalar(this.top).add(o).subtract(t).cross(i),r[3].fromPointNormal(t,c),c=new w().copy(n),r[4].fromPointNormal(o,c),c.negate(),r[5].fromPointNormal(a,c),this._cullingVolume}getPixelDimensions(t,n,s,r){this._update(),J(Number.isFinite(t)&&Number.isFinite(n)),J(t>0),J(n>0),J(s>0),J(r);const i=1/this.near;let o=this.top*i;const a=2*s*o/n;o=this.right*i;const c=2*s*o/t;return r.x=c,r.y=a,r}_update(){J(Number.isFinite(this.right)&&Number.isFinite(this.left)&&Number.isFinite(this.top)&&Number.isFinite(this.bottom)&&Number.isFinite(this.near)&&Number.isFinite(this.far));const{top:t,bottom:n,right:s,left:r,near:i,far:o}=this;(t!==this._top||n!==this._bottom||r!==this._left||s!==this._right||i!==this._near||o!==this._far)&&(J(this.near>0&&this.near<this.far,"near must be greater than zero and less than far."),this._left=r,this._right=s,this._top=t,this._bottom=n,this._near=i,this._far=o,this._perspectiveMatrix=new pt().frustum({left:r,right:s,bottom:n,top:t,near:i,far:o}),this._infinitePerspective=new pt().frustum({left:r,right:s,bottom:n,top:t,near:i,far:1/0}))}}const F0=e=>e!==null&&typeof e<"u";class Pn{constructor(t={}){L(this,"_offCenterFrustum",new Nn),L(this,"fov",void 0),L(this,"_fov",void 0),L(this,"_fovy",void 0),L(this,"_sseDenominator",void 0),L(this,"aspectRatio",void 0),L(this,"_aspectRatio",void 0),L(this,"near",void 0),L(this,"_near",void 0),L(this,"far",void 0),L(this,"_far",void 0),L(this,"xOffset",void 0),L(this,"_xOffset",void 0),L(this,"yOffset",void 0),L(this,"_yOffset",void 0);const{fov:n,aspectRatio:s,near:r=1,far:i=5e8,xOffset:o=0,yOffset:a=0}=t;this.fov=n,this.aspectRatio=s,this.near=r,this.far=i,this.xOffset=o,this.yOffset=a}clone(){return new Pn({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}equals(t){return!F0(t)||!(t instanceof Pn)?!1:(this._update(),t._update(),this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this.near===t.near&&this.far===t.far&&this._offCenterFrustum.equals(t._offCenterFrustum))}get projectionMatrix(){return this._update(),this._offCenterFrustum.projectionMatrix}get infiniteProjectionMatrix(){return this._update(),this._offCenterFrustum.infiniteProjectionMatrix}get fovy(){return this._update(),this._fovy}get sseDenominator(){return this._update(),this._sseDenominator}computeCullingVolume(t,n,s){return this._update(),this._offCenterFrustum.computeCullingVolume(t,n,s)}getPixelDimensions(t,n,s,r){return this._update(),this._offCenterFrustum.getPixelDimensions(t,n,s,r||new En)}_update(){J(Number.isFinite(this.fov)&&Number.isFinite(this.aspectRatio)&&Number.isFinite(this.near)&&Number.isFinite(this.far));const t=this._offCenterFrustum;(this.fov!==this._fov||this.aspectRatio!==this._aspectRatio||this.near!==this._near||this.far!==this._far||this.xOffset!==this._xOffset||this.yOffset!==this._yOffset)&&(J(this.fov>=0&&this.fov<Math.PI),J(this.aspectRatio>0),J(this.near>=0&&this.near<this.far),this._aspectRatio=this.aspectRatio,this._fov=this.fov,this._fovy=this.aspectRatio<=1?this.fov:Math.atan(Math.tan(this.fov*.5)/this.aspectRatio)*2,this._near=this.near,this._far=this.far,this._sseDenominator=2*Math.tan(.5*this._fovy),this._xOffset=this.xOffset,this._yOffset=this.yOffset,t.top=this.near*Math.tan(.5*this._fovy),t.bottom=-t.top,t.right=this.aspectRatio*t.top,t.left=-t.right,t.near=this.near,t.far=this.far,t.right+=this.xOffset,t.left+=this.xOffset,t.top+=this.yOffset,t.bottom+=this.yOffset)}}new w,new w,new w,new w,new w,new w,new w,new w,new w,new w,new w,new w;const Dt=new z,L0=new z,D0=new z,Un=new z,jo=new z;function G0(e,t={}){const n=r0,s=10;let r=0,i=0;const o=L0,a=D0;o.identity(),a.copy(e);const c=n*N0(a);for(;i<s&&P0(a)>c;)U0(a,Un),jo.copy(Un).transpose(),a.multiplyRight(Un),a.multiplyLeft(jo),o.multiplyRight(Un),++r>2&&(++i,r=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=a.toTarget(t.diagonal),t}function N0(e){let t=0;for(let n=0;n<9;++n){const s=e[n];t+=s*s}return Math.sqrt(t)}const tr=[1,0,0],er=[2,2,1];function P0(e){let t=0;for(let n=0;n<3;++n){const s=e[Dt.getElementIndex(er[n],tr[n])];t+=2*s*s}return Math.sqrt(t)}function U0(e,t){const n=Go;let s=0,r=1;for(let l=0;l<3;++l){const u=Math.abs(e[Dt.getElementIndex(er[l],tr[l])]);u>s&&(r=l,s=u)}const i=tr[r],o=er[r];let a=1,c=0;if(Math.abs(e[Dt.getElementIndex(o,i)])>n){const l=e[Dt.getElementIndex(o,o)],u=e[Dt.getElementIndex(i,i)],h=e[Dt.getElementIndex(o,i)],f=(l-u)/2/h;let d;f<0?d=-1/(-f+Math.sqrt(1+f*f)):d=1/(f+Math.sqrt(1+f*f)),a=1/Math.sqrt(1+d*d),c=d*a}return z.IDENTITY.to(t),t[Dt.getElementIndex(i,i)]=t[Dt.getElementIndex(o,o)]=a,t[Dt.getElementIndex(o,i)]=c,t[Dt.getElementIndex(i,o)]=-c,t}const Xt=new w,H0=new w,k0=new w,$0=new w,V0=new w,J0=new z,W0={diagonal:new z,unitary:new z};function j0(e,t=new M0){if(!e||e.length===0)return t.halfAxes=new z([0,0,0,0,0,0,0,0,0]),t.center=new w,t;const n=e.length,s=new w(0,0,0);for(const O of e)s.add(O);const r=1/n;s.multiplyByScalar(r);let i=0,o=0,a=0,c=0,l=0,u=0;for(const O of e){const x=Xt.copy(O).subtract(s);i+=x.x*x.x,o+=x.x*x.y,a+=x.x*x.z,c+=x.y*x.y,l+=x.y*x.z,u+=x.z*x.z}i*=r,o*=r,a*=r,c*=r,l*=r,u*=r;const h=J0;h[0]=i,h[1]=o,h[2]=a,h[3]=o,h[4]=c,h[5]=l,h[6]=a,h[7]=l,h[8]=u;const{unitary:f}=G0(h,W0),d=t.halfAxes.copy(f);let m=d.getColumn(0,k0),g=d.getColumn(1,$0),A=d.getColumn(2,V0),y=-Number.MAX_VALUE,b=-Number.MAX_VALUE,E=-Number.MAX_VALUE,C=Number.MAX_VALUE,_=Number.MAX_VALUE,B=Number.MAX_VALUE;for(const O of e)Xt.copy(O),y=Math.max(Xt.dot(m),y),b=Math.max(Xt.dot(g),b),E=Math.max(Xt.dot(A),E),C=Math.min(Xt.dot(m),C),_=Math.min(Xt.dot(g),_),B=Math.min(Xt.dot(A),B);m=m.multiplyByScalar(.5*(C+y)),g=g.multiplyByScalar(.5*(_+b)),A=A.multiplyByScalar(.5*(B+E)),t.center.copy(m).add(g).add(A);const F=H0.set(y-C,b-_,E-B).multiplyByScalar(.5),v=new z([F[0],0,0,0,F[1],0,0,0,F[2]]);return t.halfAxes.multiplyRight(v),t}let zo=function(e){return e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE",e}({}),Hn=function(e){return e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh",e}({}),z0=function(e){return e.I3S="I3S",e.TILES3D="TILES3D",e}({}),kn=function(e){return e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold",e}({});const Ko="4.1.0-alpha.5",Ve={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function qo(e,t,n){it(e instanceof ArrayBuffer);const s=new TextDecoder("utf8"),r=new Uint8Array(e,t,n);return s.decode(r)}function K0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=new DataView(e);return`${String.fromCharCode(n.getUint8(t+0))}${String.fromCharCode(n.getUint8(t+1))}${String.fromCharCode(n.getUint8(t+2))}${String.fromCharCode(n.getUint8(t+3))}`}const q0={name:"Draco",id:"draco",module:"draco",version:"4.1.0-alpha.5",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function X0(e,t,n){const s=Qo(t.metadata),r=[],i=Q0(t.attributes);for(const o in e){const a=e[o],c=Xo(o,a,i[o]);r.push(c)}if(n){const o=Xo("indices",n);r.push(o)}return{fields:r,metadata:s}}function Q0(e){const t={};for(const n in e){const s=e[n];t[s.name||"undefined"]=s}return t}function Xo(e,t,n){const s=n?Qo(n.metadata):void 0;return yf(e,t,s)}function Qo(e){Object.entries(e);const t={};for(const n in e)t[`${n}.string`]=JSON.stringify(e[n]);return t}const Yo={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Y0={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Z0=4;class tm{constructor(t){this.draco=void 0,this.decoder=void 0,this.metadataQuerier=void 0,this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(n);const r=this.decoder.GetEncodedGeometryType(s),i=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(s,i);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(s,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!i.ptr){const f=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(f)}const a=this._getDracoLoaderData(i,r,n),c=this._getMeshData(i,a,n),l=pf(c.attributes),u=X0(c.attributes,a,c.indices);return{loader:"draco",loaderData:a,header:{vertexCount:i.num_points(),boundingBox:l},...c,schema:u}}finally{this.draco.destroy(s),i&&this.draco.destroy(i)}}_getDracoLoaderData(t,n,s){const r=this._getTopLevelMetadata(t),i=this._getDracoAttributes(t,s);return{geometry_type:n,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:r,attributes:i}}_getDracoAttributes(t,n){const s={};for(let r=0;r<t.num_attributes();r++){const i=this.decoder.GetAttribute(t,r),o=this._getAttributeMetadata(t,r);s[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:r,metadata:o};const a=this._getQuantizationTransform(i,n);a&&(s[i.unique_id()].quantization_transform=a);const c=this._getOctahedronTransform(i,n);c&&(s[i.unique_id()].octahedron_transform=c)}return s}_getMeshData(t,n,s){const r=this._getMeshAttributes(n,t,s);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(s.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(t,n,s){const r={};for(const i of Object.values(t.attributes)){const o=this._deduceAttributeName(i,s);i.name=o;const{value:a,size:c}=this._getAttributeValues(n,i);r[o]={value:a,size:c,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}return r}_getTriangleListIndices(t){const s=t.num_faces()*3,r=s*Z0,i=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,i),new Uint32Array(this.draco.HEAPF32.buffer,i,s).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(t){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,n),sm(n)}finally{this.draco.destroy(n)}}_getAttributeValues(t,n){const s=Y0[n.data_type],r=n.num_components,o=t.num_points()*r,a=o*s.BYTES_PER_ELEMENT,c=em(this.draco,s);let l;const u=this.draco._malloc(a);try{const h=this.decoder.GetAttribute(t,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,h,c,a,u),l=new s(this.draco.HEAPF32.buffer,u,o).slice()}finally{this.draco._free(u)}return{value:l,size:r}}_deduceAttributeName(t,n){const s=t.unique_id;for(const[o,a]of Object.entries(n.extraAttributes||{}))if(a===s)return o;const r=t.attribute_type;for(const o in Yo)if(this.draco[o]===r)return Yo[o];const i=n.attributeNameEntry||"name";return t.metadata[i]?t.metadata[i].string:`CUSTOM_ATTRIBUTE_${s}`}_getTopLevelMetadata(t){const n=this.decoder.GetMetadata(t);return this._getDracoMetadata(n)}_getAttributeMetadata(t,n){const s=this.decoder.GetAttributeMetadata(t,n);return this._getDracoMetadata(s)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const n={},s=this.metadataQuerier.NumEntries(t);for(let r=0;r<s;r++){const i=this.metadataQuerier.GetEntryName(t,r);n[i]=this._getDracoMetadataField(t,i)}return n}_getDracoMetadataField(t,n){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,n,s);const r=nm(s);return{int:this.metadataQuerier.GetIntEntry(t,n),string:this.metadataQuerier.GetStringEntry(t,n),double:this.metadataQuerier.GetDoubleEntry(t,n),intArray:r}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(t){const{quantizedAttributes:n=[],octahedronAttributes:s=[]}=t,r=[...n,...s];for(const i of r)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(t,n){const{quantizedAttributes:s=[]}=n,r=t.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(t,n){const{octahedronAttributes:s=[]}=n,r=t.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function em(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function nm(e){const t=e.size(),n=new Int32Array(t);for(let s=0;s<t;s++)n[s]=e.GetValue(s);return n}function sm(e){const t=e.size(),n=new Int32Array(t);for(let s=0;s<t;s++)n[s]=e.GetValue(s);return n}function rm(){var e;return(e=globalThis._loadersgl_)!==null&&e!==void 0&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.1.0-alpha.5"),globalThis._loadersgl_.version}const im=rm();function om(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Je=typeof process!="object"||String(process)!=="[object process]"||process.browser,nr=typeof importScripts=="function",Zo=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Zo&&parseFloat(Zo[1]);const sr={};async function rr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return t&&(e=am(e,t,n,s)),sr[e]=sr[e]||cm(e),await sr[e]}function am(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!n.useLocalLibraries&&e.startsWith("http"))return e;s=s||e;const r=n.modules||{};return r[s]?r[s]:Je?n.CDN?(om(n.CDN.startsWith("http")),`${n.CDN}/${t}@${im}/dist/libs/${s}`):nr?`../src/libs/${s}`:`modules/${t}/src/libs/${s}`:`modules/${t}/dist/libs/${s}`}async function cm(e){if(e.endsWith("wasm"))return await um(e);if(!Je)try{return Pi&&void 0}catch(n){return console.error(n),null}if(nr)return importScripts(e);const t=await hm(e);return lm(t,e)}function lm(e,t){if(!Je)return;if(nr)return eval.call(globalThis,e),null;const n=document.createElement("script");n.id=t;try{n.appendChild(document.createTextNode(e))}catch{n.text=e}return document.body.appendChild(n),null}async function um(e){return await(await fetch(e)).arrayBuffer()}async function hm(e){return await(await fetch(e)).text()}const fm="1.5.6",dm="1.4.1",ir=`https://www.gstatic.com/draco/versioned/decoders/${fm}`,ot={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},or={[ot.DECODER]:`${ir}/${ot.DECODER}`,[ot.DECODER_WASM]:`${ir}/${ot.DECODER_WASM}`,[ot.FALLBACK_DECODER]:`${ir}/${ot.FALLBACK_DECODER}`,[ot.ENCODER]:`https://raw.githubusercontent.com/google/draco/${dm}/javascript/${ot.ENCODER}`};let We;async function mm(e){const t=e.modules||{};return t.draco3d?We=We||t.draco3d.createDecoderModule({}).then(n=>({draco:n})):We=We||gm(e),await We}async function gm(e){let t,n;switch(e.draco&&e.draco.decoderType){case"js":t=await rr(or[ot.FALLBACK_DECODER],"draco",e,ot.FALLBACK_DECODER);break;case"wasm":default:[t,n]=await Promise.all([await rr(or[ot.DECODER],"draco",e,ot.DECODER),await rr(or[ot.DECODER_WASM],"draco",e,ot.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await Am(t,n)}function Am(e,t){const n={};return t&&(n.wasmBinary=t),new Promise(s=>{e({...n,onModuleLoaded:r=>s({draco:r})})})}const ta={...q0,parse:pm};async function pm(e,t){const{draco:n}=await mm(t),s=new tm(n);try{return s.parseSync(e,t==null?void 0:t.draco)}finally{s.destroy()}}const ym={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},q={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},U={...ym,...q},ar={[q.DOUBLE]:Float64Array,[q.FLOAT]:Float32Array,[q.UNSIGNED_SHORT]:Uint16Array,[q.UNSIGNED_INT]:Uint32Array,[q.UNSIGNED_BYTE]:Uint8Array,[q.BYTE]:Int8Array,[q.SHORT]:Int16Array,[q.INT]:Int32Array},Bm={DOUBLE:q.DOUBLE,FLOAT:q.FLOAT,UNSIGNED_SHORT:q.UNSIGNED_SHORT,UNSIGNED_INT:q.UNSIGNED_INT,UNSIGNED_BYTE:q.UNSIGNED_BYTE,BYTE:q.BYTE,SHORT:q.SHORT,INT:q.INT},cr="Failed to convert GL type";class Gt{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const n in ar)if(ar[n]===t)return n;throw new Error(cr)}static fromName(t){const n=Bm[t];if(!n)throw new Error(cr);return n}static getArrayType(t){switch(t){case q.UNSIGNED_SHORT_5_6_5:case q.UNSIGNED_SHORT_4_4_4_4:case q.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=ar[t];if(!n)throw new Error(cr);return n}}static getByteSize(t){return Gt.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!Gt.getArrayType(t)}static createTypedArray(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;r===void 0&&(r=(n.byteLength-s)/Gt.getByteSize(t));const i=Gt.getArrayType(t);return new i(n,s,r)}}function Tm(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}function Em(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=e>>11&31,s=e>>5&63,r=e&31;return t[0]=n<<3,t[1]=s<<2,t[2]=r<<3,t}new En,new w,new En,new En;function ea(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return vf(e,0,t)/t*2-1}function na(e){return e<0?-1:1}function Cm(e,t,n,s){if(Tm(s),e<0||e>n||t<0||t>n)throw new Error(`x and y must be unsigned normalized integers between 0 and ${n}`);if(s.x=ea(e,n),s.y=ea(t,n),s.z=1-(Math.abs(s.x)+Math.abs(s.y)),s.z<0){const r=s.x;s.x=(1-Math.abs(s.y))*na(r),s.y=(1-Math.abs(r))*na(s.y)}return s.normalize()}function bm(e,t,n){return Cm(e,t,255,n)}class lr{constructor(t,n){this.json=void 0,this.buffer=void 0,this.featuresLength=0,this._cachedTypedArrays={},this.json=t,this.buffer=n}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:U.UNSIGNED_INT,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(t,n,s,1,r.byteOffset):r}getPropertyArray(t,n,s){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(n=Gt.fromName(r.componentType)),this._getTypedArrayFromBinary(t,n,s,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(t,n,r)}getProperty(t,n,s,r,i){const o=this.json[t];if(!o)return o;const a=this.getPropertyArray(t,n,s);if(s===1)return a[r];for(let c=0;c<s;++c)i[c]=a[s*r+c];return i}_getTypedArrayFromBinary(t,n,s,r,i){const o=this._cachedTypedArrays;let a=o[t];return a||(a=Gt.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+i,r*s),o[t]=a),a}_getTypedArrayFromArray(t,n,s){const r=this._cachedTypedArrays;let i=r[t];return i||(i=Gt.createTypedArray(n,s),r[t]=i),i}}const wm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_m={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},Mm={SCALAR:(e,t,n)=>{t[n]=e},VEC2:(e,t,n)=>{t[2*n+0]=e[0],t[2*n+1]=e[1]},VEC3:(e,t,n)=>{t[3*n+0]=e[0],t[3*n+1]=e[1],t[3*n+2]=e[2]},VEC4:(e,t,n)=>{t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT2:(e,t,n)=>{t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT3:(e,t,n)=>{t[9*n+0]=e[0],t[9*n+1]=e[1],t[9*n+2]=e[2],t[9*n+3]=e[3],t[9*n+4]=e[4],t[9*n+5]=e[5],t[9*n+6]=e[6],t[9*n+7]=e[7],t[9*n+8]=e[8],t[9*n+9]=e[9]},MAT4:(e,t,n)=>{t[16*n+0]=e[0],t[16*n+1]=e[1],t[16*n+2]=e[2],t[16*n+3]=e[3],t[16*n+4]=e[4],t[16*n+5]=e[5],t[16*n+6]=e[6],t[16*n+7]=e[7],t[16*n+8]=e[8],t[16*n+9]=e[9],t[16*n+10]=e[10],t[16*n+11]=e[11],t[16*n+12]=e[12],t[16*n+13]=e[13],t[16*n+14]=e[14],t[16*n+15]=e[15]}};function Rm(e,t,n,s){const{componentType:r}=e;it(e.componentType);const i=typeof r=="string"?Gt.fromName(r):r,o=wm[e.type],a=_m[e.type],c=Mm[e.type];return n+=e.byteOffset,{values:Gt.createTypedArray(i,t,n,o*s),type:i,size:o,unpacker:a,packer:c}}const Nt=e=>e!==void 0;function Sm(e,t,n){if(!t)return null;let s=e.getExtension("3DTILES_batch_table_hierarchy");const r=t.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=r,s=r),s?Im(s,n):null}function Im(e,t){let n,s,r;const i=e.instancesLength,o=e.classes;let a=e.classIds,c=e.parentCounts,l=e.parentIds,u=i;Nt(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,r=getBinaryAccessor(a),a=r.createArrayBufferView(t.buffer,t.byteOffset+a.byteOffset,i));let h;if(Nt(c))for(Nt(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,r=getBinaryAccessor(c),c=r.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,i)),h=new Uint16Array(i),u=0,n=0;n<i;++n)h[n]=u,u+=c[n];Nt(l)&&Nt(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,u));const f=o.length;for(n=0;n<f;++n){const A=o[n].length,y=o[n].instances,b=getBinaryProperties(A,y,t);o[n].instances=combine(b,y)}const d=new Array(f).fill(0),m=new Uint16Array(i);for(n=0;n<i;++n)s=a[n],m[n]=d[s],++d[s];const g={classes:o,classIds:a,classIndexes:m,parentCounts:c,parentIndexes:h,parentIds:l};return vm(g),g}function je(e,t,n){if(!e)return;const s=e.parentCounts;return e.parentIds?n(e,t):s>0?Om(e,t,n):xm(e,t,n)}function Om(e,t,n){const s=e.classIds,r=e.parentCounts,i=e.parentIds,o=e.parentIndexes,a=s.length,c=scratchVisited;c.length=Math.max(c.length,a);const l=++marker,u=scratchStack;for(u.length=0,u.push(t);u.length>0;){if(t=u.pop(),c[t]===l)continue;c[t]=l;const h=n(e,t);if(Nt(h))return h;const f=r[t],d=o[t];for(let m=0;m<f;++m){const g=i[d+m];g!==t&&u.push(g)}}return null}function xm(e,t,n){let s=!0;for(;s;){const r=n(e,t);if(Nt(r))return r;const i=e.parentIds[t];s=i!==t,t=i}throw new Error("traverseHierarchySingleParent")}function vm(e){const n=e.classIds.length;for(let s=0;s<n;++s)sa(e,s,stack)}function sa(e,t,n){const s=e.parentCounts,r=e.parentIds,i=e.parentIndexes,a=e.classIds.length;if(!Nt(r))return;assert(t<a,`Parent index ${t} exceeds the total number of instances: ${a}`),assert(n.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(t);const c=Nt(s)?s[t]:1,l=Nt(s)?i[t]:t;for(let u=0;u<c;++u){const h=r[l+u];h!==t&&sa(e,h,n)}n.pop(t)}function at(e){return e!=null}const $n=(e,t)=>e,Fm={HIERARCHY:!0,extensions:!0,extras:!0};class ra{constructor(t,n,s){var r;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this.json=void 0,this.binary=void 0,this.featureCount=void 0,this._extensions=void 0,this._properties=void 0,this._binaryProperties=void 0,this._hierarchy=void 0,it(s>=0),this.json=t||{},this.binary=n,this.featureCount=s,this._extensions=((r=this.json)===null||r===void 0?void 0:r.extensions)||{},this._properties={};for(const o in this.json)Fm[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Sm(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,n){if(this._checkBatchId(t),it(typeof n=="string",n),this._hierarchy){const s=je(this._hierarchy,t,(r,i)=>{const o=r.classIds[i];return r.classes[o].name===n});return at(s)}return!1}isExactClass(t,n){return it(typeof n=="string",n),this.getExactClassName(t)===n}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const n=this._hierarchy.classIds[t];return this._hierarchy.classes[n].name}}hasProperty(t,n){return this._checkBatchId(t),it(typeof n=="string",n),at(this._properties[n])||this._hasPropertyInHierarchy(t,n)}getPropertyNames(t,n){this._checkBatchId(t),n=at(n)?n:[],n.length=0;const s=Object.keys(this._properties);return n.push(...s),this._hierarchy&&this._getPropertyNamesInHierarchy(t,n),n}getProperty(t,n){if(this._checkBatchId(t),it(typeof n=="string",n),this._binaryProperties){const r=this._binaryProperties[n];if(at(r))return this._getBinaryProperty(r,t)}const s=this._properties[n];if(at(s))return $n(s[t]);if(this._hierarchy){const r=this._getHierarchyProperty(t,n);if(at(r))return r}}setProperty(t,n,s){const r=this.featureCount;if(this._checkBatchId(t),it(typeof n=="string",n),this._binaryProperties){const o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,t,s);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,n,s))return;let i=this._properties[n];at(i)||(this._properties[n]=new Array(r),i=this._properties[n]),i[t]=$n(s)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,n){return t.unpack(t.typedArray,n)}_setBinaryProperty(t,n,s){t.pack(s,t.typedArray,n)}_initializeBinaryProperties(){let t=null;for(const n in this._properties){const s=this._properties[n],r=this._initializeBinaryProperty(n,s);r&&(t=t||{},t[n]=r)}return t}_initializeBinaryProperty(t,n){if("byteOffset"in n){const s=n;it(this.binary,`Property ${t} requires a batch table binary.`),it(s.type,`Property ${t} requires a type.`);const r=Rm(s,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(t,n){if(!this._hierarchy)return!1;const s=je(this._hierarchy,t,(r,i)=>{const o=r.classIds[i],a=r.classes[o].instances;return at(a[n])});return at(s)}_getPropertyNamesInHierarchy(t,n){je(this._hierarchy,t,(s,r)=>{const i=s.classIds[r],o=s.classes[i].instances;for(const a in o)o.hasOwnProperty(a)&&n.indexOf(a)===-1&&n.push(a)})}_getHierarchyProperty(t,n){return je(this._hierarchy,t,(s,r)=>{const i=s.classIds[r],o=s.classes[i],a=s.classIndexes[r],c=o.instances[n];return at(c)?at(c.typedArray)?this._getBinaryProperty(c,a):$n(c[a]):null})}_setHierarchyProperty(t,n,s,r){const i=je(this._hierarchy,n,(o,a)=>{const c=o.classIds[a],l=o.classes[c],u=o.classIndexes[a],h=l.instances[s];return at(h)?(it(a===n,`Inherited property "${s}" is read-only.`),at(h.typedArray)?this._setBinaryProperty(h,u,r):h[u]=$n(r),!0):!1});return at(i)}}const ur=4;function Vn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(t);if(e.magic=s.getUint32(n,!0),n+=ur,e.version=s.getUint32(n,!0),n+=ur,e.byteLength=s.getUint32(n,!0),n+=ur,e.version!==1)throw new Error(`3D Tile Version ${e.version} not supported`);return n}const Be=4,ia="b3dm tile in legacy format.";function hr(e,t,n){const s=new DataView(t);let r;e.header=e.header||{};let i=s.getUint32(n,!0);n+=Be;let o=s.getUint32(n,!0);n+=Be;let a=s.getUint32(n,!0);n+=Be;let c=s.getUint32(n,!0);return n+=Be,a>=570425344?(n-=Be*2,r=i,a=o,c=0,i=0,o=0,console.warn(ia)):c>=570425344&&(n-=Be,r=a,a=i,c=o,i=0,o=0,console.warn(ia)),e.header.featureTableJsonByteLength=i,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=a,e.header.batchTableBinaryByteLength=c,e.header.batchLength=r,n}function fr(e,t,n,s){return n=Lm(e,t,n),n=Dm(e,t,n),n}function Lm(e,t,n,s){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:i,batchLength:o}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:o||0},r&&r>0){const a=qo(t,n,r);e.featureTableJson=JSON.parse(a)}return n+=r||0,e.featureTableBinary=new Uint8Array(t,n,i),n+=i||0,n}function Dm(e,t,n,s){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:i}=e.header||{};if(r&&r>0){const o=qo(t,n,r);e.batchTableJson=JSON.parse(o),n+=r,i&&i>0&&(e.batchTableBinary=new Uint8Array(t,n,i),e.batchTableBinary=new Uint8Array(e.batchTableBinary),n+=i)}return n}function oa(e,t,n){if(!t&&(!e||!e.batchIds||!n))return null;const{batchIds:s,isRGB565:r,pointCount:i=0}=e;if(s&&n){const o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){const c=s[a],u=n.getProperty(c,"dimensions").map(h=>h*255);o[a*3]=u[0],o[a*3+1]=u[1],o[a*3+2]=u[2]}return{type:U.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(t&&r){const o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){const c=Em(t[a]);o[a*3]=c[0],o[a*3+1]=c[1],o[a*3+2]=c[2]}return{type:U.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return t&&t.length===i*3?{type:U.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:U.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}const aa=new w;function Gm(e,t){if(!t)return null;if(e.isOctEncoded16P){const n=new Float32Array((e.pointsLength||0)*3);for(let s=0;s<(e.pointsLength||0);s++)bm(t[s*2],t[s*2+1],aa),aa.toArray(n,s*3);return{type:U.FLOAT,size:2,value:n}}return{type:U.FLOAT,size:2,value:t}}function Nm(e,t,n){return e.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,Pm(e,t)):{type:U.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function Pm(e,t){const n=new w,s=new Float32Array(e.pointCount*3);for(let r=0;r<e.pointCount;r++)n.set(t[r*3],t[r*3+1],t[r*3+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(s,r*3);return s}async function Um(e,t,n,s,r){n=Vn(e,t,n),n=hr(e,t,n),n=fr(e,t,n),Hm(e);const{featureTable:i,batchTable:o}=km(e);return await jm(e,i,o,s,r),$m(e,i,s),Vm(e,i,o),Jm(e,i),n}function Hm(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function km(e){const t=new lr(e.featureTableJson,e.featureTableBinary),n=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=n,e.featuresLength=n,e.pointsLength=n,e.pointCount=n,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",U.FLOAT,3);const s=Wm(e,t);return{featureTable:t,batchTable:s}}function $m(e,t,n){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions){if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",U.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const s=t.getPropertyArray("POSITION_QUANTIZED",U.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",U.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",U.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=Nm(e,s,n)}}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Vm(e,t,n){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let s=null;t.hasProperty("RGBA")?(s=t.getPropertyArray("RGBA",U.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?s=t.getPropertyArray("RGB",U.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(s=t.getPropertyArray("RGB565",U.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=oa(e,s,n)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",U.UNSIGNED_BYTE,4))}function Jm(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let n=null;t.hasProperty("NORMAL")?n=t.getPropertyArray("NORMAL",U.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(n=t.getPropertyArray("NORMAL_OCT16P",U.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=Gm(e,n)}}function Wm(e,t){let n=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",U.UNSIGNED_SHORT,1),e.batchIds)){const s=t.getGlobalProperty("BATCH_LENGTH");if(!s)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:i}=e;n=new ra(r,i,s)}return n}async function jm(e,t,n,s,r){let i,o,a;const c=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const l=t.getExtension("3DTILES_draco_point_compression");if(l){o=l.properties;const h=l.byteOffset,f=l.byteLength;if(!o||!Number.isFinite(h)||!f)throw new Error("Draco properties, byteOffset, and byteLength must be defined");i=(e.featureTableBinary||[]).slice(h,h+f),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!i)return!0;const u={buffer:i,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await zm(e,u,s,r)}async function zm(e,t,n,s){if(!s)return;const r={...n,draco:{...n==null?void 0:n.draco,extraAttributes:t.batchTableProperties||{}}};delete r["3d-tiles"];const i=await Us(t.buffer,ta,r,s),o=i.attributes.POSITION&&i.attributes.POSITION.value,a=i.attributes.COLOR_0&&i.attributes.COLOR_0.value,c=i.attributes.NORMAL&&i.attributes.NORMAL.value,l=i.attributes.BATCH_ID&&i.attributes.BATCH_ID.value,u=o&&i.attributes.POSITION.value.quantization,h=c&&i.attributes.NORMAL.value.quantization;if(u){const d=i.POSITION.data.quantization,m=d.range;e.quantizedVolumeScale=new w(m,m,m),e.quantizedVolumeOffset=new w(d.minValues),e.quantizedRange=(1<<d.quantizationBits)-1,e.isQuantizedDraco=!0}h&&(e.octEncodedRange=(1<<i.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const f={};if(t.batchTableProperties)for(const d of Object.keys(t.batchTableProperties))i.attributes[d]&&i.attributes[d].value&&(f[d.toLowerCase()]=i.attributes[d].value);e.attributes={positions:o,colors:oa(e,a,void 0),normals:c,batchIds:l,...f}}const Km="4.1.0-alpha.5";function ca(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const la=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),ua=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ua&&parseFloat(ua[1]);var dr;const qm=(dr=globalThis.loaders)===null||dr===void 0?void 0:dr.parseImageNode,mr=typeof Image<"u",gr=typeof ImageBitmap<"u",Ar=la?!0:!!qm;function Xm(e){switch(e){case"auto":return gr||mr||Ar;case"imagebitmap":return gr;case"image":return mr;case"data":return Ar;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function Qm(){if(gr)return"imagebitmap";if(mr)return"image";if(Ar)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Ym(e){const t=Zm(e);if(!t)throw new Error("Not an image");return t}function ha(e){switch(Ym(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function Zm(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const tg=/^data:image\/svg\+xml/,eg=/\.svg((\?|#).*)?$/;function pr(e){return e&&(tg.test(e)||eg.test(e))}function ng(e,t){if(pr(t)){let s=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(s=unescape(encodeURIComponent(s)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(s)}`}return fa(e,t)}function fa(e,t){if(pr(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function da(e,t,n){const s=ng(e,n),r=self.URL||self.webkitURL,i=typeof s!="string"&&r.createObjectURL(s);try{return await sg(i||s,t)}finally{i&&r.revokeObjectURL(i)}}async function sg(e,t){const n=new Image;return n.src=e,t.image&&t.image.decode&&n.decode?(await n.decode(),n):await new Promise((s,r)=>{try{n.onload=()=>s(n),n.onerror=i=>{const o=i instanceof Error?i.message:"error";r(new Error(o))}}catch(i){r(i)}})}const rg={};let ma=!0;async function ig(e,t,n){let s;pr(n)?s=await da(e,t,n):s=fa(e,n);const r=t&&t.imagebitmap;return await og(s,r)}async function og(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((ag(t)||!ma)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(n){console.warn(n),ma=!1}return await createImageBitmap(e)}function ag(e){for(const t in e||rg)return!1;return!0}function cg(e){return!fg(e,"ftyp",4)||!(e[8]&96)?null:lg(e)}function lg(e){switch(ug(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function ug(e,t,n){return String.fromCharCode(...e.slice(t,n))}function hg(e){return[...e].map(t=>t.charCodeAt(0))}function fg(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=hg(t);for(let r=0;r<s.length;++r)if(s[r]!==e[r+n])return!1;return!0}const Pt=!1,ze=!0;function yr(e){const t=Ke(e);return mg(t)||pg(t)||gg(t)||Ag(t)||dg(t)}function dg(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),n=cg(t);return n?{mimeType:n.mimeType,width:0,height:0}:null}function mg(e){const t=Ke(e);return t.byteLength>=24&&t.getUint32(0,Pt)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Pt),height:t.getUint32(20,Pt)}:null}function gg(e){const t=Ke(e);return t.byteLength>=10&&t.getUint32(0,Pt)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,ze),height:t.getUint16(8,ze)}:null}function Ag(e){const t=Ke(e);return t.byteLength>=14&&t.getUint16(0,Pt)===16973&&t.getUint32(2,ze)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,ze),height:t.getUint32(22,ze)}:null}function pg(e){const t=Ke(e);if(!(t.byteLength>=3&&t.getUint16(0,Pt)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:s,sofMarkers:r}=yg();let i=2;for(;i+9<t.byteLength;){const o=t.getUint16(i,Pt);if(r.has(o))return{mimeType:"image/jpeg",height:t.getUint16(i+5,Pt),width:t.getUint16(i+7,Pt)};if(!s.has(o))return null;i+=2,i+=t.getUint16(i,Pt)}return null}function yg(){const e=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)e.add(n);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ke(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function Bg(e,t){var n;const{mimeType:s}=yr(e)||{},r=(n=globalThis.loaders)===null||n===void 0?void 0:n.parseImageNode;return ca(r),await r(e,s)}async function Tg(e,t,n){t=t||{};const r=(t.image||{}).type||"auto",{url:i}=n||{},o=Eg(r);let a;switch(o){case"imagebitmap":a=await ig(e,t,i);break;case"image":a=await da(e,t,i);break;case"data":a=await Bg(e);break;default:ca(!1)}return r==="data"&&(a=ha(a)),a}function Eg(e){switch(e){case"auto":case"data":return Qm();default:return Xm(e),e}}const Cg={id:"image",module:"images",name:"Images",version:Km,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:Tg,tests:[e=>!!yr(new DataView(e))],options:{image:{type:"auto",decode:!0}}},Br={};function bg(e){if(Br[e]===void 0){const t=la?_g(e):wg(e);Br[e]=t}return Br[e]}function wg(e){var t,n;const s=["image/png","image/jpeg","image/gif"],r=((t=globalThis.loaders)===null||t===void 0?void 0:t.imageFormatsNode)||s;return!!((n=globalThis.loaders)===null||n===void 0?void 0:n.parseImageNode)&&r.includes(e)}function _g(e){switch(e){case"image/avif":case"image/webp":return Mg(e);default:return!0}}function Mg(e){try{return document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)===0}catch{return!1}}async function ga(e,t,n,s){return s._parse(e,t,n,s)}function qe(e,t){if(!e)throw new Error(t||"loader assertion failed.")}function Rg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?Aa(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Aa(e,0,t):""}function Aa(e,t,n){if(e.byteLength<=t+n)return"";const s=new DataView(e);let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(s.getUint8(t+i));return r}function Sg(e){try{return JSON.parse(e)}catch{throw new Error(`Failed to parse JSON from data starting with "${Rg(e)}"`)}}function pa(e,t,n){const s=n!==void 0?new Uint8Array(e).subarray(t,t+n):new Uint8Array(e).subarray(t);return new Uint8Array(s).buffer}function Xe(e,t){return qe(e>=0),qe(t>0),e+(t-1)&~(t-1)}function Ig(e,t,n){let s;if(e instanceof ArrayBuffer)s=new Uint8Array(e);else{const r=e.byteOffset,i=e.byteLength;s=new Uint8Array(e.buffer||e.arrayBuffer,r,i)}return t.set(s,n),n+Xe(s.byteLength,4)}function ft(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const ya={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ba={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Og=1.33,Ta=["SCALAR","VEC2","VEC3","VEC4"],xg=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],vg=new Map(xg),Fg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Lg={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Dg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Ea(e){return Ta[e-1]||Ta[0]}function Tr(e){const t=vg.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function Er(e,t){const n=Dg[e.componentType],s=Fg[e.type],r=Lg[e.componentType],i=e.count*s,o=e.count*s*r;ft(o>=0&&o<=t.byteLength);const a=Ba[e.componentType],c=ya[e.type];return{ArrayType:n,length:i,byteLength:o,componentByteSize:a,numberOfComponentsInElement:c}}function Ca(e){let{images:t,bufferViews:n}=e;t=t||[],n=n||[];const s=t.map(o=>o.bufferView);n=n.filter(o=>!s.includes(o));const r=n.reduce((o,a)=>o+a.byteLength,0),i=t.reduce((o,a)=>{const{width:c,height:l}=a.image;return o+c*l},0);return r+Math.ceil(4*i*Og)}function Gg(e,t,n){const s=e.bufferViews[n];ft(s);const r=s.buffer,i=t[r];ft(i);const o=(s.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,o,s.byteLength)}function Ng(e,t,n){var s,r;const i=typeof n=="number"?(s=e.accessors)===null||s===void 0?void 0:s[n]:n;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(n)}`);const o=(r=e.bufferViews)===null||r===void 0?void 0:r[i.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);const{arrayBuffer:a,byteOffset:c}=t[o.buffer],l=(c||0)+(i.byteOffset||0)+(o.byteOffset||0),{ArrayType:u,length:h,componentByteSize:f,numberOfComponentsInElement:d}=Er(i,o),m=f*d,g=o.byteStride||m;if(typeof o.byteStride>"u"||o.byteStride===m)return new u(a,l,h);const A=new u(h);for(let y=0;y<i.count;y++){const b=new u(a,l+y*g,d);A.set(b,y*d)}return A}function Pg(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class tt{constructor(t){this.gltf=void 0,this.sourceBuffers=void 0,this.byteLength=void 0,this.gltf={json:(t==null?void 0:t.json)||Pg(),buffers:(t==null?void 0:t.buffers)||[],images:(t==null?void 0:t.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const n=this.getUsedExtensions().find(r=>r===t),s=this.getRequiredExtensions().find(r=>r===t);return typeof n=="string"||typeof s=="string"}getExtension(t){const n=this.getUsedExtensions().find(r=>r===t),s=this.json.extensions||{};return n?s[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(s=>s===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,n){return(t.extensions||{})[n]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,n){if(typeof n=="object")return n;const s=this.json[t]&&this.json[t][n];if(!s)throw new Error(`glTF file error: Could not find ${t}[${n}]`);return s}getTypedArrayForBufferView(t){t=this.getBufferView(t);const n=t.buffer,s=this.gltf.buffers[n];ft(s);const r=(t.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,r,t.byteLength)}getTypedArrayForAccessor(t){const n=this.getAccessor(t);return Ng(this.gltf.json,this.gltf.buffers,n)}getTypedArrayForImageData(t){t=this.getAccessor(t);const n=this.getBufferView(t.bufferView),r=this.getBuffer(n.buffer).data,i=n.byteOffset||0;return new Uint8Array(r,i,n.byteLength)}addApplicationData(t,n){return this.json[t]=n,this}addExtraData(t,n){return this.json.extras=this.json.extras||{},this.json.extras[t]=n,this}addObjectExtension(t,n,s){return t.extensions=t.extensions||{},t.extensions[n]=s,this.registerUsedExtension(n),this}setObjectExtension(t,n,s){const r=t.extensions||{};r[n]=s}removeObjectExtension(t,n){const s=(t==null?void 0:t.extensions)||{};if(s[n]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(n)||r.push(n)}delete s[n]}addExtension(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ft(n),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=n,this.registerUsedExtension(t),n}addRequiredExtension(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ft(n),this.addExtension(t,n),this.registerRequiredExtension(t),n}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===t)||this.json.extensionsRequired.push(t)}removeExtension(t){var n;if((n=this.json.extensions)!==null&&n!==void 0&&n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(t)||s.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:n}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(t){const{meshIndex:n,matrix:s}=t;this.json.nodes=this.json.nodes||[];const r={mesh:n};return s&&(r.matrix=s),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(t){const{attributes:n,indices:s,material:r,mode:i=4}=t,a={primitives:[{attributes:this._addAttributes(n),mode:i}]};if(s){const c=this._addIndices(s);a.primitives[0].indices=c}return Number.isFinite(r)&&(a.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(t){const s={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addImage(t,n){const s=yr(t),r=n||(s==null?void 0:s.mimeType),o={bufferView:this.addBufferView(t),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.byteLength;const r=t.byteLength;ft(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const i={buffer:n,byteOffset:s,byteLength:r};return this.byteLength+=Xe(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(t,n){const s={bufferView:t,type:Ea(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const s=this.addBufferView(t);let r={min:n.min,max:n.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(t,n.size));const i={size:n.size,componentType:Tr(t),count:Math.round(t.length/n.size),min:r.min,max:r.max};return this.addAccessor(s,Object.assign(i,n))}addTexture(t){const{imageIndex:n}=t,s={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,n;this.gltf.buffers=[];const s=this.byteLength,r=new ArrayBuffer(s),i=new Uint8Array(r);let o=0;for(const a of this.sourceBuffers||[])o=Ig(a,i,o);(t=this.json)!==null&&t!==void 0&&(n=t.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=s:this.json.buffers=[{byteLength:s}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(t,n){let s=!0;for(;s;){const r=t.indexOf(n);r>-1?t.splice(r,1):s=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={};for(const s in t){const r=t[s],i=this._getGltfAttributeName(s),o=this.addBinaryBuffer(r.value,r);n[i]=o}return n}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,n){const s={min:null,max:null};if(t.length<n)return s;s.min=[],s.max=[];const r=t.subarray(0,n);for(const i of r)s.min.push(i),s.max.push(i);for(let i=n;i<t.length;i+=n)for(let o=0;o<n;o++)s.min[0+o]=Math.min(s.min[0+o],t[i+o]),s.max[0+o]=Math.max(s.max[0+o],t[i+o]);return s}}function ba(e){return(e%1+1)%1}const wa={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Ug={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},_a={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Cr(e,t){return _a[t]*wa[e]}function Jn(e,t,n,s){if(n!=="UINT8"&&n!=="UINT16"&&n!=="UINT32"&&n!=="UINT64")return null;const r=e.getTypedArrayForBufferView(t),i=Wn(r,"SCALAR",n,s+1);return i instanceof BigInt64Array||i instanceof BigUint64Array?null:i}function Wn(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const r=wa[t],i=Ug[n],o=_a[n],a=s*r,c=a*o;let l=e.buffer,u=e.byteOffset;return u%o!==0&&(l=new Uint8Array(l).slice(u,u+c).buffer,u=0),new i(l,u,a)}function br(e,t,n){var s,r;const i=`TEXCOORD_${t.texCoord||0}`,o=n.attributes[i],a=e.getTypedArrayForAccessor(o),c=e.gltf.json,l=t.index,u=(s=c.textures)===null||s===void 0||(r=s[l])===null||r===void 0?void 0:r.source;if(typeof u<"u"){var h,f,d;const m=(h=c.images)===null||h===void 0||(f=h[u])===null||f===void 0?void 0:f.mimeType,g=(d=e.gltf.images)===null||d===void 0?void 0:d[u];if(g&&typeof g.width<"u"){const A=[];for(let y=0;y<a.length;y+=2){const b=Hg(g,m,a,y,t.channels);A.push(b)}return A}}return[]}function Ma(e,t,n,s,r){if(!(n!=null&&n.length))return;const i=[];for(const u of n){let h=s.findIndex(f=>f===u);h===-1&&(h=s.push(u)-1),i.push(h)}const o=new Uint32Array(i),a=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,c=e.addBufferView(o,a,0),l=e.addAccessor(c,{size:1,componentType:Tr(o),count:o.length});r.attributes[t]=l}function Hg(e,t,n,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[0];const i={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=n[s],a=n[s+1];let c=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(c=4);const l=kg(o,a,e,c);let u=0;for(const h of r){const f=typeof h=="number"?Object.values(i)[h]:i[h],d=l+f.offset,m=ha(e);if(m.data.length<=d)throw new Error(`${m.data.length} <= ${d}`);const g=m.data[d];u|=g<<f.shift}return u}function kg(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const r=n.width,i=ba(e)*(r-1),o=Math.round(i),a=n.height,c=ba(t)*(a-1),l=Math.round(c),u=n.components?n.components:s;return(l*r+o)*u}function Ra(e,t,n,s,r){const i=[];for(let o=0;o<t;o++){const a=n[o],c=n[o+1]-n[o];if(c+a>s)break;const l=a/r,u=c/r;i.push(e.slice(l,l+u))}return i}function Sa(e,t,n){const s=[];for(let r=0;r<t;r++){const i=r*n;s.push(e.slice(i,i+n))}return s}function Ia(e,t,n,s){if(n)throw new Error("Not implemented - arrayOffsets for strings is specified");if(s){const r=[],i=new TextDecoder("utf8");let o=0;for(let a=0;a<e;a++){const c=s[a+1]-s[a];if(c+o<=t.length){const l=t.subarray(o,c+o),u=i.decode(l);r.push(u),o+=c}}return r}return[]}const Oa="EXT_mesh_features",$g=Oa;async function Vg(e,t){const n=new tt(e);Jg(n,t)}function Jg(e,t){const n=e.gltf.json;if(n.meshes)for(const s of n.meshes)for(const r of s.primitives)Wg(e,r,t)}function Wg(e,t,n){var s,r;if(!(n!=null&&(s=n.gltf)!==null&&s!==void 0&&s.loadBuffers))return;const i=(r=t.extensions)===null||r===void 0?void 0:r[Oa],o=i==null?void 0:i.featureIds;if(o)for(const c of o){var a;let l;if(typeof c.attribute<"u"){const u=`_FEATURE_ID_${c.attribute}`,h=t.attributes[u];l=e.getTypedArrayForAccessor(h)}else typeof c.texture<"u"&&n!==null&&n!==void 0&&(a=n.gltf)!==null&&a!==void 0&&a.loadImages?l=br(e,c.texture,t):l=[];c.data=l}}const jg=Object.freeze(Object.defineProperty({__proto__:null,decode:Vg,name:$g},Symbol.toStringTag,{value:"Module"})),wr="EXT_structural_metadata",zg=wr;async function Kg(e,t){const n=new tt(e);qg(n,t)}function qg(e,t){var n,s;if(!((n=t.gltf)!==null&&n!==void 0&&n.loadBuffers))return;const r=e.getExtension(wr);r&&((s=t.gltf)!==null&&s!==void 0&&s.loadImages&&Xg(e,r),Qg(e,r))}function Xg(e,t){const n=t.propertyTextures,s=e.gltf.json;if(n&&s.meshes)for(const r of s.meshes)for(const i of r.primitives)Zg(e,n,i,t)}function Qg(e,t){const n=t.schema;if(!n)return;const s=n.classes,r=t.propertyTables;if(s&&r)for(const i in s){const o=Yg(r,i);o&&e1(e,n,o)}}function Yg(e,t){for(const n of e)if(n.class===t)return n;return null}function Zg(e,t,n,s){var r;if(!t)return;const i=(r=n.extensions)===null||r===void 0?void 0:r[wr],o=i==null?void 0:i.propertyTextures;if(o)for(const a of o){const c=t[a];t1(e,c,n,s)}}function t1(e,t,n,s){if(!t.properties)return;s.dataAttributeNames||(s.dataAttributeNames=[]);const r=t.class;for(const o in t.properties){var i;const a=`${r}_${o}`,c=(i=t.properties)===null||i===void 0?void 0:i[o];if(!c)continue;c.data||(c.data=[]);const l=c.data,u=br(e,c,n);u!==null&&(Ma(e,a,u,l,n),c.data=l,s.dataAttributeNames.push(a))}}function e1(e,t,n){var s;const r=(s=t.classes)===null||s===void 0?void 0:s[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const i=n.count;for(const a in r.properties){var o;const c=r.properties[a],l=(o=n.properties)===null||o===void 0?void 0:o[a];if(l){const u=n1(e,t,c,i,l);l.data=u}}}function n1(e,t,n,s,r){let i=[];const o=r.values,a=e.getTypedArrayForBufferView(o),c=s1(e,n,r,s),l=r1(e,r,s);switch(n.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{i=i1(n,s,a,c);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${n.type}`);case"STRING":{i=Ia(s,a,c,l);break}case"ENUM":{i=o1(t,n,s,a,c);break}default:throw new Error(`Unknown classProperty type ${n.type}`)}return i}function s1(e,t,n,s){return t.array&&typeof t.count>"u"&&typeof n.arrayOffsets<"u"?Jn(e,n.arrayOffsets,n.arrayOffsetType||"UINT32",s):null}function r1(e,t,n){return typeof t.stringOffsets<"u"?Jn(e,t.stringOffsets,t.stringOffsetType||"UINT32",n):null}function i1(e,t,n,s){const r=e.array,i=e.count,o=Cr(e.type,e.componentType),a=n.byteLength/o;let c;return e.componentType?c=Wn(n,e.type,e.componentType,a):c=n,r?s?Ra(c,t,s,n.length,o):i?Sa(c,t,i):[]:c}function o1(e,t,n,s,r){var i;const o=t.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const a=(i=e.enums)===null||i===void 0?void 0:i[o];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const c=a.valueType||"UINT16",l=Cr(t.type,c),u=s.byteLength/l;let h=Wn(s,t.type,c,u);if(h||(h=s),t.array){if(r)return a1({valuesData:h,numberOfElements:n,arrayOffsets:r,valuesDataBytesLength:s.length,elementSize:l,enumEntry:a});const f=t.count;return f?c1(h,n,f,a):[]}return _r(h,0,n,a)}function a1(e){const{valuesData:t,numberOfElements:n,arrayOffsets:s,valuesDataBytesLength:r,elementSize:i,enumEntry:o}=e,a=[];for(let c=0;c<n;c++){const l=s[c],u=s[c+1]-s[c];if(u+l>r)break;const h=l/i,f=u/i,d=_r(t,h,f,o);a.push(d)}return a}function c1(e,t,n,s){const r=[];for(let i=0;i<t;i++){const o=n*i,a=_r(e,o,n,s);r.push(a)}return r}function _r(e,t,n,s){const r=[];for(let i=0;i<n;i++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else{const o=e[t+i],a=l1(s,o);a?r.push(a.name):r.push("")}return r}function l1(e,t){for(const n of e.values)if(n.value===t)return n;return null}const u1=Object.freeze(Object.defineProperty({__proto__:null,decode:Kg,name:zg},Symbol.toStringTag,{value:"Module"})),xa="EXT_feature_metadata",h1=xa;async function f1(e,t){const n=new tt(e);d1(n,t)}function d1(e,t){var n,s;if(!((n=t.gltf)!==null&&n!==void 0&&n.loadBuffers))return;const r=e.getExtension(xa);r&&((s=t.gltf)!==null&&s!==void 0&&s.loadImages&&m1(e,r),g1(e,r))}function m1(e,t){const n=t.schema;if(!n)return;const s=n.classes,{featureTextures:r}=t;if(s&&r)for(const i in s){const o=s[i],a=p1(r,i);a&&B1(e,a,o)}}function g1(e,t){const n=t.schema;if(!n)return;const s=n.classes,r=t.featureTables;if(s&&r)for(const i in s){const o=A1(r,i);o&&y1(e,n,o)}}function A1(e,t){for(const n in e){const s=e[n];if(s.class===t)return s}return null}function p1(e,t){for(const n in e){const s=e[n];if(s.class===t)return s}return null}function y1(e,t,n){var s;if(!n.class)return;const r=(s=t.classes)===null||s===void 0?void 0:s[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const i=n.count;for(const a in r.properties){var o;const c=r.properties[a],l=(o=n.properties)===null||o===void 0?void 0:o[a];if(l){const u=T1(e,t,c,i,l);l.data=u}}}function B1(e,t,n){const s=t.class;for(const i in n.properties){var r;const o=t==null||(r=t.properties)===null||r===void 0?void 0:r[i];if(o){const a=_1(e,o,s);o.data=a}}}function T1(e,t,n,s,r){let i=[];const o=r.bufferView,a=e.getTypedArrayForBufferView(o),c=E1(e,n,r,s),l=C1(e,n,r,s);return n.type==="STRING"||n.componentType==="STRING"?i=Ia(s,a,c,l):b1(n)&&(i=w1(n,s,a,c)),i}function E1(e,t,n,s){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof n.arrayOffsetBufferView<"u"?Jn(e,n.arrayOffsetBufferView,n.offsetType||"UINT32",s):null}function C1(e,t,n,s){return typeof n.stringOffsetBufferView<"u"?Jn(e,n.stringOffsetBufferView,n.offsetType||"UINT32",s):null}function b1(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function w1(e,t,n,s){const r=e.type==="ARRAY",i=e.componentCount,o="SCALAR",a=e.componentType||e.type,c=Cr(o,a),l=n.byteLength/c,u=Wn(n,o,a,l);return r?s?Ra(u,t,s,n.length,c):i?Sa(u,t,i):[]:u}function _1(e,t,n){const s=e.gltf.json;if(!s.meshes)return[];const r=[];for(const i of s.meshes)for(const o of i.primitives)M1(e,n,t,r,o);return r}function M1(e,t,n,s,r){const i={channels:n.channels,...n.texture},o=br(e,i,r);o&&Ma(e,t,o,s,r)}const R1=Object.freeze(Object.defineProperty({__proto__:null,decode:f1,name:h1},Symbol.toStringTag,{value:"Module"})),S1="4.1.0-alpha.5",I1="4.1.0-alpha.5";function O1(){var e;return(e=globalThis._loadersgl_)!==null&&e!==void 0&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.1.0-alpha.5"),globalThis._loadersgl_.version}const x1=O1();function v1(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Qe=typeof process!="object"||String(process)!=="[object process]"||process.browser,Mr=typeof importScripts=="function",va=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);va&&parseFloat(va[1]);const Rr={};async function jn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return t&&(e=F1(e,t,n,s)),Rr[e]=Rr[e]||L1(e),await Rr[e]}function F1(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!n.useLocalLibraries&&e.startsWith("http"))return e;s=s||e;const r=n.modules||{};return r[s]?r[s]:Qe?n.CDN?(v1(n.CDN.startsWith("http")),`${n.CDN}/${t}@${x1}/dist/libs/${s}`):Mr?`../src/libs/${s}`:`modules/${t}/src/libs/${s}`:`modules/${t}/dist/libs/${s}`}async function L1(e){if(e.endsWith("wasm"))return await G1(e);if(!Qe)try{return Pi&&void 0}catch(n){return console.error(n),null}if(Mr)return importScripts(e);const t=await N1(e);return D1(t,e)}function D1(e,t){if(!Qe)return;if(Mr)return eval.call(globalThis,e),null;const n=document.createElement("script");n.id=t;try{n.appendChild(document.createTextNode(e))}catch{n.text=e}return document.body.appendChild(n),null}async function G1(e){return await(await fetch(e)).arrayBuffer()}async function N1(e){return await(await fetch(e)).text()}const zn={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let Sr;async function Fa(e){const t=e.modules||{};return t.basis?t.basis:(Sr=Sr||P1(e),await Sr)}async function P1(e){let t=null,n=null;return[t,n]=await Promise.all([await jn(zn.TRANSCODER,"textures",e),await jn(zn.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await U1(t,n)}function U1(e,t){const n={};return t&&(n.wasmBinary=t),new Promise(s=>{e(n).then(r=>{const{BasisFile:i,initializeBasis:o}=r;o(),s({BasisFile:i})})})}let Ir;async function La(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(Ir=Ir||H1(e),await Ir)}async function H1(e){let t=null,n=null;return[t,n]=await Promise.all([await jn(zn.ENCODER,"textures",e),await jn(zn.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await k1(t,n)}function k1(e,t){const n={};return t&&(n.wasmBinary=t),new Promise(s=>{e(n).then(r=>{const{BasisFile:i,KTX2File:o,initializeBasis:a,BasisEncoder:c}=r;a(),s({BasisFile:i,KTX2File:o,BasisEncoder:c})})})}const Te={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},$1=["","WEBKIT_","MOZ_"],Da={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Kn=null;function V1(e){if(!Kn){e=e||J1()||void 0,Kn=new Set;for(const t of $1)for(const n in Da)if(e&&e.getExtension(`${t}${n}`)){const s=Da[n];Kn.add(s)}}return Kn}function J1(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var Ga,Na,Pa,Ua,Ha,ka,$a,Va;(function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"})(Ga||(Ga={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(Na||(Na={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(Pa||(Pa={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(Ua||(Ua={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(Ha||(Ha={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(ka||(ka={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}($a||($a={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(Va||(Va={}));const dt=[171,75,84,88,32,50,48,187,13,10,26,10];function W1(e){const t=new Uint8Array(e);return!(t.byteLength<dt.length||t[0]!==dt[0]||t[1]!==dt[1]||t[2]!==dt[2]||t[3]!==dt[3]||t[4]!==dt[4]||t[5]!==dt[5]||t[6]!==dt[6]||t[7]!==dt[7]||t[8]!==dt[8]||t[9]!==dt[9]||t[10]!==dt[10]||t[11]!==dt[11])}const j1={etc1:{basisFormat:0,compressed:!0,format:Te.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Te.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Te.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Te.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Te.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Te.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function z1(e,t){if(t.basis.containerFormat==="auto"){if(W1(e)){const s=await La(t);return Ja(s.KTX2File,e,t)}const{BasisFile:n}=await Fa(t);return Or(n,e,t)}switch(t.basis.module){case"encoder":const n=await La(t);switch(t.basis.containerFormat){case"ktx2":return Ja(n.KTX2File,e,t);case"basis":default:return Or(n.BasisFile,e,t)}case"transcoder":default:const{BasisFile:s}=await Fa(t);return Or(s,e,t)}}function Or(e,t,n){const s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const r=s.getNumImages(),i=[];for(let o=0;o<r;o++){const a=s.getNumLevels(o),c=[];for(let l=0;l<a;l++)c.push(K1(s,o,l,n));i.push(c)}return i}finally{s.close(),s.delete()}}function K1(e,t,n,s){const r=e.getImageWidth(t,n),i=e.getImageHeight(t,n),o=e.getHasAlpha(),{compressed:a,format:c,basisFormat:l}=Wa(s,o),u=e.getImageTranscodedSizeInBytes(t,n,l),h=new Uint8Array(u);if(!e.transcodeImage(h,t,n,l,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:i,data:h,compressed:a,format:c,hasAlpha:o}}function Ja(e,t,n){const s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=s.getLevels(),i=[];for(let o=0;o<r;o++){i.push(q1(s,o,n));break}return[i]}finally{s.close(),s.delete()}}function q1(e,t,n){const{alphaFlag:s,height:r,width:i}=e.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:c}=Wa(n,s),l=e.getImageTranscodedSizeInBytes(t,0,0,c),u=new Uint8Array(l);if(!e.transcodeImage(u,t,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:i,height:r,data:u,compressed:o,levelSize:l,hasAlpha:s,format:a}}function Wa(e,t){let n=e&&e.basis&&e.basis.format;return n==="auto"&&(n=ja()),typeof n=="object"&&(n=t?n.alpha:n.noAlpha),n=n.toLowerCase(),j1[n]}function ja(){const e=V1();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const X1={...{name:"Basis",id:"basis",module:"textures",version:I1,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:z1},Ee=!0,za=1735152710,xr=12,qn=8,Q1=1313821514,Y1=5130562,Z1=0,tA=0,eA=1;function nA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function sA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=new DataView(e),{magic:r=za}=n,i=s.getUint32(t,!1);return i===r||i===za}function rA(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(t),r=nA(s,n+0),i=s.getUint32(n+4,Ee),o=s.getUint32(n+8,Ee);switch(Object.assign(e,{header:{byteOffset:n,byteLength:o,hasBinChunk:!1},type:r,version:i,json:{},binChunks:[]}),n+=xr,e.version){case 1:return iA(e,s,n);case 2:return oA(e,s,n,{});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function iA(e,t,n){qe(e.header.byteLength>xr+qn);const s=t.getUint32(n+0,Ee),r=t.getUint32(n+4,Ee);return n+=qn,qe(r===Z1),vr(e,t,n,s),n+=s,n+=Fr(e,t,n,e.header.byteLength),n}function oA(e,t,n,s){return qe(e.header.byteLength>xr+qn),aA(e,t,n,s),n+e.header.byteLength}function aA(e,t,n,s){for(;n+8<=e.header.byteLength;){const r=t.getUint32(n+0,Ee),i=t.getUint32(n+4,Ee);switch(n+=qn,i){case Q1:vr(e,t,n,r);break;case Y1:Fr(e,t,n,r);break;case tA:s.strict||vr(e,t,n,r);break;case eA:s.strict||Fr(e,t,n,r);break}n+=Xe(r,4)}return n}function vr(e,t,n,s){const r=new Uint8Array(t.buffer,n,s),o=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(o),Xe(s,4)}function Fr(e,t,n,s){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:n,byteLength:s,arrayBuffer:t.buffer}),Xe(s,4)}function Ka(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const s=t.baseUri||t.uri;if(!s)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return s.substr(0,s.lastIndexOf("/")+1)+e}const cA="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",lA="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",uA=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),hA=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),fA={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},dA={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function mA(e,t,n,s,r){let i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const o=await gA();yA(o,o.exports[dA[r]],e,t,n,s,o.exports[fA[i||"NONE"]])}let Lr;async function gA(){return Lr||(Lr=AA()),Lr}async function AA(){let e=cA;WebAssembly.validate(uA)&&(e=lA,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(pA(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function pA(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;++s){const r=e.charCodeAt(s);t[s]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let n=0;for(let s=0;s<e.length;++s)t[n++]=t[s]<60?hA[t[s]]:(t[s]-60)*64+t[++s];return t.buffer.slice(0,n)}function yA(e,t,n,s,r,i,o){const a=e.exports.sbrk,c=s+3&-4,l=a(c*r),u=a(i.length),h=new Uint8Array(e.exports.memory.buffer);h.set(i,u);const f=t(l,s,r,u,i.length);if(f===0&&o&&o(l,c,r),n.set(h.subarray(l,l+s*r)),a(l-a(0)),f!==0)throw new Error(`Malformed buffer data: ${f}`)}const Xn="EXT_meshopt_compression",BA=Xn;async function TA(e,t){var n,s;const r=new tt(e);if(!(t!=null&&(n=t.gltf)!==null&&n!==void 0&&n.decompressMeshes)||!((s=t.gltf)!==null&&s!==void 0&&s.loadBuffers))return;const i=[];for(const o of e.json.bufferViews||[])i.push(EA(r,o));await Promise.all(i),r.removeExtension(Xn)}async function EA(e,t){const n=e.getObjectExtension(t,Xn);if(n){const{byteOffset:s=0,byteLength:r=0,byteStride:i,count:o,mode:a,filter:c="NONE",buffer:l}=n,u=e.gltf.buffers[l],h=new Uint8Array(u.arrayBuffer,u.byteOffset+s,r),f=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await mA(f,o,i,h,a,c),e.removeObjectExtension(t,Xn)}}const CA=Object.freeze(Object.defineProperty({__proto__:null,decode:TA,name:BA},Symbol.toStringTag,{value:"Module"})),Ce="EXT_texture_webp",bA=Ce;function wA(e,t){const n=new tt(e);if(!bg("image/webp")){if(n.getRequiredExtensions().includes(Ce))throw new Error(`gltf: Required extension ${Ce} not supported by browser`);return}const{json:s}=n;for(const r of s.textures||[]){const i=n.getObjectExtension(r,Ce);i&&(r.source=i.source),n.removeObjectExtension(r,Ce)}n.removeExtension(Ce)}const _A=Object.freeze(Object.defineProperty({__proto__:null,name:bA,preprocess:wA},Symbol.toStringTag,{value:"Module"})),Qn="KHR_texture_basisu",MA=Qn;function RA(e,t){const n=new tt(e),{json:s}=n;for(const r of s.textures||[]){const i=n.getObjectExtension(r,Qn);i&&(r.source=i.source,n.removeObjectExtension(r,Qn))}n.removeExtension(Qn)}const SA=Object.freeze(Object.defineProperty({__proto__:null,name:MA,preprocess:RA},Symbol.toStringTag,{value:"Module"}));function IA(e){const t={};for(const n in e){const s=e[n];if(n!=="indices"){const r=qa(s);t[n]=r}}return t}function qa(e){const{buffer:t,size:n,count:s}=OA(e);return{value:t,size:n,byteOffset:0,count:s,type:Ea(n),componentType:Tr(t)}}function OA(e){let t=e,n=1,s=0;return e&&e.value&&(t=e.value,n=e.size||1),t&&(ArrayBuffer.isView(t)||(t=xA(t,Float32Array)),s=t.length/n),{buffer:t,size:n,count:s}}function xA(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e?Array.isArray(e)?new t(e):n&&!(e instanceof t)?new t(e):e:null}const Qt="KHR_draco_mesh_compression",vA=Qt;function FA(e,t,n){const s=new tt(e);for(const r of Xa(s))s.getObjectExtension(r,Qt)}async function LA(e,t,n){var s;if(!(t!=null&&(s=t.gltf)!==null&&s!==void 0&&s.decompressMeshes))return;const r=new tt(e),i=[];for(const o of Xa(r))r.getObjectExtension(o,Qt)&&i.push(GA(r,o,t,n));await Promise.all(i),r.removeExtension(Qt)}function DA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new tt(e);for(const s of n.json.meshes||[])NA(s,t),n.addRequiredExtension(Qt)}async function GA(e,t,n,s){const r=e.getObjectExtension(t,Qt);if(!r)return;const i=e.getTypedArrayForBufferView(r.bufferView),o=pa(i.buffer,i.byteOffset),a={...n};delete a["3d-tiles"];const c=await ga(o,ta,a,s),l=IA(c.attributes);for(const[u,h]of Object.entries(l))if(u in t.attributes){const f=t.attributes[u],d=e.getAccessor(f);d!=null&&d.min&&d!==null&&d!==void 0&&d.max&&(h.min=d.min,h.max=d.max)}t.attributes=l,c.indices&&(t.indices=qa(c.indices)),e.removeObjectExtension(t,Qt),PA(t)}function NA(e,t){var n;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=r.DracoWriter.encodeSync({attributes:e}),a=i==null||(n=i.parseSync)===null||n===void 0?void 0:n.call(i,{attributes:e}),c=r._addFauxAttributes(a.attributes),l=r.addBufferView(o);return{primitives:[{attributes:c,mode:s,extensions:{[Qt]:{bufferView:l,attributes:c}}}]}}function PA(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Xa(e){for(const t of e.json.meshes||[])for(const n of t.primitives)yield n}const UA=Object.freeze(Object.defineProperty({__proto__:null,decode:LA,encode:DA,name:vA,preprocess:FA},Symbol.toStringTag,{value:"Module"})),Dr="KHR_texture_transform",HA=Dr,Yn=new w,kA=new z,$A=new z;async function VA(e,t){var n;if(!new tt(e).hasExtension(Dr)||!((n=t.gltf)!==null&&n!==void 0&&n.loadBuffers))return;const i=e.json.materials||[];for(let o=0;o<i.length;o++)JA(o,e)}function JA(e,t){var n,s,r;const i=[],o=(n=t.json.materials)===null||n===void 0?void 0:n[e],a=o==null||(s=o.pbrMetallicRoughness)===null||s===void 0?void 0:s.baseColorTexture;a&&Ye(t,e,a,i);const c=o==null?void 0:o.emissiveTexture;c&&Ye(t,e,c,i);const l=o==null?void 0:o.normalTexture;l&&Ye(t,e,l,i);const u=o==null?void 0:o.occlusionTexture;u&&Ye(t,e,u,i);const h=o==null||(r=o.pbrMetallicRoughness)===null||r===void 0?void 0:r.metallicRoughnessTexture;h&&Ye(t,e,h,i)}function Ye(e,t,n,s){const r=WA(n,s);if(!r)return;const i=e.json.meshes||[];for(const o of i)for(const a of o.primitives){const c=a.material;Number.isFinite(c)&&t===c&&jA(e,a,r)}}function WA(e,t){var n;const s=(n=e.extensions)===null||n===void 0?void 0:n[Dr],{texCoord:r=0}=e,{texCoord:i=r}=s;if(!(t.findIndex(a=>{let[c,l]=a;return c===r&&l===i})!==-1)){const a=qA(s);return r!==i&&(e.texCoord=i),t.push([r,i]),{originalTexCoord:r,texCoord:i,matrix:a}}return null}function jA(e,t,n){const{originalTexCoord:s,texCoord:r,matrix:i}=n,o=t.attributes[`TEXCOORD_${s}`];if(Number.isFinite(o)){var a;const l=(a=e.json.accessors)===null||a===void 0?void 0:a[o];if(l&&l.bufferView){var c;const u=(c=e.json.bufferViews)===null||c===void 0?void 0:c[l.bufferView];if(u){const{arrayBuffer:h,byteOffset:f}=e.buffers[u.buffer],d=(f||0)+(l.byteOffset||0)+(u.byteOffset||0),{ArrayType:m,length:g}=Er(l,u),A=Ba[l.componentType],y=ya[l.type],b=u.byteStride||A*y,E=new Float32Array(g);for(let C=0;C<l.count;C++){const _=new m(h,d+C*b,2);Yn.set(_[0],_[1],1),Yn.transformByMatrix3(i),E.set([Yn[0],Yn[1]],C*y)}s===r?zA(l,u,e.buffers,E):KA(r,l,t,e,E)}}}}function zA(e,t,n,s){e.componentType=5126,n.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength}),t.buffer=n.length-1,t.byteLength=s.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function KA(e,t,n,s,r){s.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const i=s.json.bufferViews;if(!i)return;i.push({buffer:s.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:(i==null?void 0:i.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),n.attributes[`TEXCOORD_${e}`]=o.length-1)}function qA(e){const{offset:t=[0,0],rotation:n=0,scale:s=[1,1]}=e,r=new z().set(1,0,0,0,1,0,t[0],t[1],1),i=kA.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=$A.set(s[0],0,0,0,s[1],0,0,0,1);return r.multiplyRight(i).multiplyRight(o)}const XA=Object.freeze(Object.defineProperty({__proto__:null,decode:VA,name:HA},Symbol.toStringTag,{value:"Module"})),oe="KHR_lights_punctual",QA=oe;async function YA(e){const t=new tt(e),{json:n}=t,s=t.getExtension(oe);s&&(t.json.lights=s.lights,t.removeExtension(oe));for(const r of n.nodes||[]){const i=t.getObjectExtension(r,oe);i&&(r.light=i.light),t.removeObjectExtension(r,oe)}}async function ZA(e){const t=new tt(e),{json:n}=t;if(n.lights){const s=t.addExtension(oe);ft(!s.lights),s.lights=n.lights,delete n.lights}if(t.json.lights){for(const s of t.json.lights){const r=s.node;t.addObjectExtension(r,oe,s)}delete t.json.lights}}const tp=Object.freeze(Object.defineProperty({__proto__:null,decode:YA,encode:ZA,name:QA},Symbol.toStringTag,{value:"Module"})),Ze="KHR_materials_unlit",ep=Ze;async function np(e){const t=new tt(e),{json:n}=t;for(const s of n.materials||[])s.extensions&&s.extensions.KHR_materials_unlit&&(s.unlit=!0),t.removeObjectExtension(s,Ze);t.removeExtension(Ze)}function sp(e){const t=new tt(e),{json:n}=t;if(t.materials)for(const s of n.materials||[])s.unlit&&(delete s.unlit,t.addObjectExtension(s,Ze,{}),t.addExtension(Ze))}const rp=Object.freeze(Object.defineProperty({__proto__:null,decode:np,encode:sp,name:ep},Symbol.toStringTag,{value:"Module"})),tn="KHR_techniques_webgl",ip=tn;async function op(e){const t=new tt(e),{json:n}=t,s=t.getExtension(tn);if(s){const r=cp(s,t);for(const i of n.materials||[]){const o=t.getObjectExtension(i,tn);o&&(i.technique=Object.assign({},o,r[o.technique]),i.technique.values=lp(i.technique,t)),t.removeObjectExtension(i,tn)}t.removeExtension(tn)}}async function ap(e,t){}function cp(e,t){const{programs:n=[],shaders:s=[],techniques:r=[]}=e,i=new TextDecoder;return s.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=i.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(o=>{o.fragmentShader=s[o.fragmentShader],o.vertexShader=s[o.vertexShader]}),r.forEach(o=>{o.program=n[o.program]}),r}function lp(e,t){const n=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(s=>{e.uniforms[s].value&&!(s in n)&&(n[s]=e.uniforms[s].value)}),Object.keys(n).forEach(s=>{typeof n[s]=="object"&&n[s].index!==void 0&&(n[s].texture=t.getTexture(n[s].index))}),n}const Qa=[u1,jg,CA,_A,SA,UA,tp,rp,Object.freeze(Object.defineProperty({__proto__:null,decode:op,encode:ap,name:ip},Symbol.toStringTag,{value:"Module"})),XA,R1];function up(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=Qa.filter(i=>Ya(i.name,t));for(const i of s){var r;(r=i.preprocess)===null||r===void 0||r.call(i,e,t,n)}}async function hp(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=Qa.filter(i=>Ya(i.name,t));for(const i of s){var r;await((r=i.decode)===null||r===void 0?void 0:r.call(i,e,t,n))}}function Ya(e,t){var n;const s=(t==null||(n=t.gltf)===null||n===void 0?void 0:n.excludeExtensions)||{};return!(e in s&&!s[e])}const Gr="KHR_binary_glTF";function fp(e){const t=new tt(e),{json:n}=t;for(const s of n.images||[]){const r=t.getObjectExtension(s,Gr);r&&Object.assign(s,r),t.removeObjectExtension(s,Gr)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,t.removeExtension(Gr)}const Za={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},dp={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class mp{constructor(){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}},this.json=void 0}normalize(t,n){this.json=t.json;const s=t.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${s.asset.version}`);return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),fp(t),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const n in Za)this._convertTopLevelObjectToArray(t,n)}_convertTopLevelObjectToArray(t,n){const s=t[n];if(!(!s||Array.isArray(s))){t[n]=[];for(const r in s){const i=s[r];i.id=i.id||r;const o=t[n].length;t[n].push(i),this.idToIndexMap[n][r]=o}}}_convertObjectIdsToArrayIndices(t){for(const n in Za)this._convertIdsToIndices(t,n);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const n of t.textures)this._convertTextureIds(n);for(const n of t.meshes)this._convertMeshIds(n);for(const n of t.nodes)this._convertNodeIds(n);for(const n of t.scenes)this._convertSceneIds(n)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const n of t.primitives){const{attributes:s,indices:r,material:i}=n;for(const o in s)s[o]=this._convertIdToIndex(s[o],"accessor");r&&(n.indices=this._convertIdToIndex(r,"accessor")),i&&(n.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(n=>this._convertIdToIndex(n,"node"))),t.meshes&&(t.meshes=t.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(t,n){t[n]||(console.warn(`gltf v1: json doesn't contain attribute ${n}`),t[n]=[]);for(const s of t[n])for(const r in s){const i=s[r],o=this._convertIdToIndex(i,r);s[r]=o}}_convertIdToIndex(t,n){const s=dp[n];if(s in this.idToIndexMap){const r=this.idToIndexMap[s][t];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${n} with id ${t}`);return r}return t}_updateObjects(t){for(const n of this.json.buffers)delete n.type}_updateMaterial(t){for(const i of t.materials){var n,s,r;i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((n=i.values)===null||n===void 0?void 0:n.tex)||((s=i.values)===null||s===void 0?void 0:s.texture2d_0)||((r=i.values)===null||r===void 0?void 0:r.diffuseTex),a=t.textures.findIndex(c=>c.id===o);a!==-1&&(i.pbrMetallicRoughness.baseColorTexture={index:a})}}}function gp(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new mp().normalize(e,t)}async function Ap(e,t){var n,s,r;let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return pp(e,t,i,o),gp(e,{normalize:o==null||(n=o.gltf)===null||n===void 0?void 0:n.normalize}),up(e,o,a),o!=null&&(s=o.gltf)!==null&&s!==void 0&&s.loadBuffers&&e.json.buffers&&await yp(e,o,a),o!=null&&(r=o.gltf)!==null&&r!==void 0&&r.loadImages&&await Bp(e,o,a),await hp(e,o,a),e}function pp(e,t,n,s){if(s.uri&&(e.baseUri=s.uri),t instanceof ArrayBuffer&&!sA(t,n,s)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=Sg(t);else if(t instanceof ArrayBuffer){const o={};n=rA(o,t,n,s.glb),ft(o.type==="glTF",`Invalid GLB magic string ${o.type}`),e._glb=o,e.json=o.json}else ft(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:o}=e._glb;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const i=e.json.images||[];e.images=new Array(i.length).fill({})}async function yp(e,t,n){const s=e.json.buffers||[];for(let o=0;o<s.length;++o){const a=s[o];if(a.uri){var r,i;const{fetch:c}=n;ft(c);const l=Ka(a.uri,t),u=await(n==null||(r=n.fetch)===null||r===void 0?void 0:r.call(n,l)),h=await(u==null||(i=u.arrayBuffer)===null||i===void 0?void 0:i.call(u));e.buffers[o]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri}else e.buffers[o]===null&&(e.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function Bp(e,t,n){const s=Tp(e),r=e.json.images||[],i=[];for(const o of s)i.push(Ep(e,r[o],o,t,n));return await Promise.all(i)}function Tp(e){const t=new Set,n=e.json.textures||[];for(const s of n)s.source!==void 0&&t.add(s.source);return Array.from(t).sort()}async function Ep(e,t,n,s,r){let i;if(t.uri&&!t.hasOwnProperty("bufferView")){const a=Ka(t.uri,s),{fetch:c}=r;i=await(await c(a)).arrayBuffer(),t.bufferView={data:i}}if(Number.isFinite(t.bufferView)){const a=Gg(e.json,e.buffers,t.bufferView);i=pa(a.buffer,a.byteOffset,a.byteLength)}ft(i,"glTF image has no data");let o=await ga(i,[Cg,X1],{...s,mimeType:t.mimeType,basis:s.basis||{format:ja()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[n]=o}const Zn={name:"glTF",id:"gltf",module:"gltf",version:S1,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Cp,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Cp(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;t={...Zn.options,...t},t.gltf={...Zn.options.gltf,...t.gltf};const{byteOffset:s=0}=t;return await Ap({},e,s,t,n)}const bp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},wp={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},yt={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},_p={magFilter:yt.TEXTURE_MAG_FILTER,minFilter:yt.TEXTURE_MIN_FILTER,wrapS:yt.TEXTURE_WRAP_S,wrapT:yt.TEXTURE_WRAP_T},Mp={[yt.TEXTURE_MAG_FILTER]:yt.LINEAR,[yt.TEXTURE_MIN_FILTER]:yt.NEAREST_MIPMAP_LINEAR,[yt.TEXTURE_WRAP_S]:yt.REPEAT,[yt.TEXTURE_WRAP_T]:yt.REPEAT};function Rp(){return{id:"default-sampler",parameters:Mp}}function Sp(e){return wp[e]}function Ip(e){return bp[e]}class Op{constructor(){this.baseUri="",this.jsonUnprocessed=void 0,this.json=void 0,this.buffers=[],this.images=[]}postProcess(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:s,buffers:r=[],images:i=[]}=t,{baseUri:o=""}=t;return ft(s),this.baseUri=o,this.buffers=r,this.images=i,this.jsonUnprocessed=s,this.json=this._resolveTree(t.json,n),this.json}_resolveTree(t){const n={...t};return this.json=n,t.bufferViews&&(n.bufferViews=t.bufferViews.map((s,r)=>this._resolveBufferView(s,r))),t.images&&(n.images=t.images.map((s,r)=>this._resolveImage(s,r))),t.samplers&&(n.samplers=t.samplers.map((s,r)=>this._resolveSampler(s,r))),t.textures&&(n.textures=t.textures.map((s,r)=>this._resolveTexture(s,r))),t.accessors&&(n.accessors=t.accessors.map((s,r)=>this._resolveAccessor(s,r))),t.materials&&(n.materials=t.materials.map((s,r)=>this._resolveMaterial(s,r))),t.meshes&&(n.meshes=t.meshes.map((s,r)=>this._resolveMesh(s,r))),t.nodes&&(n.nodes=t.nodes.map((s,r)=>this._resolveNode(s,r)),n.nodes=n.nodes.map((s,r)=>this._resolveNodeChildren(s))),t.skins&&(n.skins=t.skins.map((s,r)=>this._resolveSkin(s,r))),t.scenes&&(n.scenes=t.scenes.map((s,r)=>this._resolveScene(s,r))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,n){if(typeof n=="object")return n;const s=t&&t[n];return s||console.warn(`glTF file error: Could not find ${t}[${n}]`),s}_resolveScene(t,n){return{...t,id:t.id||`scene-${n}`,nodes:(t.nodes||[]).map(s=>this.getNode(s))}}_resolveNode(t,n){const s={...t,id:(t==null?void 0:t.id)||`node-${n}`};return t.mesh!==void 0&&(s.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(s.camera=this.getCamera(t.camera)),t.skin!==void 0&&(s.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(s.mesh=t.meshes.reduce((r,i)=>{const o=this.getMesh(i);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),s}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(n=>this.getNode(n))),t}_resolveSkin(t,n){const s=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${n}`,inverseBindMatrices:s}}_resolveMesh(t,n){const s={...t,id:t.id||`mesh-${n}`,primitives:[]};return t.primitives&&(s.primitives=t.primitives.map(r=>{const i={...r,attributes:{},indices:void 0,material:void 0},o=r.attributes;for(const a in o)i.attributes[a]=this.getAccessor(o[a]);return r.indices!==void 0&&(i.indices=this.getAccessor(r.indices)),r.material!==void 0&&(i.material=this.getMaterial(r.material)),i})),s}_resolveMaterial(t,n){const s={...t,id:t.id||`material-${n}`};if(s.normalTexture&&(s.normalTexture={...s.normalTexture},s.normalTexture.texture=this.getTexture(s.normalTexture.index)),s.occlusionTexture&&(s.occlusionTexture={...s.occlusionTexture},s.occlusionTexture.texture=this.getTexture(s.occlusionTexture.index)),s.emissiveTexture&&(s.emissiveTexture={...s.emissiveTexture},s.emissiveTexture.texture=this.getTexture(s.emissiveTexture.index)),s.emissiveFactor||(s.emissiveFactor=s.emissiveTexture?[1,1,1]:[0,0,0]),s.pbrMetallicRoughness){s.pbrMetallicRoughness={...s.pbrMetallicRoughness};const r=s.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return s}_resolveAccessor(t,n){const s=Sp(t.componentType),r=Ip(t.type),i=s*r,o={...t,id:t.id||`accessor-${n}`,bytesPerComponent:s,components:r,bytesPerElement:i,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(o.bufferView=this.getBufferView(t.bufferView)),o.bufferView){const a=o.bufferView.buffer,{ArrayType:c,byteLength:l}=Er(o,o.bufferView),u=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+a.byteOffset;let h=a.arrayBuffer.slice(u,u+l);o.bufferView.byteStride&&(h=this._getValueFromInterleavedBuffer(a,u,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new c(h)}return o}_getValueFromInterleavedBuffer(t,n,s,r,i){const o=new Uint8Array(i*r);for(let a=0;a<i;a++){const c=n+a*s;o.set(new Uint8Array(t.arrayBuffer.slice(c,c+r)),a*r)}return o.buffer}_resolveTexture(t,n){return{...t,id:t.id||`texture-${n}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):Rp(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,n){const s={id:t.id||`sampler-${n}`,...t,parameters:{}};for(const r in s){const i=this._enumSamplerParameter(r);i!==void 0&&(s.parameters[i]=s[r])}return s}_enumSamplerParameter(t){return _p[t]}_resolveImage(t,n){const s={...t,id:t.id||`image-${n}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},r=this.images[n];return r&&(s.image=r),s}_resolveBufferView(t,n){const s=t.buffer,r=this.buffers[s].arrayBuffer;let i=this.buffers[s].byteOffset||0;return t.byteOffset&&(i+=t.byteOffset),{id:`bufferView-${n}`,...t,buffer:this.buffers[s],data:new Uint8Array(r,i,t.byteLength)}}_resolveCamera(t,n){const s={...t,id:t.id||`camera-${n}`};return s.perspective,s.orthographic,s}}function tc(e,t){return new Op().postProcess(e,t)}const Nr={URI:0,EMBEDDED:1};function ec(e,t,n,s){e.rotateYtoZ=!0;const r=(e.byteOffset||0)+(e.byteLength||0)-n;if(r===0)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=s!=null&&s["3d-tiles"]&&s["3d-tiles"].assetGltfUpAxis?s["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=Tf(t,n,r),e.gltfByteOffset=0,e.gltfByteLength=r,n%4===0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function nc(e,t,n,s){const r=(n==null?void 0:n["3d-tiles"])||{};if(xp(e,t),r.loadGLTF){if(!s)return;if(e.gltfUrl){const{fetch:i}=s,o=await i(e.gltfUrl,n);e.gltfArrayBuffer=await o.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){const i=await Us(e.gltfArrayBuffer,Zn,n,s);e.gltf=tc(i),e.gpuMemoryUsageInBytes=Ca(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}function xp(e,t,n){switch(t){case Nr.URI:if(e.gltfArrayBuffer){const s=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=new TextDecoder().decode(s);e.gltfUrl=i.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case Nr.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function vp(e,t,n,s,r){var i;n=Fp(e,t,n,s),await nc(e,Nr.EMBEDDED,s,r);const o=e==null||(i=e.gltf)===null||i===void 0?void 0:i.extensions;return o&&o.CESIUM_RTC&&(e.rtcCenter=o.CESIUM_RTC.center),n}function Fp(e,t,n,s,r){n=Vn(e,t,n),n=hr(e,t,n),n=fr(e,t,n),n=ec(e,t,n,s);const i=new lr(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=i.getGlobalProperty("RTC_CENTER",U.FLOAT,3),n}async function Lp(e,t,n,s,r){return n=Dp(e,t,n,s),await nc(e,e.gltfFormat||0,s,r),n}function Dp(e,t,n,s,r){var i;if(n=Vn(e,t,n),e.version!==1)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);n=hr(e,t,n);const o=new DataView(t);if(e.gltfFormat=o.getUint32(n,!0),n+=4,n=fr(e,t,n),n=ec(e,t,n,s),!(e!=null&&(i=e.header)!==null&&i!==void 0&&i.featureTableJsonByteLength)||e.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new lr(e.featureTableJson,e.featureTableBinary),c=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=a.getGlobalProperty("RTC_CENTER",U.FLOAT,3);const l=new ra(e.batchTableJson,e.batchTableBinary,c);return Gp(e,a,l,c),n}function Gp(e,t,n,s){const r=new Array(s),i=new w;new w,new w,new w;const o=new z,a=new Ys,c=new w,l={},u=new pt,h=[],f=[],d=[],m=[];for(let g=0;g<s;g++){let A;if(t.hasProperty("POSITION"))A=t.getProperty("POSITION",U.FLOAT,3,g,i);else if(t.hasProperty("POSITION_QUANTIZED")){A=t.getProperty("POSITION_QUANTIZED",U.UNSIGNED_SHORT,3,g,i);const B=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",U.FLOAT,3);if(!B)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const F=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",U.FLOAT,3);if(!F)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const v=65535;for(let O=0;O<3;O++)A[O]=A[O]/v*F[O]+B[O]}if(!A)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(i.copy(A),l.translation=i,e.normalUp=t.getProperty("NORMAL_UP",U.FLOAT,3,g,h),e.normalRight=t.getProperty("NORMAL_RIGHT",U.FLOAT,3,g,f),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",U.UNSIGNED_SHORT,2,g,h),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",U.UNSIGNED_SHORT,2,g,f),e.octNormalUp)throw e.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");e.eastNorthUp?(Fn.WGS84.eastNorthUpToFixedFrame(i,u),u.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),l.rotation=a,c.set(1,1,1);const y=t.getProperty("SCALE",U.FLOAT,1,g,d);Number.isFinite(y)&&c.multiplyByScalar(y);const b=t.getProperty("SCALE_NON_UNIFORM",U.FLOAT,3,g,h);b&&c.scale(b),l.scale=c;let E=t.getProperty("BATCH_ID",U.UNSIGNED_SHORT,1,g,m);E===void 0&&(E=g);const C=new pt().fromQuaternion(l.rotation);u.identity(),u.translate(l.translation),u.multiplyRight(C),u.scale(l.scale);const _=u.clone();r[g]={modelMatrix:_,batchId:E}}e.instances=r}async function Np(e,t,n,s,r,i){n=Vn(e,t,n);const o=new DataView(t);for(e.tilesLength=o.getUint32(n,!0),n+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-n>12;){const a={shape:"tile3d"};e.tiles.push(a),n=await i(t,n,s,r,a)}return n}async function Pp(e,t,n,s){var r,i;if(e.rotateYtoZ=!0,e.gltfUpAxis=n!=null&&(r=n["3d-tiles"])!==null&&r!==void 0&&r.assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",n!=null&&(i=n["3d-tiles"])!==null&&i!==void 0&&i.loadGLTF){if(!s)return t.byteLength;const o=await Us(t,Zn,n,s);e.gltf=tc(o),e.gpuMemoryUsageInBytes=Ca(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}async function sc(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{shape:"tile3d"};switch(r.byteOffset=t,r.type=K0(e,t),r.type){case Ve.COMPOSITE:return await Np(r,e,t,n,s,sc);case Ve.BATCHED_3D_MODEL:return await vp(r,e,t,n,s);case Ve.GLTF:return await Pp(r,e,n,s);case Ve.INSTANCED_3D_MODEL:return await Lp(r,e,t,n,s);case Ve.POINT_CLOUD:return await Um(r,e,t,n,s);default:throw new Error(`3DTileLoader: unknown type ${r.type}`)}}const Up=1952609651,Hp=1;async function kp(e,t,n){if(new Uint32Array(e.slice(0,4))[0]!==Up)throw new Error("Wrong subtree file magic number");if(new Uint32Array(e.slice(4,8))[0]!==Hp)throw new Error("Wrong subtree file verson, must be 1");const i=rc(e.slice(8,16)),o=new Uint8Array(e,24,i),c=new TextDecoder("utf8").decode(o),l=JSON.parse(c),u=rc(e.slice(16,24));let h=new ArrayBuffer(0);if(u&&(h=e.slice(24+i)),await ts(l,l.tileAvailability,h,n),Array.isArray(l.contentAvailability))for(const f of l.contentAvailability)await ts(l,f,h,n);else await ts(l,l.contentAvailability,h,n);return await ts(l,l.childSubtreeAvailability,h,n),l}async function ts(e,t,n,s){const r=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if(typeof r!="number")return;const i=e.bufferViews[r],o=e.buffers[i.buffer];if(!(s!=null&&s.baseUrl))throw new Error("Url is not provided");if(!s.fetch)throw new Error("fetch is not provided");if(o.uri){const c=`${(s==null?void 0:s.baseUrl)||""}/${o.uri}`,u=await(await s.fetch(c)).arrayBuffer();t.explicitBitstream=new Uint8Array(u,i.byteOffset,i.byteLength);return}const a=e.buffers.slice(0,i.buffer).reduce((c,l)=>c+l.byteLength,0);t.explicitBitstream=new Uint8Array(n.slice(a,a+o.byteLength),i.byteOffset,i.byteLength)}function rc(e){const t=new DataView(e),n=t.getUint32(0,!0),s=t.getUint32(4,!0);return n+2**32*s}const ic={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:Ko,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:kp,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Bt=null;try{Bt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function $(e,t,n){this.low=e|0,this.high=t|0,this.unsigned=!!n}$.prototype.__isLong__,Object.defineProperty($.prototype,"__isLong__",{value:!0});function et(e){return(e&&e.__isLong__)===!0}function oc(e){var t=Math.clz32(e&-e);return e?31-t:t}$.isLong=et;var ac={},cc={};function ae(e,t){var n,s,r;return t?(e>>>=0,(r=0<=e&&e<256)&&(s=cc[e],s)?s:(n=H(e,0,!0),r&&(cc[e]=n),n)):(e|=0,(r=-128<=e&&e<128)&&(s=ac[e],s)?s:(n=H(e,e<0?-1:0,!1),r&&(ac[e]=n),n))}$.fromInt=ae;function Tt(e,t){if(isNaN(e))return t?$t:Mt;if(t){if(e<0)return $t;if(e>=uc)return gc}else{if(e<=-hc)return ct;if(e+1>=hc)return mc}return e<0?Tt(-e,t).neg():H(e%be|0,e/be|0,t)}$.fromNumber=Tt;function H(e,t,n){return new $(e,t,n)}$.fromBits=H;var es=Math.pow;function Pr(e,t,n){if(e.length===0)throw Error("empty string");if(typeof t=="number"?(n=t,t=!1):t=!!t,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t?$t:Mt;if(n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=e.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return Pr(e.substring(1),t,n).neg();for(var r=Tt(es(n,8)),i=Mt,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+a),n);if(a<8){var l=Tt(es(n,a));i=i.mul(l).add(Tt(c))}else i=i.mul(r),i=i.add(Tt(c))}return i.unsigned=t,i}$.fromString=Pr;function _t(e,t){return typeof e=="number"?Tt(e,t):typeof e=="string"?Pr(e,t):H(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}$.fromValue=_t;var lc=65536,$p=1<<24,be=lc*lc,uc=be*be,hc=uc/2,fc=ae($p),Mt=ae(0);$.ZERO=Mt;var $t=ae(0,!0);$.UZERO=$t;var we=ae(1);$.ONE=we;var dc=ae(1,!0);$.UONE=dc;var Ur=ae(-1);$.NEG_ONE=Ur;var mc=H(-1,2147483647,!1);$.MAX_VALUE=mc;var gc=H(-1,-1,!0);$.MAX_UNSIGNED_VALUE=gc;var ct=H(0,-2147483648,!1);$.MIN_VALUE=ct;var M=$.prototype;M.toInt=function(){return this.unsigned?this.low>>>0:this.low},M.toNumber=function(){return this.unsigned?(this.high>>>0)*be+(this.low>>>0):this.high*be+(this.low>>>0)},M.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ct)){var n=Tt(t),s=this.div(n),r=s.mul(n).sub(this);return s.toString(t)+r.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var i=Tt(es(t,6),this.unsigned),o=this,a="";;){var c=o.div(i),l=o.sub(c.mul(i)).toInt()>>>0,u=l.toString(t);if(o=c,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},M.getHighBits=function(){return this.high},M.getHighBitsUnsigned=function(){return this.high>>>0},M.getLowBits=function(){return this.low},M.getLowBitsUnsigned=function(){return this.low>>>0},M.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ct)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,n=31;n>0&&!(t&1<<n);n--);return this.high!=0?n+33:n+1},M.isZero=function(){return this.high===0&&this.low===0},M.eqz=M.isZero,M.isNegative=function(){return!this.unsigned&&this.high<0},M.isPositive=function(){return this.unsigned||this.high>=0},M.isOdd=function(){return(this.low&1)===1},M.isEven=function(){return(this.low&1)===0},M.equals=function(t){return et(t)||(t=_t(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},M.eq=M.equals,M.notEquals=function(t){return!this.eq(t)},M.neq=M.notEquals,M.ne=M.notEquals,M.lessThan=function(t){return this.comp(t)<0},M.lt=M.lessThan,M.lessThanOrEqual=function(t){return this.comp(t)<=0},M.lte=M.lessThanOrEqual,M.le=M.lessThanOrEqual,M.greaterThan=function(t){return this.comp(t)>0},M.gt=M.greaterThan,M.greaterThanOrEqual=function(t){return this.comp(t)>=0},M.gte=M.greaterThanOrEqual,M.ge=M.greaterThanOrEqual,M.compare=function(t){if(et(t)||(t=_t(t)),this.eq(t))return 0;var n=this.isNegative(),s=t.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},M.comp=M.compare,M.negate=function(){return!this.unsigned&&this.eq(ct)?ct:this.not().add(we)},M.neg=M.negate,M.add=function(t){et(t)||(t=_t(t));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=t.high>>>16,a=t.high&65535,c=t.low>>>16,l=t.low&65535,u=0,h=0,f=0,d=0;return d+=i+l,f+=d>>>16,d&=65535,f+=r+c,h+=f>>>16,f&=65535,h+=s+a,u+=h>>>16,h&=65535,u+=n+o,u&=65535,H(f<<16|d,u<<16|h,this.unsigned)},M.subtract=function(t){return et(t)||(t=_t(t)),this.add(t.neg())},M.sub=M.subtract,M.multiply=function(t){if(this.isZero())return this;if(et(t)||(t=_t(t)),Bt){var n=Bt.mul(this.low,this.high,t.low,t.high);return H(n,Bt.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?$t:Mt;if(this.eq(ct))return t.isOdd()?ct:Mt;if(t.eq(ct))return this.isOdd()?ct:Mt;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(fc)&&t.lt(fc))return Tt(this.toNumber()*t.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=t.high>>>16,c=t.high&65535,l=t.low>>>16,u=t.low&65535,h=0,f=0,d=0,m=0;return m+=o*u,d+=m>>>16,m&=65535,d+=i*u,f+=d>>>16,d&=65535,d+=o*l,f+=d>>>16,d&=65535,f+=r*u,h+=f>>>16,f&=65535,f+=i*l,h+=f>>>16,f&=65535,f+=o*c,h+=f>>>16,f&=65535,h+=s*u+r*l+i*c+o*a,h&=65535,H(d<<16|m,h<<16|f,this.unsigned)},M.mul=M.multiply,M.divide=function(t){if(et(t)||(t=_t(t)),t.isZero())throw Error("division by zero");if(Bt){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var n=(this.unsigned?Bt.div_u:Bt.div_s)(this.low,this.high,t.low,t.high);return H(n,Bt.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?$t:Mt;var s,r,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return $t;if(t.gt(this.shru(1)))return dc;i=$t}else{if(this.eq(ct)){if(t.eq(we)||t.eq(Ur))return ct;if(t.eq(ct))return we;var o=this.shr(1);return s=o.div(t).shl(1),s.eq(Mt)?t.isNegative()?we:Ur:(r=this.sub(t.mul(s)),i=s.add(r.div(t)),i)}else if(t.eq(ct))return this.unsigned?$t:Mt;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=Mt}for(r=this;r.gte(t);){s=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:es(2,a-48),l=Tt(s),u=l.mul(t);u.isNegative()||u.gt(r);)s-=c,l=Tt(s,this.unsigned),u=l.mul(t);l.isZero()&&(l=we),i=i.add(l),r=r.sub(u)}return i},M.div=M.divide,M.modulo=function(t){if(et(t)||(t=_t(t)),Bt){var n=(this.unsigned?Bt.rem_u:Bt.rem_s)(this.low,this.high,t.low,t.high);return H(n,Bt.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},M.mod=M.modulo,M.rem=M.modulo,M.not=function(){return H(~this.low,~this.high,this.unsigned)},M.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},M.clz=M.countLeadingZeros,M.countTrailingZeros=function(){return this.low?oc(this.low):oc(this.high)+32},M.ctz=M.countTrailingZeros,M.and=function(t){return et(t)||(t=_t(t)),H(this.low&t.low,this.high&t.high,this.unsigned)},M.or=function(t){return et(t)||(t=_t(t)),H(this.low|t.low,this.high|t.high,this.unsigned)},M.xor=function(t){return et(t)||(t=_t(t)),H(this.low^t.low,this.high^t.high,this.unsigned)},M.shiftLeft=function(t){return et(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?H(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):H(0,this.low<<t-32,this.unsigned)},M.shl=M.shiftLeft,M.shiftRight=function(t){return et(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?H(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):H(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},M.shr=M.shiftRight,M.shiftRightUnsigned=function(t){return et(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?H(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?H(this.high,0,this.unsigned):H(this.high>>>t-32,0,this.unsigned)},M.shru=M.shiftRightUnsigned,M.shr_u=M.shiftRightUnsigned,M.rotateLeft=function(t){var n;return et(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?H(this.high,this.low,this.unsigned):t<32?(n=32-t,H(this.low<<t|this.high>>>n,this.high<<t|this.low>>>n,this.unsigned)):(t-=32,n=32-t,H(this.high<<t|this.low>>>n,this.low<<t|this.high>>>n,this.unsigned))},M.rotl=M.rotateLeft,M.rotateRight=function(t){var n;return et(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?H(this.high,this.low,this.unsigned):t<32?(n=32-t,H(this.high<<n|this.low>>>t,this.low<<n|this.high>>>t,this.unsigned)):(t-=32,n=32-t,H(this.low<<n|this.high>>>t,this.high<<n|this.low>>>t,this.unsigned))},M.rotr=M.rotateRight,M.toSigned=function(){return this.unsigned?H(this.low,this.high,!1):this},M.toUnsigned=function(){return this.unsigned?this:H(this.low,this.high,!0)},M.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},M.toBytesLE=function(){var t=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},M.toBytesBE=function(){var t=this.high,n=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,n>>>24,n>>>16&255,n>>>8&255,n&255]},$.fromBytes=function(t,n,s){return s?$.fromBytesLE(t,n):$.fromBytesBE(t,n)},$.fromBytesLE=function(t,n){return new $(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)},$.fromBytesBE=function(t,n){return new $(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)};const Vp=16;function Ac(e){e==="X"&&(e="");const t=e.padEnd(Vp,"0");return $.fromString(t,!0,16)}function Jp(e){if(e.isZero())return"X";let t=e.countTrailingZeros();const n=t%4;t=(t-n)/4;const s=t;t*=4;const i=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-s-i.length).join("0")+i}function Wp(e,t){const n=jp(e).shiftRightUnsigned(2);return e.add($.fromNumber(2*t+1-4).multiply(n))}function jp(e){return e.and(e.not().add(1))}const zp=3,Kp=2*30+1,pc=180/Math.PI;function qp(e){if(e.length===0)throw new Error(`Invalid Hilbert quad key ${e}`);const t=e.split("/"),n=parseInt(t[0],10),s=t[1],r=s.length;let i=0;const o=[0,0];for(let a=r-1;a>=0;a--){i=r-a;const c=s[a];let l=0,u=0;c==="1"?u=1:c==="2"?(l=1,u=1):c==="3"&&(l=1);const h=Math.pow(2,i-1);Qp(h,o,l,u),o[0]+=h*l,o[1]+=h*u}if(n%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:n,ij:o,level:i}}function Xp(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<zp+Kp;)t="0"+t;const n=t.lastIndexOf("1"),s=t.substring(0,3),r=t.substring(3,n),i=r.length/2,o=$.fromString(s,!0,2).toString(10);let a="";if(i!==0)for(a=$.fromString(r,!0,2).toString(4);a.length<i;)a="0"+a;return`${o}/${a}`}function yc(e,t,n){const s=1<<t;return[(e[0]+n[0])/s,(e[1]+n[1])/s]}function Bc(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function Tc(e){return[Bc(e[0]),Bc(e[1])]}function Ec(e,t){let[n,s]=t;switch(e){case 0:return[1,n,s];case 1:return[-n,1,s];case 2:return[-n,-s,1];case 3:return[-1,-s,-n];case 4:return[s,-1,-n];case 5:return[s,n,-1];default:throw new Error("Invalid face")}}function Cc(e){let[t,n,s]=e;const r=Math.atan2(s,Math.sqrt(t*t+n*n));return[Math.atan2(n,t)*pc,r*pc]}function Qp(e,t,n,s){if(s===0){n===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}function Yp(e){const t=yc(e.ij,e.level,[.5,.5]),n=Tc(t),s=Ec(e.face,n);return Cc(s)}const Zp=100;function bc(e){const{face:t,ij:n,level:s}=e,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(Zp*Math.pow(2,-s))),o=new Float64Array(4*i*2+2);let a=0,c=0;for(let l=0;l<4;l++){const u=r[l].slice(0),h=r[l+1],f=(h[0]-u[0])/i,d=(h[1]-u[1])/i;for(let m=0;m<i;m++){u[0]+=f,u[1]+=d;const g=yc(n,s,u),A=Tc(g),y=Ec(t,A),b=Cc(y);Math.abs(b[1])>89.999&&(b[0]=c);const E=b[0]-c;b[0]+=E>180?-360:E<-180?360:0,o[a++]=b[0],o[a++]=b[1],c=b[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Hr(e){const t=ty(e);return qp(t)}function ty(e){if(e.indexOf("/")>0)return e;const t=Ac(e);return Xp(t)}function ey(e){const t=Hr(e);return Yp(t)}function ny(e){let t;if(e.face===2||e.face===5){let n=null,s=0;for(let r=0;r<4;r++){const i=`${e.face}/${r}`,o=Hr(i),a=bc(o);(typeof n>"u"||n===null)&&(n=new Float64Array(4*a.length)),n.set(a,s),s+=a.length}t=wc(n)}else{const n=bc(e);t=wc(n)}return t}function wc(e){if(e.length%2!==0)throw new Error("Invalid corners");const t=[],n=[];for(let s=0;s<e.length;s+=2)t.push(e[s]),n.push(e[s+1]);return t.sort((s,r)=>s-r),n.sort((s,r)=>s-r),{west:t[0],east:t[t.length-1],north:n[n.length-1],south:n[0]}}function sy(e,t){const n=(t==null?void 0:t.minimumHeight)||0,s=(t==null?void 0:t.maximumHeight)||0,r=Hr(e),i=ny(r),o=i.west,a=i.south,c=i.east,l=i.north,u=[];return u.push(new w(o,l,n)),u.push(new w(c,l,n)),u.push(new w(c,a,n)),u.push(new w(o,a,n)),u.push(new w(o,l,s)),u.push(new w(c,l,s)),u.push(new w(c,a,s)),u.push(new w(o,a,s)),u}function _c(e){const t=e.token,n={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},s=sy(t,n),r=ey(t),i=r[0],o=r[1],a=Fn.WGS84.cartographicToCartesian([i,o,n.maximumHeight]),c=new w(a[0],a[1],a[2]);s.push(c);const l=j0(s);return[...l.center,...l.halfAxes]}const ry={QUADTREE:4,OCTREE:8};function iy(e,t,n){if(e!=null&&e.box){const s=Ac(e.s2VolumeInfo.token),r=Wp(s,t),i=Jp(r),o={...e.s2VolumeInfo};switch(o.token=i,n){case"OCTREE":const l=e.s2VolumeInfo,u=l.maximumHeight-l.minimumHeight,h=u/2,f=l.minimumHeight+u/2;l.minimumHeight=f-h,l.maximumHeight=f+h;break}return{box:_c(o),s2VolumeInfo:o}}}async function Mc(e){const{implicitOptions:t,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:s=0,s2VolumeBox:r,loaderOptions:i}=e;let{subtree:o,level:a=0,globalData:c={level:0,mortonIndex:0,x:0,y:0,z:0}}=e;const{subdivisionScheme:l,subtreeLevels:u,maximumLevel:h,contentUrlTemplate:f,subtreesUriTemplate:d,basePath:m}=t,g={children:[],lodMetricValue:0,contentUrl:""};if(!h)return Zi.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${f} won't be loaded...`),g;const A=a+c.level;if(A>h)return g;const y=ry[l],b=Math.log2(y),E=s&1,C=s>>1&1,_=s>>2&1,B=(y**a-1)/(y-1);let F=ce(n.mortonIndex,s,b),v=B+F,O=ce(n.x,E,1),x=ce(n.y,C,1),D=ce(n.z,_,1),N=!1;a>=u&&(N=kr(o.childSubtreeAvailability,F));const G=ce(c.x,O,a),S=ce(c.y,x,a),j=ce(c.z,D,a);if(N){const zt=`${m}/${d}`,ge=$r(zt,A,G,S,j);o=await Ps(ge,ic,i),c={mortonIndex:F,x:O,y:x,z:D,level:a},F=0,v=0,O=0,x=0,D=0,a=0}if(!kr(o.tileAvailability,v))return g;kr(o.contentAvailability,v)&&(g.contentUrl=$r(f,A,G,S,j));const gt=a+1,Ht={mortonIndex:F,x:O,y:x,z:D};for(let zt=0;zt<y;zt++){const ge=iy(r,zt,l),ee=await Mc({subtree:o,implicitOptions:t,loaderOptions:i,parentData:Ht,childIndex:zt,level:gt,globalData:{...c},s2VolumeBox:ge});if(ee.contentUrl||ee.children.length){const R=A+1,K=oy(ee,R,{childTileX:O,childTileY:x,childTileZ:D},t,r);g.children.push(K)}}return g}function kr(e,t){let n;return Array.isArray(e)?(n=e[0],e.length>1&&Zi.once('Not supported extension "3DTILES_multiple_contents" has been detected')):n=e,"constant"in n?!!n.constant:n.explicitBitstream?ly(t,n.explicitBitstream):!1}function oy(e,t,n,s,r){const{basePath:i,refine:o,getRefine:a,lodMetricType:c,getTileType:l,rootLodMetricValue:u,rootBoundingVolume:h}=s,f=e.contentUrl&&e.contentUrl.replace(`${i}/`,""),d=u/2**t,m=r!=null&&r.box?{box:r.box}:h,g=ay(t,m,n);return{children:e.children,contentUrl:e.contentUrl,content:{uri:f},id:e.contentUrl,refine:a(o),type:l(e),lodMetricType:c,lodMetricValue:d,geometricError:d,transform:e.transform,boundingVolume:g}}function ay(e,t,n){if(t.region){const{childTileX:s,childTileY:r,childTileZ:i}=n,[o,a,c,l,u,h]=t.region,f=2**e,d=(c-o)/f,m=(l-a)/f,g=(h-u)/f,[A,y]=[o+d*s,o+d*(s+1)],[b,E]=[a+m*r,a+m*(r+1)],[C,_]=[u+g*i,u+g*(i+1)];return{region:[A,b,y,E,C,_]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${t}`)}function ce(e,t,n){return(e<<n)+t}function $r(e,t,n,s,r){const i=cy({level:t,x:n,y:s,z:r});return e.replace(/{level}|{x}|{y}|{z}/gi,o=>i[o])}function cy(e){const t={};for(const n in e)t[`{${n}}`]=e[n];return t}function ly(e,t){const n=Math.floor(e/8),s=e%8;return(t[n]>>s&1)===1}function Vr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(!t)return Hn.EMPTY;const s=t.split("?")[0].split(".").pop();switch(s){case"pnts":return Hn.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Hn.SCENEGRAPH;default:return s||Hn.EMPTY}}function Jr(e){switch(e){case"REPLACE":case"replace":return zo.REPLACE;case"ADD":case"add":return zo.ADD;default:return e}}function Wr(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const s=new URL(e,`${t}/`);return decodeURI(s.toString())}else if(e.startsWith("/"))return e;return bf(t,e)}function Rc(e,t){if(!e)return null;let n;if(e.content){var s;const i=e.content.uri||((s=e.content)===null||s===void 0?void 0:s.url);typeof i<"u"&&(n=Wr(i,t))}return{...e,id:n,contentUrl:n,lodMetricType:kn.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:Vr(e,n),refine:Jr(e.refine)}}async function uy(e,t,n){let s=null;const r=Ic(e.root);r&&e.root?s=await Sc(e.root,e,t,r,n):s=Rc(e.root,t);const i=[];for(i.push(s);i.length>0;){const o=i.pop()||{},a=o.children||[],c=[];for(const l of a){const u=Ic(l);let h;u?h=await Sc(l,e,t,u,n):h=Rc(l,t),h&&(c.push(h),i.push(h))}o.children=c}return s}async function Sc(e,t,n,s,r){var i,o,a;const{subdivisionScheme:c,maximumLevel:l,availableLevels:u,subtreeLevels:h,subtrees:{uri:f}}=s,d=$r(f,0,0,0,0),m=Wr(d,n),g=await Ps(m,ic,r),A=(i=e.content)===null||i===void 0?void 0:i.uri,y=A?Wr(A,n):"",b=t==null||(o=t.root)===null||o===void 0?void 0:o.refine,E=e.geometricError,C=(a=e.boundingVolume.extensions)===null||a===void 0?void 0:a["3DTILES_bounding_volume_S2"];if(C){const v={box:_c(C),s2VolumeInfo:C};e.boundingVolume=v}const _=e.boundingVolume,B={contentUrlTemplate:y,subtreesUriTemplate:f,subdivisionScheme:c,subtreeLevels:h,maximumLevel:Number.isFinite(u)?u-1:l,refine:b,basePath:n,lodMetricType:kn.GEOMETRIC_ERROR,rootLodMetricValue:E,rootBoundingVolume:_,getTileType:Vr,getRefine:Jr};return await hy(e,n,g,B,r)}async function hy(e,t,n,s,r){if(!e)return null;const{children:i,contentUrl:o}=await Mc({subtree:n,implicitOptions:s,loaderOptions:r});let a,c=null;return o&&(a=o,c={uri:o.replace(`${t}/`,"")}),{...e,id:a,contentUrl:a,lodMetricType:kn.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:Vr(e,a),refine:Jr(e.refine),content:c||e.content,children:i}}function Ic(e){var t;return(e==null||(t=e.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(e==null?void 0:e.implicitTiling)}const en={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:Ko,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:fy,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function fy(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=t["3d-tiles"]||{};let r;return s.isTileset==="auto"?r=(n==null?void 0:n.url)&&n.url.indexOf(".json")!==-1:r=s.isTileset,r?dy(e,t,n):my(e,t,n)}async function dy(e,t,n){var s;const r=JSON.parse(new TextDecoder().decode(e)),i=(n==null?void 0:n.url)||"",o=gy(i),a=await uy(r,o,t||{});return{...r,shape:"tileset3d",loader:en,url:i,queryString:(n==null?void 0:n.queryString)||"",basePath:o,root:a||r.root,type:z0.TILES3D,lodMetricType:kn.GEOMETRIC_ERROR,lodMetricValue:((s=r.root)===null||s===void 0?void 0:s.geometricError)||0}}async function my(e,t,n){const s={content:{shape:"tile3d",featureIds:null}};return await sc(e,0,t,n,s.content),s.content}function gy(e){return Cf(e)}const Oc="https://api.cesium.com/v1/assets";async function Ay(e,t){if(!t){const i=await py(e);for(const o of i.items)o.type==="3DTILES"&&(t=o.id)}const n=await yy(e,t),{type:s,url:r}=n;return it(s==="3DTILES"&&r),n.headers={Authorization:`Bearer ${n.accessToken}`},n}async function py(e){it(e);const t=Oc,n={Authorization:`Bearer ${e}`},s=await Fe(t,{headers:n});if(!s.ok)throw new Error(s.statusText);return await s.json()}async function yy(e,t){it(e,t);const n={Authorization:`Bearer ${e}`},s=`${Oc}/${t}`;let r=await Fe(`${s}`,{headers:n});if(!r.ok)throw new Error(r.statusText);let i=await r.json();if(r=await Fe(`${s}/endpoint`,{headers:n}),!r.ok)throw new Error(r.statusText);const o=await r.json();return i={...i,...o},i}async function By(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=t["cesium-ion"]||{};const{accessToken:n}=t;let s=t.assetId;if(!Number.isFinite(s)){const r=e.match(/\/([0-9]+)\/tileset.json/);s=r&&r[1]}return Ay(n,s)}const xc={...en,id:"cesium-ion",name:"Cesium Ion",preload:By,parse:async(e,t,n)=>(t={...t},t["3d-tiles"]=t["cesium-ion"],t.loader=xc,en.parse(e,t,n)),options:{"cesium-ion":{...en.options["3d-tiles"],accessToken:null}}},Ty=1/Math.PI*180,Ey=1/180*Math.PI,Cy={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Cy}};const Z=globalThis.mathgl.config;function by(e,{precision:t=Z.precision}={}){return e=Ry(e),"".concat(parseFloat(e.toPrecision(t)))}function _e(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function wy(e){return My(e)}function _y(e){return Rt(e)}function My(e,t){return vc(e,n=>n*Ey,t)}function Rt(e,t){return vc(e,n=>n*Ty,t)}function Yt(e,t,n){const s=Z.EPSILON;n&&(Z.EPSILON=n);try{if(e===t)return!0;if(_e(e)&&_e(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!Yt(e[r],t[r]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=Z.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{Z.EPSILON=s}}function Ry(e){return Math.round(e/Z.EPSILON)*Z.EPSILON}function Sy(e){return e.clone?e.clone():new Array(e.length)}function vc(e,t,n){if(_e(e)){const s=e;n=n||Sy(s);for(let r=0;r<n.length&&r<s.length;++r){const i=typeof e=="number"?e:e[r];n[r]=t(i,r,n)}return n}return t(e)}function Iy(e){function t(){var n=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}class jr extends Iy(Array){clone(){return new this.constructor().copy(this)}fromArray(t,n=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=t[s+n];return this.check()}toArray(t=[],n=0){for(let s=0;s<this.ELEMENTS;++s)t[n+s]=this[s];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:_e(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Z)}formatString(t){let n="";for(let s=0;s<this.ELEMENTS;++s)n+=(s>0?", ":"")+by(this[s],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Yt(this[n],t[n]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==t[n])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,n,s){if(s===void 0)return this.lerp(this,t,n);for(let r=0;r<this.ELEMENTS;++r){const i=t[r],o=typeof n=="number"?n:n[r];this[r]=i+s*(o-i)}return this.check()}min(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(t[n],this[n]);return this.check()}max(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(t[n],this[n]);return this.check()}clamp(t,n){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t[s]),n[s]);return this.check()}add(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=n[s];return this.check()}subtract(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=n[s];return this.check()}scale(t){if(typeof t=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;else for(let n=0;n<this.ELEMENTS&&n<t.length;++n)this[n]*=t[n];return this.check()}multiplyByScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}check(){if(Z.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)t=t&&Number.isFinite(this[n]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=t;return this.check()}addScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,n){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t),n);return this.check()}get elements(){return this}}function Oy(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}function V(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(JSON.stringify(e)));return e}function nn(e,t,n=""){if(Z.debug&&!Oy(e,t))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return e}function St(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}class Fc extends jr{get x(){return this[0]}set x(t){this[0]=V(t)}get y(){return this[1]}set y(t){this[1]=V(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*this[n];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let n=0;for(let s=0;s<this.ELEMENTS;++s){const r=this[s]-t[s];n+=r*r}return V(n)}dot(t){let n=0;for(let s=0;s<this.ELEMENTS;++s)n+=this[s]*t[s];return V(n)}normalize(){const t=this.magnitude();if(t!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t;return this.check()}multiply(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=n[s];return this.check()}divide(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=n[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return St(t>=0&&t<this.ELEMENTS,"index is out of range"),V(this[t])}setComponent(t,n){return St(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=n,this.check()}addVectors(t,n){return this.copy(t).add(n)}subVectors(t,n){return this.copy(t).subtract(n)}multiplyVectors(t,n){return this.copy(t).multiply(n)}addScaledVector(t,n){return this.add(new this.constructor(t).multiplyScalar(n))}}const sn=1e-6;let It=typeof Float32Array<"u"?Float32Array:Array;function xy(){const e=new It(2);return It!=Float32Array&&(e[0]=0,e[1]=0),e}function vy(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[3]*r+n[6],e[1]=n[1]*s+n[4]*r+n[7],e}function Fy(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[4]*r+n[12],e[1]=n[1]*s+n[5]*r+n[13],e}(function(){const e=xy();return function(t,n,s,r,i,o){let a,c;for(n||(n=2),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],i(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}})();function Ly(e,t,n){const s=t[0],r=t[1],i=n[3]*s+n[7]*r||1;return e[0]=(n[0]*s+n[4]*r)/i,e[1]=(n[1]*s+n[5]*r)/i,e}function Lc(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[3]*s+n[7]*r+n[11]*i||1;return e[0]=(n[0]*s+n[4]*r+n[8]*i)/o,e[1]=(n[1]*s+n[5]*r+n[9]*i)/o,e[2]=(n[2]*s+n[6]*r+n[10]*i)/o,e}function Dy(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e[2]=t[2],e}function Gy(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e[2]=t[2],e[3]=t[3],e}function Dc(e,t,n){const s=t[0],r=t[1],i=t[2];return e[0]=n[0]*s+n[3]*r+n[6]*i,e[1]=n[1]*s+n[4]*r+n[7]*i,e[2]=n[2]*s+n[5]*r+n[8]*i,e[3]=t[3],e}function Gc(){const e=new It(3);return It!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Nc(e){const t=e[0],n=e[1],s=e[2];return Math.sqrt(t*t+n*n+s*s)}function Pc(e,t,n){const s=new It(3);return s[0]=e,s[1]=t,s[2]=n,s}function Ny(e,t){const n=t[0],s=t[1],r=t[2];let i=n*n+s*s+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function zr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ns(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[0],a=n[1],c=n[2];return e[0]=r*c-i*a,e[1]=i*o-s*c,e[2]=s*a-r*o,e}function Kr(e,t,n){const s=t[0],r=t[1],i=t[2];let o=n[3]*s+n[7]*r+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*s+n[4]*r+n[8]*i+n[12])/o,e[1]=(n[1]*s+n[5]*r+n[9]*i+n[13])/o,e[2]=(n[2]*s+n[6]*r+n[10]*i+n[14])/o,e}function Uc(e,t,n){const s=t[0],r=t[1],i=t[2];return e[0]=s*n[0]+r*n[3]+i*n[6],e[1]=s*n[1]+r*n[4]+i*n[7],e[2]=s*n[2]+r*n[5]+i*n[8],e}function Hc(e,t,n){const s=n[0],r=n[1],i=n[2],o=n[3],a=t[0],c=t[1],l=t[2];let u=r*l-i*c,h=i*a-s*l,f=s*c-r*a,d=r*f-i*h,m=i*u-s*f,g=s*h-r*u;const A=o*2;return u*=A,h*=A,f*=A,d*=2,m*=2,g*=2,e[0]=a+u+d,e[1]=c+h+m,e[2]=l+f+g,e}function Py(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[0],i[1]=r[1]*Math.cos(s)-r[2]*Math.sin(s),i[2]=r[1]*Math.sin(s)+r[2]*Math.cos(s),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Uy(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[2]*Math.sin(s)+r[0]*Math.cos(s),i[1]=r[1],i[2]=r[2]*Math.cos(s)-r[0]*Math.sin(s),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Hy(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[0]*Math.cos(s)-r[1]*Math.sin(s),i[1]=r[0]*Math.sin(s)+r[1]*Math.cos(s),i[2]=r[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function ky(e,t){const n=e[0],s=e[1],r=e[2],i=t[0],o=t[1],a=t[2],c=Math.sqrt((n*n+s*s+r*r)*(i*i+o*o+a*a)),l=c&&zr(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}const $y=Nc;(function(){const e=Gc();return function(t,n,s,r,i,o){let a,c;for(n||(n=3),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();const qr=[0,0,0];let ss;class T extends Fc{static get ZERO(){return ss||(ss=new T(0,0,0),Object.freeze(ss)),ss}constructor(t=0,n=0,s=0){super(-0,-0,-0),arguments.length===1&&_e(t)?this.copy(t):(Z.debug&&(V(t),V(n),V(s)),this[0]=t,this[1]=n,this[2]=s)}set(t,n,s){return this[0]=t,this[1]=n,this[2]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Z.debug&&(V(t.x),V(t.y),V(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=V(t)}angle(t){return ky(this,t)}cross(t){return ns(this,this,t),this.check()}rotateX({radians:t,origin:n=qr}){return Py(this,this,n,t),this.check()}rotateY({radians:t,origin:n=qr}){return Uy(this,this,n,t),this.check()}rotateZ({radians:t,origin:n=qr}){return Hy(this,this,n,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Kr(this,this,t),this.check()}transformAsVector(t){return Lc(this,this,t),this.check()}transformByMatrix3(t){return Uc(this,this,t),this.check()}transformByMatrix2(t){return Dy(this,this,t),this.check()}transformByQuaternion(t){return Hc(this,this,t),this.check()}}let rs;class Xr extends Fc{static get ZERO(){return rs||(rs=new Xr(0,0,0,0),Object.freeze(rs)),rs}constructor(t=0,n=0,s=0,r=0){super(-0,-0,-0,-0),_e(t)&&arguments.length===1?this.copy(t):(Z.debug&&(V(t),V(n),V(s),V(r)),this[0]=t,this[1]=n,this[2]=s,this[3]=r)}set(t,n,s,r){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return Z.debug&&(V(t.x),V(t.y),V(t.z),V(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=V(t)}get w(){return this[3]}set w(t){this[3]=V(t)}transform(t){return Kr(this,this,t),this.check()}transformByMatrix3(t){return Dc(this,this,t),this.check()}transformByMatrix2(t){return Gy(this,this,t),this.check()}transformByQuaternion(t){return Hc(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class kc extends jr{toString(){let t="[";if(Z.printRowMajor){t+="row-major:";for(let n=0;n<this.RANK;++n)for(let s=0;s<this.RANK;++s)t+=" ".concat(this[s*this.RANK+n])}else{t+="column-major:";for(let n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+="]",t}getElementIndex(t,n){return n*this.RANK+t}getElement(t,n){return this[n*this.RANK+t]}setElement(t,n,s){return this[n*this.RANK+t]=V(s),this}getColumn(t,n=new Array(this.RANK).fill(-0)){const s=t*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[s+r];return n}setColumn(t,n){const s=t*this.RANK;for(let r=0;r<this.RANK;++r)this[s+r]=n[r];return this}}function Vy(){const e=new It(9);return It!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Jy(e,t){if(e===t){const n=t[1],s=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=s,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Wy(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=u*o-a*l,f=-u*i+a*c,d=l*i-o*c;let m=n*h+s*f+r*d;return m?(m=1/m,e[0]=h*m,e[1]=(-u*s+r*l)*m,e[2]=(a*s-r*o)*m,e[3]=f*m,e[4]=(u*n-r*c)*m,e[5]=(-a*n+r*i)*m,e[6]=d*m,e[7]=(-l*n+s*c)*m,e[8]=(o*n-s*i)*m,e):null}function jy(e){const t=e[0],n=e[1],s=e[2],r=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8];return t*(l*i-o*c)+n*(-l*r+o*a)+s*(c*r-i*a)}function $c(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=n[0],d=n[1],m=n[2],g=n[3],A=n[4],y=n[5],b=n[6],E=n[7],C=n[8];return e[0]=f*s+d*o+m*l,e[1]=f*r+d*a+m*u,e[2]=f*i+d*c+m*h,e[3]=g*s+A*o+y*l,e[4]=g*r+A*a+y*u,e[5]=g*i+A*c+y*h,e[6]=b*s+E*o+C*l,e[7]=b*r+E*a+C*u,e[8]=b*i+E*c+C*h,e}function zy(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=n[0],d=n[1];return e[0]=s,e[1]=r,e[2]=i,e[3]=o,e[4]=a,e[5]=c,e[6]=f*s+d*o+l,e[7]=f*r+d*a+u,e[8]=f*i+d*c+h,e}function Ky(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=Math.sin(n),d=Math.cos(n);return e[0]=d*s+f*o,e[1]=d*r+f*a,e[2]=d*i+f*c,e[3]=d*o-f*s,e[4]=d*a-f*r,e[5]=d*c-f*i,e[6]=l,e[7]=u,e[8]=h,e}function Vc(e,t,n){const s=n[0],r=n[1];return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function qy(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n+n,a=s+s,c=r+r,l=n*o,u=s*o,h=s*a,f=r*o,d=r*a,m=r*c,g=i*o,A=i*a,y=i*c;return e[0]=1-h-m,e[3]=u-y,e[6]=f+A,e[1]=u+y,e[4]=1-l-m,e[7]=d-g,e[2]=f-A,e[5]=d+g,e[8]=1-l-h,e}var Qr;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(Qr||(Qr={}));const Xy=Object.freeze([1,0,0,0,1,0,0,0,1]);class rt extends kc{static get IDENTITY(){return Yy()}static get ZERO(){return Qy()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Qr}constructor(t,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):n.length>0?this.copy([t,...n]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(Xy)}fromObject(t){return this.check()}fromQuaternion(t){return qy(this,t),this.check()}set(t,n,s,r,i,o,a,c,l){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(t,n,s,r,i,o,a,c,l){return this[0]=t,this[1]=r,this[2]=a,this[3]=n,this[4]=i,this[5]=c,this[6]=s,this[7]=o,this[8]=l,this.check()}determinant(){return jy(this)}transpose(){return Jy(this,this),this.check()}invert(){return Wy(this,this),this.check()}multiplyLeft(t){return $c(this,t,this),this.check()}multiplyRight(t){return $c(this,this,t),this.check()}rotate(t){return Ky(this,this,t),this.check()}scale(t){return Array.isArray(t)?Vc(this,this,t):Vc(this,this,[t,t]),this.check()}translate(t){return zy(this,this,t),this.check()}transform(t,n){let s;switch(t.length){case 2:s=vy(n||[-0,-0],t,this);break;case 3:s=Uc(n||[-0,-0,-0],t,this);break;case 4:s=Dc(n||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return nn(s,t.length),s}transformVector(t,n){return this.transform(t,n)}transformVector2(t,n){return this.transform(t,n)}transformVector3(t,n){return this.transform(t,n)}}let is,os=null;function Qy(){return is||(is=new rt([0,0,0,0,0,0,0,0,0]),Object.freeze(is)),is}function Yy(){return os||(os=new rt,Object.freeze(os)),os}function Zy(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tB(e,t){if(e===t){const n=t[1],s=t[2],r=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=i,e[11]=t[14],e[12]=r,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function eB(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=t[9],f=t[10],d=t[11],m=t[12],g=t[13],A=t[14],y=t[15],b=n*a-s*o,E=n*c-r*o,C=n*l-i*o,_=s*c-r*a,B=s*l-i*a,F=r*l-i*c,v=u*g-h*m,O=u*A-f*m,x=u*y-d*m,D=h*A-f*g,N=h*y-d*g,G=f*y-d*A;let S=b*G-E*N+C*D+_*x-B*O+F*v;return S?(S=1/S,e[0]=(a*G-c*N+l*D)*S,e[1]=(r*N-s*G-i*D)*S,e[2]=(g*F-A*B+y*_)*S,e[3]=(f*B-h*F-d*_)*S,e[4]=(c*x-o*G-l*O)*S,e[5]=(n*G-r*x+i*O)*S,e[6]=(A*C-m*F-y*E)*S,e[7]=(u*F-f*C+d*E)*S,e[8]=(o*N-a*x+l*v)*S,e[9]=(s*x-n*N-i*v)*S,e[10]=(m*B-g*C+y*b)*S,e[11]=(h*C-u*B-d*b)*S,e[12]=(a*O-o*D-c*v)*S,e[13]=(n*D-s*O+r*v)*S,e[14]=(g*E-m*_-A*b)*S,e[15]=(u*_-h*E+f*b)*S,e):null}function nB(e){const t=e[0],n=e[1],s=e[2],r=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],f=e[11],d=e[12],m=e[13],g=e[14],A=e[15],y=t*o-n*i,b=t*a-s*i,E=n*a-s*o,C=l*m-u*d,_=l*g-h*d,B=u*g-h*m,F=t*B-n*_+s*C,v=i*B-o*_+a*C,O=l*E-u*b+h*y,x=d*E-m*b+g*y;return c*F-r*v+A*O-f*x}function Jc(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=t[9],d=t[10],m=t[11],g=t[12],A=t[13],y=t[14],b=t[15];let E=n[0],C=n[1],_=n[2],B=n[3];return e[0]=E*s+C*a+_*h+B*g,e[1]=E*r+C*c+_*f+B*A,e[2]=E*i+C*l+_*d+B*y,e[3]=E*o+C*u+_*m+B*b,E=n[4],C=n[5],_=n[6],B=n[7],e[4]=E*s+C*a+_*h+B*g,e[5]=E*r+C*c+_*f+B*A,e[6]=E*i+C*l+_*d+B*y,e[7]=E*o+C*u+_*m+B*b,E=n[8],C=n[9],_=n[10],B=n[11],e[8]=E*s+C*a+_*h+B*g,e[9]=E*r+C*c+_*f+B*A,e[10]=E*i+C*l+_*d+B*y,e[11]=E*o+C*u+_*m+B*b,E=n[12],C=n[13],_=n[14],B=n[15],e[12]=E*s+C*a+_*h+B*g,e[13]=E*r+C*c+_*f+B*A,e[14]=E*i+C*l+_*d+B*y,e[15]=E*o+C*u+_*m+B*b,e}function sB(e,t,n){const s=n[0],r=n[1],i=n[2];let o,a,c,l,u,h,f,d,m,g,A,y;return t===e?(e[12]=t[0]*s+t[4]*r+t[8]*i+t[12],e[13]=t[1]*s+t[5]*r+t[9]*i+t[13],e[14]=t[2]*s+t[6]*r+t[10]*i+t[14],e[15]=t[3]*s+t[7]*r+t[11]*i+t[15]):(o=t[0],a=t[1],c=t[2],l=t[3],u=t[4],h=t[5],f=t[6],d=t[7],m=t[8],g=t[9],A=t[10],y=t[11],e[0]=o,e[1]=a,e[2]=c,e[3]=l,e[4]=u,e[5]=h,e[6]=f,e[7]=d,e[8]=m,e[9]=g,e[10]=A,e[11]=y,e[12]=o*s+u*r+m*i+t[12],e[13]=a*s+h*r+g*i+t[13],e[14]=c*s+f*r+A*i+t[14],e[15]=l*s+d*r+y*i+t[15]),e}function rB(e,t,n){const s=n[0],r=n[1],i=n[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function iB(e,t,n,s){let r=s[0],i=s[1],o=s[2],a=Math.sqrt(r*r+i*i+o*o),c,l,u,h,f,d,m,g,A,y,b,E,C,_,B,F,v,O,x,D,N,G,S,j;return a<sn?null:(a=1/a,r*=a,i*=a,o*=a,l=Math.sin(n),c=Math.cos(n),u=1-c,h=t[0],f=t[1],d=t[2],m=t[3],g=t[4],A=t[5],y=t[6],b=t[7],E=t[8],C=t[9],_=t[10],B=t[11],F=r*r*u+c,v=i*r*u+o*l,O=o*r*u-i*l,x=r*i*u-o*l,D=i*i*u+c,N=o*i*u+r*l,G=r*o*u+i*l,S=i*o*u-r*l,j=o*o*u+c,e[0]=h*F+g*v+E*O,e[1]=f*F+A*v+C*O,e[2]=d*F+y*v+_*O,e[3]=m*F+b*v+B*O,e[4]=h*x+g*D+E*N,e[5]=f*x+A*D+C*N,e[6]=d*x+y*D+_*N,e[7]=m*x+b*D+B*N,e[8]=h*G+g*S+E*j,e[9]=f*G+A*S+C*j,e[10]=d*G+y*S+_*j,e[11]=m*G+b*S+B*j,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function oB(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*r+l*s,e[5]=o*r+u*s,e[6]=a*r+h*s,e[7]=c*r+f*s,e[8]=l*r-i*s,e[9]=u*r-o*s,e[10]=h*r-a*s,e[11]=f*r-c*s,e}function aB(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[0],o=t[1],a=t[2],c=t[3],l=t[8],u=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r-l*s,e[1]=o*r-u*s,e[2]=a*r-h*s,e[3]=c*r-f*s,e[8]=i*s+l*r,e[9]=o*s+u*r,e[10]=a*s+h*r,e[11]=c*s+f*r,e}function cB(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[0],o=t[1],a=t[2],c=t[3],l=t[4],u=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r+l*s,e[1]=o*r+u*s,e[2]=a*r+h*s,e[3]=c*r+f*s,e[4]=l*r-i*s,e[5]=u*r-o*s,e[6]=h*r-a*s,e[7]=f*r-c*s,e}function lB(e,t){const n=t[0],s=t[1],r=t[2],i=t[4],o=t[5],a=t[6],c=t[8],l=t[9],u=t[10];return e[0]=Math.sqrt(n*n+s*s+r*r),e[1]=Math.sqrt(i*i+o*o+a*a),e[2]=Math.sqrt(c*c+l*l+u*u),e}function uB(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n+n,a=s+s,c=r+r,l=n*o,u=s*o,h=s*a,f=r*o,d=r*a,m=r*c,g=i*o,A=i*a,y=i*c;return e[0]=1-h-m,e[1]=u+y,e[2]=f-A,e[3]=0,e[4]=u-y,e[5]=1-l-m,e[6]=d+g,e[7]=0,e[8]=f+A,e[9]=d-g,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hB(e,t,n,s,r,i,o){const a=1/(n-t),c=1/(r-s),l=1/(i-o);return e[0]=i*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i*2*c,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+s)*c,e[10]=(o+i)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*l,e[15]=0,e}function fB(e,t,n,s,r){const i=1/Math.tan(t/2);if(e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0){const o=1/(s-r);e[10]=(r+s)*o,e[14]=2*r*s*o}else e[10]=-1,e[14]=-2*s;return e}const dB=fB;function mB(e,t,n,s,r,i,o){const a=1/(t-n),c=1/(s-r),l=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*a,e[13]=(r+s)*c,e[14]=(o+i)*l,e[15]=1,e}const gB=mB;function AB(e,t,n,s){let r,i,o,a,c,l,u,h,f,d;const m=t[0],g=t[1],A=t[2],y=s[0],b=s[1],E=s[2],C=n[0],_=n[1],B=n[2];return Math.abs(m-C)<sn&&Math.abs(g-_)<sn&&Math.abs(A-B)<sn?Zy(e):(h=m-C,f=g-_,d=A-B,r=1/Math.sqrt(h*h+f*f+d*d),h*=r,f*=r,d*=r,i=b*d-E*f,o=E*h-y*d,a=y*f-b*h,r=Math.sqrt(i*i+o*o+a*a),r?(r=1/r,i*=r,o*=r,a*=r):(i=0,o=0,a=0),c=f*a-d*o,l=d*i-h*a,u=h*o-f*i,r=Math.sqrt(c*c+l*l+u*u),r?(r=1/r,c*=r,l*=r,u*=r):(c=0,l=0,u=0),e[0]=i,e[1]=c,e[2]=h,e[3]=0,e[4]=o,e[5]=l,e[6]=f,e[7]=0,e[8]=a,e[9]=u,e[10]=d,e[11]=0,e[12]=-(i*m+o*g+a*A),e[13]=-(c*m+l*g+u*A),e[14]=-(h*m+f*g+d*A),e[15]=1,e)}function pB(){const e=new It(4);return It!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function yB(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function BB(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function TB(e){const t=e[0],n=e[1],s=e[2],r=e[3];return Math.sqrt(t*t+n*n+s*s+r*r)}function EB(e){const t=e[0],n=e[1],s=e[2],r=e[3];return t*t+n*n+s*s+r*r}function CB(e,t){const n=t[0],s=t[1],r=t[2],i=t[3];let o=n*n+s*s+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=s*o,e[2]=r*o,e[3]=i*o,e}function bB(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function wB(e,t,n,s){const r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=r+s*(n[0]-r),e[1]=i+s*(n[1]-i),e[2]=o+s*(n[2]-o),e[3]=a+s*(n[3]-a),e}function _B(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3];return e[0]=n[0]*s+n[4]*r+n[8]*i+n[12]*o,e[1]=n[1]*s+n[5]*r+n[9]*i+n[13]*o,e[2]=n[2]*s+n[6]*r+n[10]*i+n[14]*o,e[3]=n[3]*s+n[7]*r+n[11]*i+n[15]*o,e}function MB(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[0],a=n[1],c=n[2],l=n[3],u=l*s+a*i-c*r,h=l*r+c*s-o*i,f=l*i+o*r-a*s,d=-o*s-a*r-c*i;return e[0]=u*l+d*-o+h*-c-f*-a,e[1]=h*l+d*-a+f*-o-u*-c,e[2]=f*l+d*-c+u*-a-h*-o,e[3]=t[3],e}(function(){const e=pB();return function(t,n,s,r,i,o){let a,c;for(n||(n=4),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();var Yr;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(Yr||(Yr={}));const RB=45*Math.PI/180,SB=1,Zr=.1,ti=500,IB=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class X extends kc{static get IDENTITY(){return xB()}static get ZERO(){return OB()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Yr}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,n,s,r,i,o,a,c,l,u,h,f,d,m,g,A){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=u,this[10]=h,this[11]=f,this[12]=d,this[13]=m,this[14]=g,this[15]=A,this.check()}setRowMajor(t,n,s,r,i,o,a,c,l,u,h,f,d,m,g,A){return this[0]=t,this[1]=i,this[2]=l,this[3]=d,this[4]=n,this[5]=o,this[6]=u,this[7]=m,this[8]=s,this[9]=a,this[10]=h,this[11]=g,this[12]=r,this[13]=c,this[14]=f,this[15]=A,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(IB)}fromObject(t){return this.check()}fromQuaternion(t){return uB(this,t),this.check()}frustum(t){const{left:n,right:s,bottom:r,top:i,near:o=Zr,far:a=ti}=t;return a===1/0?vB(this,n,s,r,i,o):hB(this,n,s,r,i,o,a),this.check()}lookAt(t){const{eye:n,center:s=[0,0,0],up:r=[0,1,0]}=t;return AB(this,n,s,r),this.check()}ortho(t){const{left:n,right:s,bottom:r,top:i,near:o=Zr,far:a=ti}=t;return gB(this,n,s,r,i,o,a),this.check()}orthographic(t){const{fovy:n=RB,aspect:s=SB,focalDistance:r=1,near:i=Zr,far:o=ti}=t;Wc(n);const a=n/2,c=r*Math.tan(a),l=c*s;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:i,far:o})}perspective(t){const{fovy:n=45*Math.PI/180,aspect:s=1,near:r=.1,far:i=500}=t;return Wc(n),dB(this,n,s,r,i),this.check()}determinant(){return nB(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const s=this.getScale(n),r=1/s[0],i=1/s[1],o=1/s[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const s=this.getScale(n),r=1/s[0],i=1/s[1],o=1/s[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*o,t}transpose(){return tB(this,this),this.check()}invert(){return eB(this,this),this.check()}multiplyLeft(t){return Jc(this,t,this),this.check()}multiplyRight(t){return Jc(this,this,t),this.check()}rotateX(t){return oB(this,this,t),this.check()}rotateY(t){return aB(this,this,t),this.check()}rotateZ(t){return cB(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,n){return iB(this,this,t,n),this.check()}scale(t){return rB(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return sB(this,this,t),this.check()}transform(t,n){return t.length===4?(n=_B(n||[-0,-0,-0,-0],t,this),nn(n,4),n):this.transformAsPoint(t,n)}transformAsPoint(t,n){const{length:s}=t;let r;switch(s){case 2:r=Fy(n||[-0,-0],t,this);break;case 3:r=Kr(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return nn(r,t.length),r}transformAsVector(t,n){let s;switch(t.length){case 2:s=Ly(n||[-0,-0],t,this);break;case 3:s=Lc(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return nn(s,t.length),s}transformPoint(t,n){return this.transformAsPoint(t,n)}transformVector(t,n){return this.transformAsPoint(t,n)}transformDirection(t,n){return this.transformAsVector(t,n)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,n,s){return this.identity().translate([t,n,s])}}let as,cs;function OB(){return as||(as=new X([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(as)),as}function xB(){return cs||(cs=new X,Object.freeze(cs)),cs}function Wc(e){if(e>Math.PI*2)throw Error("expected radians")}function vB(e,t,n,s,r,i){const o=2*i/(n-t),a=2*i/(r-s),c=(n+t)/(n-t),l=(r+s)/(r-s),u=-1,h=-1,f=-2*i;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=c,e[9]=l,e[10]=u,e[11]=h,e[12]=0,e[13]=0,e[14]=f,e[15]=0,e}function jc(){const e=new It(4);return It!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function FB(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function zc(e,t,n){n=n*.5;const s=Math.sin(n);return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=Math.cos(n),e}function Kc(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=n[0],c=n[1],l=n[2],u=n[3];return e[0]=s*u+o*a+r*l-i*c,e[1]=r*u+o*c+i*a-s*l,e[2]=i*u+o*l+s*c-r*a,e[3]=o*u-s*a-r*c-i*l,e}function LB(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c+o*a,e[1]=r*c+i*a,e[2]=i*c-r*a,e[3]=o*c-s*a,e}function DB(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c-i*a,e[1]=r*c+o*a,e[2]=i*c+s*a,e[3]=o*c-r*a,e}function GB(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c+r*a,e[1]=r*c-s*a,e[2]=i*c+o*a,e[3]=o*c-i*a,e}function NB(e,t){const n=t[0],s=t[1],r=t[2];return e[0]=n,e[1]=s,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-s*s-r*r)),e}function ls(e,t,n,s){const r=t[0],i=t[1],o=t[2],a=t[3];let c=n[0],l=n[1],u=n[2],h=n[3],f,d,m,g,A;return f=r*c+i*l+o*u+a*h,f<0&&(f=-f,c=-c,l=-l,u=-u,h=-h),1-f>sn?(d=Math.acos(f),A=Math.sin(d),m=Math.sin((1-s)*d)/A,g=Math.sin(s*d)/A):(m=1-s,g=s),e[0]=m*r+g*c,e[1]=m*i+g*l,e[2]=m*o+g*u,e[3]=m*a+g*h,e}function PB(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n*n+s*s+r*r+i*i,a=o?1/o:0;return e[0]=-n*a,e[1]=-s*a,e[2]=-r*a,e[3]=i*a,e}function UB(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function qc(e,t){const n=t[0]+t[4]+t[8];let s;if(n>0)s=Math.sqrt(n+1),e[3]=.5*s,s=.5/s,e[0]=(t[5]-t[7])*s,e[1]=(t[6]-t[2])*s,e[2]=(t[1]-t[3])*s;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);const i=(r+1)%3,o=(r+2)%3;s=Math.sqrt(t[r*3+r]-t[i*3+i]-t[o*3+o]+1),e[r]=.5*s,s=.5/s,e[3]=(t[i*3+o]-t[o*3+i])*s,e[i]=(t[i*3+r]+t[r*3+i])*s,e[o]=(t[o*3+r]+t[r*3+o])*s}return e}const HB=yB,kB=BB,$B=bB,VB=wB,JB=TB,WB=EB,Xc=CB,jB=function(){const e=Gc(),t=Pc(1,0,0),n=Pc(0,1,0);return function(s,r,i){const o=zr(r,i);return o<-.999999?(ns(e,t,r),$y(e)<1e-6&&ns(e,n,r),Ny(e,e),zc(s,e,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(ns(e,r,i),s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=1+o,Xc(s,s))}}();(function(){const e=jc(),t=jc();return function(n,s,r,i,o,a){return ls(e,s,o,a),ls(t,r,i,a),ls(n,e,t,2*a*(1-a)),n}})(),function(){const e=Vy();return function(t,n,s,r){return e[0]=s[0],e[3]=s[1],e[6]=s[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Xc(t,qc(t,e))}}();const zB=[0,0,0,1];class ei extends jr{constructor(t=0,n=0,s=0,r=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,n,s,r)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,n,s,r){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return qc(this,t),this.check()}fromAxisRotation(t,n){return zc(this,t,n),this.check()}identity(){return FB(this),this.check()}setAxisAngle(t,n){return this.fromAxisRotation(t,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=V(t)}get y(){return this[1]}set y(t){this[1]=V(t)}get z(){return this[2]}set z(t){this[2]=V(t)}get w(){return this[3]}set w(t){this[3]=V(t)}len(){return JB(this)}lengthSquared(){return WB(this)}dot(t){return $B(this,t)}rotationTo(t,n){return jB(this,t,n),this.check()}add(t){return HB(this,this,t),this.check()}calculateW(){return NB(this,this),this.check()}conjugate(){return UB(this,this),this.check()}invert(){return PB(this,this),this.check()}lerp(t,n,s){return s===void 0?this.lerp(this,t,n):(VB(this,t,n,s),this.check())}multiplyRight(t){return Kc(this,this,t),this.check()}multiplyLeft(t){return Kc(this,t,this),this.check()}normalize(){const t=this.len(),n=t>0?1/t:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,t===0&&(this[3]=1),this.check()}rotateX(t){return LB(this,this,t),this.check()}rotateY(t){return DB(this,this,t),this.check()}rotateZ(t){return GB(this,this,t),this.check()}scale(t){return kB(this,this,t),this.check()}slerp(t,n,s){let r,i,o;switch(arguments.length){case 1:({start:r=zB,target:i,ratio:o}=t);break;case 2:r=this,i=t,o=n;break;default:r=t,i=n,o=s}return ls(this,r,i,o),this.check()}transformVector4(t,n=new Xr){return MB(n,t,this),nn(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,n){return this.setAxisAngle(t,n)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}function rn(e){"@babel/helpers - typeof";return rn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rn(e)}function KB(e,t){if(rn(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(rn(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qB(e){var t=KB(e,"string");return rn(t)==="symbol"?t:String(t)}function I(e,t,n){return t=qB(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const XB=.1,QB=1e-12,YB=1e-15,ZB=6378137,tT=6378137,eT=6356752314245179e-9;function us(e){return e}new T;function nT(e,t=[],n=us){return"longitude"in e?(t[0]=n(e.longitude),t[1]=n(e.latitude),t[2]=e.height):"x"in e?(t[0]=n(e.x),t[1]=n(e.y),t[2]=e.z):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}function sT(e,t=[]){return nT(e,t,Z._cartographicRadians?us:wy)}function rT(e,t,n=us){return"longitude"in t?(t.longitude=n(e[0]),t.latitude=n(e[1]),t.height=e[2]):"x"in t?(t.x=n(e[0]),t.y=n(e[1]),t.z=e[2]):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}function iT(e,t){return rT(e,t,Z._cartographicRadians?us:_y)}const Qc=1e-14,oT=new T,Yc={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},ni={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},on={east:new T,north:new T,up:new T,west:new T,south:new T,down:new T},aT=new T,cT=new T,lT=new T;function Zc(e,t,n,s,r,i){const o=Yc[t]&&Yc[t][n];St(o&&(!s||s===o));let a,c,l;const u=oT.copy(r);if(Yt(u.x,0,Qc)&&Yt(u.y,0,Qc)){const f=Math.sign(u.z);a=aT.fromArray(ni[t]),t!=="east"&&t!=="west"&&a.scale(f),c=cT.fromArray(ni[n]),n!=="east"&&n!=="west"&&c.scale(f),l=lT.fromArray(ni[s]),s!=="east"&&s!=="west"&&l.scale(f)}else{const{up:f,east:d,north:m}=on;d.set(-u.y,u.x,0).normalize(),e.geodeticSurfaceNormal(u,f),m.copy(f).cross(d);const{down:g,west:A,south:y}=on;g.copy(f).scale(-1),A.copy(d).scale(-1),y.copy(m).scale(-1),a=on[t],c=on[n],l=on[s]}return i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=0,i[4]=c.x,i[5]=c.y,i[6]=c.z,i[7]=0,i[8]=l.x,i[9]=l.y,i[10]=l.z,i[11]=0,i[12]=u.x,i[13]=u.y,i[14]=u.z,i[15]=1,i}const Me=new T,uT=new T,hT=new T;function fT(e,t,n=[]){const{oneOverRadii:s,oneOverRadiiSquared:r,centerToleranceSquared:i}=t;Me.from(e);const o=Me.x,a=Me.y,c=Me.z,l=s.x,u=s.y,h=s.z,f=o*o*l*l,d=a*a*u*u,m=c*c*h*h,g=f+d+m,A=Math.sqrt(1/g);if(!Number.isFinite(A))return;const y=uT;if(y.copy(e).scale(A),g<i)return y.to(n);const b=r.x,E=r.y,C=r.z,_=hT;_.set(y.x*b*2,y.y*E*2,y.z*C*2);let B=(1-A)*Me.len()/(.5*_.len()),F=0,v,O,x,D;do{B-=F,v=1/(1+B*b),O=1/(1+B*E),x=1/(1+B*C);const N=v*v,G=O*O,S=x*x,j=N*v,me=G*O,jt=S*x;D=f*N+d*G+m*S-1;const Ht=-2*(f*j*b+d*me*E+m*jt*C);F=D/Ht}while(Math.abs(D)>QB);return Me.scale([v,O,x]).to(n)}const hs=new T,tl=new T,dT=new T,Ot=new T,mT=new T,fs=new T;class W{constructor(t=0,n=0,s=0){I(this,"radii",void 0),I(this,"radiiSquared",void 0),I(this,"radiiToTheFourth",void 0),I(this,"oneOverRadii",void 0),I(this,"oneOverRadiiSquared",void 0),I(this,"minimumRadius",void 0),I(this,"maximumRadius",void 0),I(this,"centerToleranceSquared",XB),I(this,"squaredXOverSquaredZ",void 0),St(t>=0),St(n>=0),St(s>=0),this.radii=new T(t,n,s),this.radiiSquared=new T(t*t,n*n,s*s),this.radiiToTheFourth=new T(t*t*t*t,n*n*n*n,s*s*s*s),this.oneOverRadii=new T(t===0?0:1/t,n===0?0:1/n,s===0?0:1/s),this.oneOverRadiiSquared=new T(t===0?0:1/(t*t),n===0?0:1/(n*n),s===0?0:1/(s*s)),this.minimumRadius=Math.min(t,n,s),this.maximumRadius=Math.max(t,n,s),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,n=[0,0,0]){const s=tl,r=dT,[,,i]=t;this.geodeticSurfaceNormalCartographic(t,s),r.copy(this.radiiSquared).scale(s);const o=Math.sqrt(s.dot(r));return r.scale(1/o),s.scale(i),r.add(s),r.to(n)}cartesianToCartographic(t,n=[0,0,0]){fs.from(t);const s=this.scaleToGeodeticSurface(fs,Ot);if(!s)return;const r=this.geodeticSurfaceNormal(s,tl),i=mT;i.copy(fs).subtract(s);const o=Math.atan2(r.y,r.x),a=Math.asin(r.z),c=Math.sign(zr(i,fs))*Nc(i);return iT([o,a,c],n)}eastNorthUpToFixedFrame(t,n=new X){return Zc(this,"east","north","up",t,n)}localFrameToFixedFrame(t,n,s,r,i=new X){return Zc(this,t,n,s,r,i)}geocentricSurfaceNormal(t,n=[0,0,0]){return hs.from(t).normalize().to(n)}geodeticSurfaceNormalCartographic(t,n=[0,0,0]){const s=sT(t),r=s[0],i=s[1],o=Math.cos(i);return hs.set(o*Math.cos(r),o*Math.sin(r),Math.sin(i)).normalize(),hs.to(n)}geodeticSurfaceNormal(t,n=[0,0,0]){return hs.from(t).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(t,n){return fT(t,this,n)}scaleToGeocentricSurface(t,n=[0,0,0]){Ot.from(t);const s=Ot.x,r=Ot.y,i=Ot.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(s*s*o.x+r*r*o.y+i*i*o.z);return Ot.multiplyScalar(a).to(n)}transformPositionToScaledSpace(t,n=[0,0,0]){return Ot.from(t).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(t,n=[0,0,0]){return Ot.from(t).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(t,n=0,s=[0,0,0]){St(Yt(this.radii.x,this.radii.y,YB)),St(this.radii.z>0),Ot.from(t);const r=Ot.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-n))return Ot.set(0,0,r).to(s)}}I(W,"WGS84",new W(ZB,tT,eT));function el(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}let nl=class{constructor(t,n){I(this,"name",void 0),I(this,"type",void 0),I(this,"sampleSize",1),I(this,"time",0),I(this,"count",0),I(this,"samples",0),I(this,"lastTiming",0),I(this,"lastSampleTime",0),I(this,"lastSampleCount",0),I(this,"_count",0),I(this,"_time",0),I(this,"_samples",0),I(this,"_startTime",0),I(this,"_timerPending",!1),this.name=t,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=el(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(el()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},gT=class{constructor(t){I(this,"id",void 0),I(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const n of Object.values(this.stats))t(n)}getTable(){const t={};return this.forEach(n=>{t[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(t){const{name:n,type:s}=t;let r=this.stats[n];return r||(t instanceof nl?r=t:r=new nl(n,s),this.stats[n]=r),r}};function Vt(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const sl=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),rl=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);rl&&parseFloat(rl[1]);function AT(e,t){return il(e||{},t)}function il(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(n>3)return t;const s={...e};for(const[r,i]of Object.entries(t))i&&typeof i=="object"&&!Array.isArray(i)?s[r]=il(s[r]||{},t[r],n+1):s[r]=t[r];return s}const pT="latest";function yT(){var e;return(e=globalThis._loadersgl_)!==null&&e!==void 0&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.1.0-alpha.9"),globalThis._loadersgl_.version}const BT=yT();function Zt(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const le=typeof process!="object"||String(process)!=="[object process]"||process.browser,TT=typeof window<"u"&&typeof window.orientation<"u",ol=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ol&&parseFloat(ol[1]);class ET{constructor(t,n){this.name=void 0,this.workerThread=void 0,this.isRunning=!0,this.result=void 0,this._resolve=()=>{},this._reject=()=>{},this.name=t,this.workerThread=n,this.result=new Promise((s,r)=>{this._resolve=s,this._reject=r})}postMessage(t,n){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:n})}done(t){Zt(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Zt(this.isRunning),this.isRunning=!1,this._reject(t)}}class si{terminate(){}}const ri=new Map;function CT(e){Zt(e.source&&!e.url||!e.source&&e.url);let t=ri.get(e.source||e.url);return t||(e.url&&(t=bT(e.url),ri.set(e.url,t)),e.source&&(t=al(e.source),ri.set(e.source,t))),Zt(t),t}function bT(e){if(!e.startsWith("http"))return e;const t=wT(e);return al(t)}function al(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function wT(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function cl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const s=n||new Set;if(e){if(ll(e))s.add(e);else if(ll(e.buffer))s.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(const r in e)cl(e[r],t,s)}}return n===void 0?Array.from(s):[]}function ll(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const ii=()=>{};class oi{static isSupported(){return typeof Worker<"u"&&le||typeof si<"u"&&!le}constructor(t){this.name=void 0,this.source=void 0,this.url=void 0,this.terminated=!1,this.worker=void 0,this.onMessage=void 0,this.onError=void 0,this._loadableURL="";const{name:n,source:s,url:r}=t;Zt(s||r),this.name=n,this.source=s,this.url=r,this.onMessage=ii,this.onError=i=>console.log(i),this.worker=le?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=ii,this.onError=ii,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,n){n=n||cl(t),this.worker.postMessage(t,n)}_getErrorFromErrorEvent(t){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,t.message&&(n+=`${t.message} in `),t.lineno&&(n+=`:${t.lineno}:${t.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=CT({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},t.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},t.onmessageerror=n=>console.error(n),t}_createNodeWorker(){let t;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new si(s,{eval:!1})}else if(this.source)t=new si(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",n=>{this.onMessage(n)}),t.on("error",n=>{this.onError(n)}),t.on("exit",n=>{}),t}}class _T{static isSupported(){return oi.isSupported()}constructor(t){this.name="unnamed",this.source=void 0,this.url=void 0,this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=()=>{},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(i,o,a)=>i.done(a),s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(i,o)=>i.error(o);const r=new Promise(i=>(this.jobQueue.push({name:t,onMessage:n,onError:s,onStart:i}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:t,backlog:this.jobQueue.length});const s=new ET(n.name,t);t.onMessage=r=>n.onMessage(s,r.type,r.payload),t.onError=r=>n.onError(s,r),n.onStart(s);try{await s.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!le||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new oi({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return TT?this.maxMobileConcurrency:this.maxConcurrency}}const MT={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Jt{static isSupported(){return oi.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Jt._workerFarm=Jt._workerFarm||new Jt({}),Jt._workerFarm.setProps(t),Jt._workerFarm}constructor(t){this.props=void 0,this.workerPools=new Map,this.props={...MT},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:n,source:s,url:r}=t;let i=this.workerPools.get(n);return i||(i=new _T({name:n,source:s,url:r}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}Jt._workerFarm=void 0;function RT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=t[e.id]||{},s=le?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=n.workerUrl;if(!r&&e.id==="compression"&&(r=t.workerUrl),t._workerType==="test"&&(le?r=`modules/${e.module}/dist/${s}`:r=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let i=e.version;i==="latest"&&(i=pT);const o=i?`@${i}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${s}`}return Zt(r),r}function ST(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:BT;Zt(e,"no worker provided");const n=e.version;return!(!t||!n)}function IT(e,t){return!Jt.isSupported()||!le&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&(t==null?void 0:t.worker)}async function OT(e,t,n,s,r){const i=e.id,o=RT(e,n),c=Jt.getWorkerFarm(n).getWorkerPool({name:i,url:o});n=JSON.parse(JSON.stringify(n)),s=JSON.parse(JSON.stringify(s||{}));const l=await c.startJob("process-on-worker",xT.bind(null,r));return l.postMessage("process",{input:t,options:n,context:s}),await(await l.result).result}async function xT(e,t,n,s){switch(n){case"done":t.done(s);break;case"error":t.error(new Error(s.error));break;case"process":const{id:r,input:i,options:o}=s;try{const a=await e(i,o);t.postMessage("done",{id:r,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:r,error:c})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function vT(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const s=new Uint8Array(e),r=new Uint8Array(t);for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}function FT(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return LT(t)}function LT(e){const t=e.map(i=>i instanceof ArrayBuffer?new Uint8Array(i):i),n=t.reduce((i,o)=>i+o.byteLength,0),s=new Uint8Array(n);let r=0;for(const i of t)s.set(i,r),r+=i.byteLength;return s.buffer}async function DT(e){const t=[];for await(const n of e)t.push(n);return FT(...t)}function ul(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}class hl{constructor(t,n){I(this,"name",void 0),I(this,"type",void 0),I(this,"sampleSize",1),I(this,"time",0),I(this,"count",0),I(this,"samples",0),I(this,"lastTiming",0),I(this,"lastSampleTime",0),I(this,"lastSampleCount",0),I(this,"_count",0),I(this,"_time",0),I(this,"_samples",0),I(this,"_startTime",0),I(this,"_timerPending",!1),this.name=t,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ul(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ul()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class GT{constructor(t){I(this,"id",void 0),I(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const n of Object.values(this.stats))t(n)}getTable(){const t={};return this.forEach(n=>{t[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(t){const{name:n,type:s}=t;let r=this.stats[n];return r||(t instanceof hl?r=t:r=new hl(n,s),this.stats[n]=r),r}}const NT="Queued Requests",PT="Active Requests",UT="Cancelled Requests",HT="Queued Requests Ever",kT="Active Requests Ever",$T={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class VT{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.props=void 0,this.stats=void 0,this.activeRequestCount=0,this.requestQueue=[],this.requestMap=new Map,this.deferredUpdate=null,this.props={...$T,...t},this.stats=new GT({id:this.props.id}),this.stats.get(NT),this.stats.get(PT),this.stats.get(UT),this.stats.get(HT),this.stats.get(kT)}scheduleRequest(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const s={handle:t,priority:0,getPriority:n},r=new Promise(i=>(s.resolve=i,s));return this.requestQueue.push(s),this.requestMap.set(t,r),this._issueNewRequests(),r}_issueRequest(t){const{handle:n,resolve:s}=t;let r=!1;const i=()=>{r||(r=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,s?s({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let n=0;n<t;++n){const s=this.requestQueue.shift();s&&this._issueRequest(s)}}}_updateAllRequests(){const t=this.requestQueue;for(let n=0;n<t.length;++n){const s=t[n];this._updateRequest(s)||(t.splice(n,1),this.requestMap.delete(s.handle),n--)}t.sort((n,s)=>n.priority-s.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let JT="";const fl={};function WT(e){for(const t in fl)if(e.startsWith(t)){const n=fl[t];e=e.replace(t,n)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${JT}${e}`),e}function Ab(e){return e}function jT(e){return e&&typeof e=="object"&&e.isBuffer}function dl(e){if(jT(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function ml(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function gl(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}class zT{constructor(t,n,s){this.item=void 0,this.previous=void 0,this.next=void 0,this.item=t,this.previous=n,this.next=s}}class KT{constructor(){this.head=null,this.tail=null,this._length=0}get length(){return this._length}add(t){const n=new zT(t,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,n){t!==n&&(this.remove(n),this._insert(t,n))}_insert(t,n){const s=t.next;t.next=n,this.tail===t?this.tail=n:s.previous=n,n.next=s,n.previous=t,++this._length}}class qT{constructor(){this._list=void 0,this._sentinel=void 0,this._trimTiles=void 0,this._list=new KT,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const n=t._cacheNode;n&&this._list.splice(this._sentinel,n)}add(t,n,s){n._cacheNode||(n._cacheNode=this._list.add(n),s&&s(t,n))}unloadTile(t,n,s){const r=n._cacheNode;r&&(this._list.remove(r),n._cacheNode=null,s&&s(t,n))}unloadTiles(t,n){const s=this._trimTiles;this._trimTiles=!1;const r=this._list,i=t.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=r.head;for(;a!==o&&(t.gpuMemoryUsageInBytes>i||s);){const c=a.item;a=a.next,this.unloadTile(t,c,n)}}trim(){this._trimTiles=!0}}function XT(e,t){Vt(e),Vt(t);const{rtcCenter:n,gltfUpAxis:s}=t,{computedTransform:r,boundingVolume:{center:i}}=e;let o=new X(r);switch(n&&o.translate(n),s){case"Z":break;case"Y":const h=new X().rotateX(Math.PI/2);o=o.multiplyRight(h);break;case"X":const f=new X().rotateY(-Math.PI/2);o=o.multiplyRight(f);break}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const a=new T(i);t.cartesianModelMatrix=o,t.cartesianOrigin=a;const c=W.WGS84.cartesianToCartographic(a,new T),u=W.WGS84.eastNorthUpToFixedFrame(a).invert();t.cartographicModelMatrix=u.multiplyRight(o),t.cartographicOrigin=c,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const mt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new T,new T;const an=new T,Al=new T;class cn{constructor(t=[0,0,0],n=0){I(this,"center",void 0),I(this,"radius",void 0),this.radius=-0,this.center=new T,this.fromCenterRadius(t,n)}fromCenterRadius(t,n){return this.center.from(t),this.radius=n,this}fromCornerPoints(t,n){return n=an.from(n),this.center=new T().from(t).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new cn(this.center,this.radius)}union(t){const n=this.center,s=this.radius,r=t.center,i=t.radius,o=an.copy(r).subtract(n),a=o.magnitude();if(s>=a+i)return this.clone();if(i>=a+s)return t.clone();const c=(s+a+i)*.5;return Al.copy(o).scale((-s+c)/a).add(n),this.center.copy(Al),this.radius=c,this}expand(t){const s=an.from(t).subtract(this.center).magnitude();return s>this.radius&&(this.radius=s),this}transform(t){this.center.transform(t);const n=lB(an,t);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(t){const n=this.distanceTo(t);return n*n}distanceTo(t){const s=an.from(t).subtract(this.center);return Math.max(0,s.len()-this.radius)}intersectPlane(t){const n=this.center,s=this.radius,i=t.normal.dot(n)+t.distance;return i<-s?mt.OUTSIDE:i<s?mt.INTERSECTING:mt.INSIDE}}const QT=new T,YT=new T,ds=new T,ms=new T,gs=new T,ZT=new T,tE=new T,Wt={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class As{constructor(t=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){I(this,"center",void 0),I(this,"halfAxes",void 0),this.center=new T().from(t),this.halfAxes=new rt(n)}get halfSize(){const t=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new T(t).len(),new T(n).len(),new T(s).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),r=new T(t).normalize(),i=new T(n).normalize(),o=new T(s).normalize();return new ei().fromMatrix3(new rt([...r,...i,...o]))}fromCenterHalfSizeQuaternion(t,n,s){const r=new ei(s),i=new rt().fromQuaternion(r);return i[0]=i[0]*n[0],i[1]=i[1]*n[0],i[2]=i[2]*n[0],i[3]=i[3]*n[1],i[4]=i[4]*n[1],i[5]=i[5]*n[1],i[6]=i[6]*n[2],i[7]=i[7]*n[2],i[8]=i[8]*n[2],this.center=new T().from(t),this.halfAxes=i,this}clone(){return new As(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new cn){const n=this.halfAxes,s=n.getColumn(0,ds),r=n.getColumn(1,ms),i=n.getColumn(2,gs),o=QT.copy(s).add(r).add(i);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const n=this.center,s=t.normal,r=this.halfAxes,i=s.x,o=s.y,a=s.z,c=Math.abs(i*r[Wt.COLUMN0ROW0]+o*r[Wt.COLUMN0ROW1]+a*r[Wt.COLUMN0ROW2])+Math.abs(i*r[Wt.COLUMN1ROW0]+o*r[Wt.COLUMN1ROW1]+a*r[Wt.COLUMN1ROW2])+Math.abs(i*r[Wt.COLUMN2ROW0]+o*r[Wt.COLUMN2ROW1]+a*r[Wt.COLUMN2ROW2]),l=s.dot(n)+t.distance;return l<=-c?mt.OUTSIDE:l>=c?mt.INSIDE:mt.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const n=YT.from(t).subtract(this.center),s=this.halfAxes,r=s.getColumn(0,ds),i=s.getColumn(1,ms),o=s.getColumn(2,gs),a=r.magnitude(),c=i.magnitude(),l=o.magnitude();r.normalize(),i.normalize(),o.normalize();let u=0,h;return h=Math.abs(n.dot(r))-a,h>0&&(u+=h*h),h=Math.abs(n.dot(i))-c,h>0&&(u+=h*h),h=Math.abs(n.dot(o))-l,h>0&&(u+=h*h),u}computePlaneDistances(t,n,s=[-0,-0]){let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,ds),l=a.getColumn(1,ms),u=a.getColumn(2,gs),h=ZT.copy(c).add(l).add(u).add(o),f=tE.copy(h).subtract(t);let d=n.dot(f);return r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).add(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).subtract(l).add(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).subtract(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).add(l).add(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).add(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).subtract(l).add(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).subtract(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),s[0]=r,s[1]=i,s}transform(t){this.center.transformAsPoint(t);const n=this.halfAxes.getColumn(0,ds);n.transformAsPoint(t);const s=this.halfAxes.getColumn(1,ms);s.transformAsPoint(t);const r=this.halfAxes.getColumn(2,gs);return r.transformAsPoint(t),this.halfAxes=new rt([...n,...s,...r]),this}getTransform(){throw new Error("not implemented")}}const pl=new T,yl=new T;class Ut{constructor(t=[0,0,1],n=0){I(this,"normal",void 0),I(this,"distance",void 0),this.normal=new T,this.distance=-0,this.fromNormalDistance(t,n)}fromNormalDistance(t,n){return St(Number.isFinite(n)),this.normal.from(t).normalize(),this.distance=n,this}fromPointNormal(t,n){t=pl.from(t),this.normal.from(n).normalize();const s=-this.normal.dot(t);return this.distance=s,this}fromCoefficients(t,n,s,r){return this.normal.set(t,n,s),St(Yt(this.normal.len(),1)),this.distance=r,this}clone(){return new Ut(this.normal,this.distance)}equals(t){return Yt(this.distance,t.distance)&&Yt(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const n=yl.copy(this.normal).transformAsVector(t).normalize(),s=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(s,n)}projectPointOntoPlane(t,n=[0,0,0]){const s=pl.from(t),r=this.getPointDistance(s),i=yl.copy(this.normal).scale(r);return s.subtract(i).to(n)}}const Bl=[new T([1,0,0]),new T([0,1,0]),new T([0,0,1])],Tl=new T,eE=new T;class Et{constructor(t=[]){I(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*Bl.length;const n=t.center,s=t.radius;let r=0;for(const i of Bl){let o=this.planes[r],a=this.planes[r+1];o||(o=this.planes[r]=new Ut),a||(a=this.planes[r+1]=new Ut);const c=Tl.copy(i).scale(-s).add(n);o.fromPointNormal(c,i);const l=Tl.copy(i).scale(s).add(n),u=eE.copy(i).negate();a.fromPointNormal(l,u),r+=2}return this}computeVisibility(t){let n=mt.INSIDE;for(const s of this.planes)switch(t.intersectPlane(s)){case mt.OUTSIDE:return mt.OUTSIDE;case mt.INTERSECTING:n=mt.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(t,n){if(St(Number.isFinite(n),"parentPlaneMask is required."),n===Et.MASK_OUTSIDE||n===Et.MASK_INSIDE)return n;let s=Et.MASK_INSIDE;const r=this.planes;for(let i=0;i<this.planes.length;++i){const o=i<31?1<<i:0;if(i<31&&!(n&o))continue;const a=r[i],c=t.intersectPlane(a);if(c===mt.OUTSIDE)return Et.MASK_OUTSIDE;c===mt.INTERSECTING&&(s|=o)}return s}}I(Et,"MASK_OUTSIDE",4294967295),I(Et,"MASK_INSIDE",0),I(Et,"MASK_INDETERMINATE",2147483647),new T,new T,new T,new T,new T,new T,new T,new T,new T,new T,new T,new T,new T,new T,new T,new T,new T,new rt,new rt,new rt,new rt,new rt,new T,new T,new T,new T,new T,new rt,new rt,new rt;const El=new T,ai=new T,ci=new Et([new Ut,new Ut,new Ut,new Ut,new Ut,new Ut]);function nE(e,t){const{cameraDirection:n,cameraUp:s,height:r}=e,{metersPerUnit:i}=e.distanceScales,o=ps(e,e.center),a=W.WGS84.eastNorthUpToFixedFrame(o),c=e.unprojectPosition(e.cameraPosition),l=W.WGS84.cartographicToCartesian(c,new T),u=new T(a.transformAsVector(new T(n).scale(i))).normalize(),h=new T(a.transformAsVector(new T(s).scale(i))).normalize();rE(e);const f=e.constructor,{longitude:d,latitude:m,width:g,bearing:A,zoom:y}=e,b=new f({longitude:d,latitude:m,height:r,width:g,bearing:A,zoom:y,pitch:0});return{camera:{position:l,direction:u,up:h},viewport:e,topDownViewport:b,height:r,cullingVolume:ci,frameNumber:t,sseDenominator:1.15}}function sE(e,t,n){if(n===0||e.length<=n)return[e,[]];const s=[],{longitude:r,latitude:i}=t.viewport;for(const[l,u]of e.entries()){const[h,f]=u.header.mbs,d=Math.abs(r-h),m=Math.abs(i-f),g=Math.sqrt(m*m+d*d);s.push([l,g])}const o=s.sort((l,u)=>l[1]-u[1]),a=[];for(let l=0;l<n;l++)a.push(e[o[l][0]]);const c=[];for(let l=n;l<o.length;l++)c.push(e[o[l][0]]);return[a,c]}function rE(e){const t=e.getFrustumPlanes(),n=Cl(t.near,e.cameraPosition),s=ps(e,n),r=ps(e,e.cameraPosition,ai);let i=0;ci.planes[i++].fromPointNormal(s,El.copy(s).subtract(r));for(const o in t){if(o==="near")continue;const a=t[o],c=Cl(a,n,ai),l=ps(e,c,ai);ci.planes[i++].fromPointNormal(l,El.copy(s).subtract(l))}}function Cl(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new T;const s=e.normal.dot(t);return n.copy(e.normal).scale(e.distance-s).add(t),n}function ps(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new T;const s=e.unprojectPosition(t);return W.WGS84.cartographicToCartesian(s,n)}const iE=6378137,oE=6378137,li=6356752314245179e-9,Re=new T;function aE(e,t){if(e instanceof As){const{halfAxes:n}=e,s=lE(n);return Math.log2(li/(s+t[2]))}else if(e instanceof cn){const{radius:n}=e;return Math.log2(li/(n+t[2]))}else if(e.width&&e.height){const{width:n,height:s}=e,r=Math.log2(iE/n),i=Math.log2(oE/s);return(r+i)/2}return 1}function bl(e,t,n){W.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],Re);const s=Math.sqrt(Math.pow(Re[0]-n[0],2)+Math.pow(Re[1]-n[1],2)+Math.pow(Re[2]-n[2],2));return Math.log2(li/(s+t[2]))}function cE(e,t,n){const[s,r,i,o]=e;return bl({xmin:s,xmax:i,ymin:r,ymax:o,zmin:0,zmax:0},t,n)}function lE(e){e.getColumn(0,Re);const t=e.getColumn(1),n=e.getColumn(2);return Re.add(t).add(n).len()}const uE=e=>typeof e=="boolean",ln=e=>typeof e=="function",un=e=>e!==null&&typeof e=="object",wl=e=>un(e)&&e.constructor==={}.constructor,hE=e=>!!e&&typeof e[Symbol.iterator]=="function",fE=e=>e&&typeof e[Symbol.asyncIterator]=="function",ue=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,he=e=>typeof Blob<"u"&&e instanceof Blob,dE=e=>e&&typeof e=="object"&&e.isBuffer,mE=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||un(e)&&ln(e.tee)&&ln(e.cancel)&&ln(e.getReader),gE=e=>un(e)&&ln(e.read)&&ln(e.pipe)&&uE(e.readable),_l=e=>mE(e)||gE(e),AE=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,pE=/^([-\w.]+\/[-\w.+]+)/;function yE(e){const t=pE.exec(e);return t?t[1]:e}function Ml(e){const t=AE.exec(e);return t?t[1]:""}const Rl=/\?.*/;function BE(e){const t=e.match(Rl);return t&&t[0]}function ui(e){return e.replace(Rl,"")}function ys(e){return ue(e)?e.url:he(e)?e.name||"":typeof e=="string"?e:""}function hi(e){if(ue(e)){const t=e,n=t.headers.get("content-type")||"",s=ui(t.url);return yE(n)||Ml(s)}return he(e)?e.type||"":typeof e=="string"?Ml(e):""}function TE(e){return ue(e)?e.headers["content-length"]||-1:he(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function Sl(e){if(ue(e))return e;const t={},n=TE(e);n>=0&&(t["content-length"]=String(n));const s=ys(e),r=hi(e);r&&(t["content-type"]=r);const i=await bE(e);i&&(t["x-first-bytes"]=i),typeof e=="string"&&(e=new TextEncoder().encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:s}),o}async function EE(e){if(!e.ok){const t=await CE(e);throw new Error(t)}}async function CE(e){let t=`Failed to fetch resource ${e.url} (${e.status}): `;try{const n=e.headers.get("Content-Type");let s=e.statusText;n!=null&&n.includes("application/json")&&(s+=` ${await e.text()}`),t+=s,t=t.length>60?`${t.slice(0,60)}...`:t}catch{}return t}async function bE(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const n=e.slice(0,5);return await new Promise(s=>{const r=new FileReader;r.onload=i=>{var o;return s(i==null||(o=i.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(n)})}if(e instanceof ArrayBuffer){const n=e.slice(0,5);return`data:base64,${wE(n)}`}return null}function wE(e){let t="";const n=new Uint8Array(e);for(let s=0;s<n.byteLength;s++)t+=String.fromCharCode(n[s]);return btoa(t)}function _E(e){return!ME(e)&&!RE(e)}function ME(e){return e.startsWith("http:")||e.startsWith("https:")}function RE(e){return e.startsWith("data:")}async function Il(e,t){if(typeof e=="string"){const r=WT(e);if(_E(r)){var n;if((n=globalThis.loaders)!==null&&n!==void 0&&n.fetchNode){var s;return(s=globalThis.loaders)===null||s===void 0?void 0:s.fetchNode(r,t)}}return await fetch(r,t)}return await Sl(e)}function SE(e){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=e||t;return!!(n&&n.indexOf("Electron")>=0)}function hn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||SE()}const Bs=globalThis.window||globalThis.self||globalThis.global,fn=globalThis.process||{},Ol=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";hn();function IE(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch{return null}}class OE{constructor(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";I(this,"storage",void 0),I(this,"id",void 0),I(this,"config",void 0),this.storage=IE(s),this.id=t,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let t={};if(this.storage){const n=this.storage.getItem(this.id);t=n?JSON.parse(n):{}}return Object.assign(this.config,t),this}}function xE(e){let t;return e<10?t="".concat(e.toFixed(2),"ms"):e<100?t="".concat(e.toFixed(1),"ms"):e<1e3?t="".concat(e.toFixed(0),"ms"):t="".concat((e/1e3).toFixed(2),"s"),t}function vE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}function fi(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>s&&(n=Math.min(n,s/e.width));const i=e.width*n,o=e.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(i,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let Ts;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ts||(Ts={}));const FE=10;function xl(e){return typeof e!="string"?e:(e=e.toUpperCase(),Ts[e]||Ts.WHITE)}function LE(e,t,n){if(!hn&&typeof e=="string"){if(t){const s=xl(t);e="\x1B[".concat(s,"m").concat(e,"\x1B[39m")}if(n){const s=xl(n);e="\x1B[".concat(s+FE,"m").concat(e,"\x1B[49m")}}return e}function DE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(e),s=Object.getOwnPropertyNames(n),r=e;for(const i of s){const o=r[i];typeof o=="function"&&(t.find(a=>i===a)||(r[i]=o.bind(e)))}}function Es(e,t){if(!e)throw new Error(t||"Assertion failed")}function Se(){let e;if(hn()&&Bs.performance){var t,n;e=Bs==null||(t=Bs.performance)===null||t===void 0||(n=t.now)===null||n===void 0?void 0:n.call(t)}else if("hrtime"in fn){var s;const r=fn==null||(s=fn.hrtime)===null||s===void 0?void 0:s.call(fn);e=r[0]*1e3+r[1]/1e6}else e=Date.now();return e}const Ie={debug:hn()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},GE={enabled:!0,level:0};function Ct(){}const vl={},Fl={once:!0};class di{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};I(this,"id",void 0),I(this,"VERSION",Ol),I(this,"_startTs",Se()),I(this,"_deltaTs",Se()),I(this,"_storage",void 0),I(this,"userData",{}),I(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new OE("__probe-".concat(this.id,"__"),GE),this.timeStamp("".concat(this.id," started")),DE(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Se()-this._startTs).toPrecision(10))}getDelta(){return Number((Se()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,n){this._storage.setConfiguration({[t]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,n){Es(t,n)}warn(t){return this._getLogFunction(0,t,Ie.warn,arguments,Fl)}error(t){return this._getLogFunction(0,t,Ie.error,arguments)}deprecated(t,n){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(t,n){return this.error("`".concat(t,"` has been removed. Use `").concat(n,"` instead"))}probe(t,n){return this._getLogFunction(t,n,Ie.log,arguments,{time:!0,once:!0})}log(t,n){return this._getLogFunction(t,n,Ie.debug,arguments)}info(t,n){return this._getLogFunction(t,n,console.info,arguments)}once(t,n){return this._getLogFunction(t,n,Ie.debug||Ie.info,arguments,Fl)}table(t,n,s){return n?this._getLogFunction(t,n,console.table||Ct,s&&[s],{tag:HE(n)}):Ct}image(t){let{logLevel:n,priority:s,image:r,message:i="",scale:o=1}=t;return this._shouldLog(n||s)?hn()?UE({image:r,message:i,scale:o}):PE():Ct}time(t,n){return this._getLogFunction(t,n,console.time?console.time:console.info)}timeEnd(t,n){return this._getLogFunction(t,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,n){return this._getLogFunction(t,n,console.timeStamp||Ct)}group(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=Dl({logLevel:t,message:n,opts:s}),{collapsed:i}=s;return r.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,n,Object.assign({},s,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Ct)}withGroup(t,n,s){this.group(t,n)();try{s()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Ll(t)}_getLogFunction(t,n,s,r,i){if(this._shouldLog(t)){i=Dl({logLevel:t,message:n,args:r,opts:i}),s=s||i.method,Es(s),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=Se();const o=i.tag||i.message;if(i.once&&o)if(!vl[o])vl[o]=Se();else return Ct;return n=NE(this.id,i.message,i),s.bind(console,n,...i.args)}return Ct}}I(di,"VERSION",Ol);function Ll(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Es(Number.isFinite(t)&&t>=0),t}function Dl(e){const{logLevel:t,message:n}=e;e.logLevel=Ll(t);const s=e.args?Array.from(e.args):[];for(;s.length&&s.shift()!==n;);switch(typeof t){case"string":case"function":n!==void 0&&s.unshift(n),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return Es(r==="string"||r==="object"),Object.assign(e,{args:s},e.opts)}function NE(e,t,n){if(typeof t=="string"){const s=n.time?vE(xE(n.total)):"";t=n.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),t=LE(t,n.color,n.background)}return t}function PE(e){return console.warn("removed"),Ct}function UE(e){let{image:t,message:n="",scale:s=1}=e;if(typeof t=="string"){const i=new Image;return i.onload=()=>{const o=fi(i,n,s);console.log(...o)},i.src=t,Ct}const r=t.nodeName||"";if(r.toLowerCase()==="img")return console.log(...fi(t,n,s)),Ct;if(r.toLowerCase()==="canvas"){const i=new Image;return i.onload=()=>console.log(...fi(i,n,s)),i.src=t.toDataURL(),Ct}return Ct}function HE(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}const Gl=new di({id:"loaders.gl"});class kE{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class $E{constructor(){this.console=void 0,this.console=console}log(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.log.bind(this.console,...n)}info(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.info.bind(this.console,...n)}warn(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.warn.bind(this.console,...n)}error(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.error.bind(this.console,...n)}}const Nl={fetch:null,mimeType:void 0,nothrow:!1,log:new $E,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:sl,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},VE={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Pl(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}function Ul(){const e=Pl();return e.globalOptions=e.globalOptions||{...Nl},e.globalOptions}function JE(e,t,n,s){return n=n||[],n=Array.isArray(n)?n:[n],WE(e,n),zE(t,e,s)}function WE(e,t){Hl(e,null,Nl,VE,t);for(const n of t){const s=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},i=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Hl(s,n.id,r,i,t)}}function Hl(e,t,n,s,r){const i=t||"Top level",o=t?`${t}.`:"";for(const a in e){const c=!t&&un(e[a]),l=a==="baseUri"&&!t,u=a==="workerUrl"&&t;if(!(a in n)&&!l&&!u){if(a in s)Gl.warn(`${i} loader option '${o}${a}' no longer supported, use '${s[a]}'`)();else if(!c){const h=jE(a,r);Gl.warn(`${i} loader option '${o}${a}' not recognized. ${h}`)()}}}}function jE(e,t){const n=e.toLowerCase();let s="";for(const r of t)for(const i in r.options){if(e===i)return`Did you mean '${r.id}.${i}'?`;const o=i.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(s=s||`Did you mean '${r.id}.${i}'?`)}return s}function zE(e,t,n){const r={...e.options||{}};return KE(r,n),r.log===null&&(r.log=new kE),kl(r,Ul()),kl(r,t),r}function kl(e,t){for(const n in t)if(n in t){const s=t[n];wl(s)&&wl(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function KE(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function mi(e){var t;return e?(Array.isArray(e)&&(e=e[0]),Array.isArray((t=e)===null||t===void 0?void 0:t.extensions)):!1}function $l(e){var t,n;Vt(e,"null loader"),Vt(mi(e),"invalid loader");let s;return Array.isArray(e)&&(s=e[1],e=e[0],e={...e,options:{...e.options,...s}}),((t=e)!==null&&t!==void 0&&t.parseTextSync||(n=e)!==null&&n!==void 0&&n.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const qE=()=>{const e=Pl();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function XE(){return qE()}const QE=new di({id:"loaders.gl"}),YE=/\.([^.]+)$/;async function ZE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!Jl(e))return null;let r=Vl(e,t,{...n,nothrow:!0},s);if(r)return r;if(he(e)&&(e=await e.slice(0,10).arrayBuffer(),r=Vl(e,t,n,s)),!r&&!(n!=null&&n.nothrow))throw new Error(Wl(e));return r}function Vl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!Jl(e))return null;if(t&&!Array.isArray(t))return $l(t);let r=[];t&&(r=r.concat(t)),n!=null&&n.ignoreRegisteredLoaders||r.push(...XE()),eC(r);const i=tC(e,r,n,s);if(!i&&!(n!=null&&n.nothrow))throw new Error(Wl(e));return i}function tC(e,t,n,s){const r=ys(e),i=hi(e),o=ui(r)||(s==null?void 0:s.url);let a=null,c="";if(n!=null&&n.mimeType&&(a=gi(t,n==null?void 0:n.mimeType),c=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||nC(t,o),c=c||(a?`matched url ${o}`:""),a=a||gi(t,i),c=c||(a?`matched MIME type ${i}`:""),a=a||rC(t,e),c=c||(a?`matched initial data ${zl(e)}`:""),n!=null&&n.fallbackMimeType&&(a=a||gi(t,n==null?void 0:n.fallbackMimeType),c=c||(a?`matched fallback MIME type ${i}`:"")),c){var l;QE.log(1,`selectLoader selected ${(l=a)===null||l===void 0?void 0:l.name}: ${c}.`)}return a}function Jl(e){return!(e instanceof Response&&e.status===204)}function Wl(e){const t=ys(e),n=hi(e);let s="No valid loader found (";s+=t?`${ml(t)}, `:"no url provided, ",s+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=e?zl(e):"";return s+=r?` first bytes: "${r}"`:"first bytes: not available",s+=")",s}function eC(e){for(const t of e)$l(t)}function nC(e,t){const n=t&&YE.exec(t),s=n&&n[1];return s?sC(e,s):null}function sC(e,t){t=t.toLowerCase();for(const n of e)for(const s of n.extensions)if(s.toLowerCase()===t)return n;return null}function gi(e,t){for(const n of e)if(n.mimeTypes&&n.mimeTypes.includes(t)||t===`application/x.${n.id}`)return n;return null}function rC(e,t){if(!t)return null;for(const n of e)if(typeof t=="string"){if(iC(t,n))return n}else if(ArrayBuffer.isView(t)){if(jl(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer&&jl(t,0,n))return n;return null}function iC(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>e.startsWith(s))}function jl(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>oC(e,t,n,r))}function oC(e,t,n,s){if(s instanceof ArrayBuffer)return vT(s,e,s.byteLength);switch(typeof s){case"function":return s(e);case"string":const r=Ai(e,t,s.length);return s===r;default:return!1}}function zl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?Ai(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Ai(e,0,t):""}function Ai(e,t,n){if(e.byteLength<t+n)return"";const s=new DataView(e);let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(s.getUint8(t+i));return r}const aC=256*1024;function*cC(e,t){const n=(t==null?void 0:t.chunkSize)||aC;let s=0;const r=new TextEncoder;for(;s<e.length;){const i=Math.min(e.length-s,n),o=e.slice(s,s+i);s+=i,yield r.encode(o)}}const lC=256*1024;function uC(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=lC}=t;let s=0;for(;s<e.byteLength;){const r=Math.min(e.byteLength-s,n),i=new ArrayBuffer(r),o=new Uint8Array(e,s,r);new Uint8Array(i).set(o),s+=r,yield i}}()}const hC=1024*1024;async function*fC(e,t){const n=(t==null?void 0:t.chunkSize)||hC;let s=0;for(;s<e.size;){const r=s+n,i=await e.slice(s,r).arrayBuffer();s=r,yield i}}function Kl(e,t){return sl?dC(e,t):mC(e)}async function*dC(e,t){const n=e.getReader();let s;try{for(;;){const r=s||n.read();t!=null&&t._streamReadAhead&&(s=n.read());const{done:i,value:o}=await r;if(i)return;yield dl(o)}}catch{n.releaseLock()}}async function*mC(e,t){for await(const n of e)yield dl(n)}function gC(e,t){if(typeof e=="string")return cC(e,t);if(e instanceof ArrayBuffer)return uC(e,t);if(he(e))return fC(e,t);if(_l(e))return Kl(e,t);if(ue(e))return Kl(e.body,t);throw new Error("makeIterator")}const ql="Cannot convert supplied data type";function AC(e,t,n){if(t.text&&typeof e=="string")return e;if(dE(e)&&(e=e.buffer),e instanceof ArrayBuffer){const s=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let s=e.buffer;const r=e.byteLength||e.length;return(e.byteOffset!==0||r!==s.byteLength)&&(s=s.slice(e.byteOffset,e.byteOffset+r)),s}throw new Error(ql)}async function pC(e,t,n){const s=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||s)return AC(e,t);if(he(e)&&(e=await Sl(e)),ue(e)){const r=e;return await EE(r),t.binary?await r.arrayBuffer():await r.text()}if(_l(e)&&(e=gC(e,n)),hE(e)||fE(e))return DT(e);throw new Error(ql)}function Xl(e,t){const n=Ul(),s=e||n;return typeof s.fetch=="function"?s.fetch:un(s.fetch)?r=>Il(r,s.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:Il}function yC(e,t,n){if(n)return n;const s={fetch:Xl(t,e),...e};if(s.url){const r=ui(s.url);s.baseUrl=r,s.queryString=BE(s.url),s.filename=ml(r),s.baseUrl=gl(r)}return Array.isArray(s.loaders)||(s.loaders=null),s}function BC(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const s=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...s]:s}return n&&n.length?n:void 0}async function Cs(e,t,n,s){t&&!Array.isArray(t)&&!mi(t)&&(s=void 0,n=t,t=void 0),e=await e,n=n||{};const r=ys(e),o=BC(t,s),a=await ZE(e,o,n);return a?(n=JE(n,a,o,r),s=yC({url:r,_parse:Cs,loaders:o},n,s||null),await TC(a,e,n,s)):null}async function TC(e,t,n,s){if(ST(e),n=AT(e.options,n),ue(t)){const i=t,{ok:o,redirected:a,status:c,statusText:l,type:u,url:h}=i,f=Object.fromEntries(i.headers.entries());s.response={headers:f,ok:o,redirected:a,status:c,statusText:l,type:u,url:h}}t=await pC(t,e,n);const r=e;if(r.parseTextSync&&typeof t=="string")return r.parseTextSync(t,n,s);if(IT(e,n))return await OT(e,t,n,s,Cs);if(r.parseText&&typeof t=="string")return await r.parseText(t,n,s);if(r.parse)return await r.parse(t,n,s);throw Zt(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}async function Ql(e,t,n,s){let r,i;!Array.isArray(t)&&!mi(t)?(r=[],i=t):(r=t,i=n);const o=Xl(i);let a=e;return typeof e=="string"&&(a=await o(e)),he(e)&&(a=await o(e)),Array.isArray(r)?await Cs(a,r,i):await Cs(a,r,i)}const lt={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};let fe=function(e){return e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE",e}({}),pi=function(e){return e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh",e}({}),xt=function(e){return e.I3S="I3S",e.TILES3D="TILES3D",e}({});(function(e){return e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold",e})({});const EC={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function Yl(e){return e!=null}const nt=new T,bs=new T,CC=new T,bC=new T,de=new T,Zl=new T,tu=new T,eu=new T;function yi(e,t,n){if(Vt(e,"3D Tile: boundingVolume must be defined"),e.box)return nu(e.box,t,n);if(e.region)return MC(e.region);if(e.sphere)return _C(e.sphere,t,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function wC(e,t){if(e.box)return RC(t);if(e.region){const[n,s,r,i,o,a]=e.region;return[[Rt(n),Rt(s),o],[Rt(r),Rt(i),a]]}if(e.sphere)return SC(t);throw new Error("Unkown boundingVolume type")}function nu(e,t,n){const s=new T(e[0],e[1],e[2]);t.transform(s,s);let r=[];if(e.length===10){const l=e.slice(3,6),u=new ei;u.fromArray(e,6);const h=new T([1,0,0]),f=new T([0,1,0]),d=new T([0,0,1]);h.transformByQuaternion(u),h.scale(l[0]),f.transformByQuaternion(u),f.scale(l[1]),d.transformByQuaternion(u),d.scale(l[2]),r=[...h.toArray(),...f.toArray(),...d.toArray()]}else r=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const i=t.transformAsVector(r.slice(0,3)),o=t.transformAsVector(r.slice(3,6)),a=t.transformAsVector(r.slice(6,9)),c=new rt([i[0],i[1],i[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return Yl(n)?(n.center=s,n.halfAxes=c,n):new As(s,c)}function _C(e,t,n){const s=new T(e[0],e[1],e[2]);t.transform(s,s);const r=t.getScale(bs),i=Math.max(Math.max(r[0],r[1]),r[2]),o=e[3]*i;return Yl(n)?(n.center=s,n.radius=o,n):new cn(s,o)}function MC(e){const[t,n,s,r,i,o]=e,a=W.WGS84.cartographicToCartesian([Rt(t),Rt(r),i],CC),c=W.WGS84.cartographicToCartesian([Rt(s),Rt(n),o],bC),l=new T().addVectors(a,c).multiplyByScalar(.5);return W.WGS84.cartesianToCartographic(l,de),W.WGS84.cartographicToCartesian([Rt(s),de[1],de[2]],Zl),W.WGS84.cartographicToCartesian([de[0],Rt(r),de[2]],tu),W.WGS84.cartographicToCartesian([de[0],de[1],o],eu),nu([...l,...Zl.subtract(l),...tu.subtract(l),...eu.subtract(l)],new X)}function RC(e){const t=su(),{halfAxes:n}=e,s=new T(n.getColumn(0)),r=new T(n.getColumn(1)),i=new T(n.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let c=0;c<2;c++)nt.copy(e.center),nt.add(s),nt.add(r),nt.add(i),ru(t,nt),i.negate();r.negate()}s.negate()}return t}function SC(e){const t=su(),{center:n,radius:s}=e,r=W.WGS84.scaleToGeodeticSurface(n,nt);let i;r?i=W.WGS84.geodeticSurfaceNormal(r):i=new T(0,0,1);let o=new T(i[2],-i[1],0);o.len()>0?o.normalize():o=new T(0,1,0);const a=o.clone().cross(i);for(const c of[o,a,i]){bs.copy(c).scale(s);for(let l=0;l<2;l++)nt.copy(n),nt.add(bs),ru(t,nt),bs.negate()}return t}function su(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function ru(e,t){W.WGS84.cartesianToCartographic(t,nt),e[0][0]=Math.min(e[0][0],nt[0]),e[0][1]=Math.min(e[0][1],nt[1]),e[0][2]=Math.min(e[0][2],nt[2]),e[1][0]=Math.max(e[1][0],nt[0]),e[1][1]=Math.max(e[1][1],nt[1]),e[1][2]=Math.max(e[1][2],nt[2])}new T,new T,new X,new T,new T,new T;function IC(e,t){const n=e*t;return 1-Math.exp(-(n*n))}function OC(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const n=e.dynamicScreenSpaceErrorComputedDensity,s=e.dynamicScreenSpaceErrorFactor;return IC(t,n)*s}return 0}function xC(e,t,n){const s=e.tileset,r=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,i=n?r:e.lodMetricValue;if(i===0)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:c}=t,{viewDistanceScale:l}=s.options;let u=i*a*(l||1)/(o*c);return u-=OC(s,o),u}const Bi=new T,iu=new T,te=new T,ou=new T,vC=new T,Ti=new X,au=new X;function FC(e,t){if(e.lodMetricValue===0||isNaN(e.lodMetricValue))return"DIG";const n=2*cu(e,t);return n<2?"OUT":!e.header.children||n<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}function cu(e,t){const{topDownViewport:n}=t,s=e.header.mbs[1],r=e.header.mbs[0],i=e.header.mbs[2],o=e.header.mbs[3],a=[...e.boundingVolume.center],c=n.unprojectPosition(n.cameraPosition);W.WGS84.cartographicToCartesian(c,Bi),iu.copy(Bi).subtract(a).normalize(),W.WGS84.eastNorthUpToFixedFrame(a,Ti),au.copy(Ti).invert(),te.copy(Bi).transform(au);const l=Math.sqrt(te[0]*te[0]+te[1]*te[1]),u=l*l/te[2];ou.copy([te[0],te[1],u]);const f=ou.transform(Ti).subtract(a).normalize(),m=iu.cross(f).normalize().scale(o).add(a),g=W.WGS84.cartesianToCartographic(m),A=n.project([r,s,i]),y=n.project(g);return vC.copy(A).subtract(y).magnitude()}function LC(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}class lu{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this._map=new Map,this._array=void 0,this._length=void 0,this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return Vt(t<this._array.length),this._array[t]}set(t,n){Vt(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=n,this._map.set(n,t)}delete(t){const n=this._map.get(t);n>=0&&(this._array.splice(n,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const n=this.length++;this._array[n]=t,this._map.set(t,n)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){Vt(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){Vt(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const DC={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class ws{traversalFinished(t){return!0}constructor(t){this.options=void 0,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={},this.lastUpdate=new Date().getTime(),this.updateDebounceTime=1e3,this._traversalStack=new lu,this._emptyTraversalStack=new lu,this._frameNumber=null,this.options={...DC,...t}}traverse(t,n,s){this.root=t,this.options={...this.options,...s},this.reset(),this.updateTile(t,n),this._frameNumber=n.frameNumber,this.executeTraversal(t,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,n){const s=this._traversalStack;for(t._selectionDepth=1,s.push(t);s.length>0;){const i=s.pop();let o=!1;this.canTraverse(i,n)&&(this.updateChildTiles(i,n),o=this.updateAndPushChildren(i,n,s,i.hasRenderContent?i._selectionDepth+1:i._selectionDepth));const a=i.parent,c=!!(!a||a._shouldRefine),l=!o;i.hasRenderContent?i.refine===fe.ADD?(this.loadTile(i,n),this.selectTile(i,n)):i.refine===fe.REPLACE&&(this.loadTile(i,n),l&&this.selectTile(i,n)):(this.emptyTiles[i.id]=i,this.loadTile(i,n),l&&this.selectTile(i,n)),this.touchTile(i,n),i._shouldRefine=o&&c}const r=new Date().getTime();(this.traversalFinished(n)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(n))}updateChildTiles(t,n){const s=t.children;for(const r of s)this.updateTile(r,n)}updateAndPushChildren(t,n,s,r){const{loadSiblings:i,skipLevelOfDetail:o}=this.options,a=t.children;a.sort(this.compareDistanceToCamera.bind(this));const c=t.refine===fe.REPLACE&&t.hasRenderContent&&!o;let l=!1,u=!0;for(const h of a)if(h._selectionDepth=r,h.isVisibleAndInRequestVolume?(s.find(h)&&s.delete(h),s.push(h),l=!0):(c||i)&&(this.loadTile(h,n),this.touchTile(h,n)),c){let f;if(h._inRequestVolume?h.hasRenderContent?f=h.contentAvailable:f=this.executeEmptyTraversal(h,n):f=!1,u=u&&f,!u)return!1}return l||(u=!1),u}updateTile(t,n){this.updateTileVisibility(t,n)}selectTile(t,n){this.shouldSelectTile(t)&&(t._selectedFrame=n.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,n){this.shouldLoadTile(t)&&(t._requestedFrame=n.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,n){t.tileset._cache.touch(t),t._touchedFrame=n.frameNumber}canTraverse(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!r&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,n,s):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=t._screenSpaceError;return s&&(r=t.getScreenSpaceError(n,!0)),r>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,n){const s=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===n.viewport.id&&s.push(r);else s.push(n.viewport.id);t.updateVisibility(n,s)}compareDistanceToCamera(t,n){return t._distanceToCamera-n._distanceToCamera}anyChildrenVisible(t,n){let s=!1;for(const r of t.children)r.updateVisibility(n),s=s||r.isVisibleAndInRequestVolume;return s}executeEmptyTraversal(t,n){let s=!0;const r=this._emptyTraversalStack;for(r.push(t);r.length>0;){const i=r.pop(),o=!i.hasRenderContent&&this.canTraverse(i,n,!1,!1),a=!i.hasRenderContent&&i.children.length===0;if(!o&&!i.contentAvailable&&!a&&(s=!1),this.updateTile(i,n),i.isVisibleAndInRequestVolume||(this.loadTile(i,n),this.touchTile(i,n)),o){const c=i.children;for(const l of c)r.push(l)}}return s}}const uu=new T;function GC(e){return e!=null}class Ei{constructor(t,n,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";this.tileset=void 0,this.header=void 0,this.id=void 0,this.url=void 0,this.parent=void 0,this.refine=void 0,this.type=void 0,this.contentUrl=void 0,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=lt.UNLOADED,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this.viewportIds=[],this.transform=new X,this.extensions=null,this.implicitTiling=null,this.userData={},this.computedTransform=void 0,this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.traverser=new ws({}),this._cacheNode=null,this._frameNumber=null,this._expireDate=null,this._expiredContent=null,this._boundingBox=void 0,this._distanceToCamera=0,this._screenSpaceError=0,this._visibilityPlaneMask=void 0,this._visible=void 0,this._contentBoundingVolume=void 0,this._viewerRequestVolume=void 0,this._initialTransform=new X,this._priority=0,this._selectedFrame=0,this._requestedFrame=0,this._selectionDepth=0,this._touchedFrame=0,this._centerZDepth=0,this._shouldRefine=!1,this._stackLength=0,this._visitedFrame=0,this._inRequestVolume=!1,this._lodJudge=null,this.header=n,this.tileset=t,this.id=r||n.id,this.url=n.url,this.parent=s,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===lt.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===lt.UNLOADED}get contentExpired(){return this.contentState===lt.EXPIRED}get contentFailed(){return this.contentState===lt.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=wC(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,n){switch(this.tileset.type){case xt.I3S:return cu(this,t);case xt.TILES3D:return xC(this,t,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:n}=t.options,s=this.refine===fe.ADD||n;if(s&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===lt.UNLOADED)return-1;const r=this.parent,o=r&&(!s||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,a=t.root?t.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=lt.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=lt.UNLOADED,!1;try{const s=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,i={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await Ql(s,r,i),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=lt.READY,this._onContentLoaded(),!0}catch(s){throw this.contentState=lt.FAILED,s}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=lt.UNLOADED,!0}updateVisibility(t,n){if(this._frameNumber===t.frameNumber)return;const s=this.parent,r=s?s._visibilityPlaneMask:Et.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const i=s?s.computedTransform:this.tileset.modelMatrix;this._updateTransform(i)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,r),this._visible=this._visibilityPlaneMask!==Et.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=n}visibility(t,n){const{cullingVolume:s}=t,{boundingVolume:r}=this;return s.computeVisibilityWithPlaneMask(r,n)}contentVisibility(){return!0}distanceToTile(t){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:n}=t;const s=this.boundingVolume;return uu.subVectors(s.center,n.position),n.direction.dot(uu)}insideViewerRequestVolume(t){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(GC(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=lt.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new X(t.transform):new X;const n=this.parent,s=this.tileset,r=n&&n.computedTransform?n.computedTransform.clone():s.modelMatrix.clone();this.computedTransform=new X(r).multiplyRight(this.transform);const i=n&&n._initialTransform?n._initialTransform.clone():new X;this._initialTransform=new X(i).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=lt.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Et.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||fe.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=yi(t.boundingVolume,this.computedTransform,this.boundingVolume);const n=t.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=yi(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=yi(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new X).clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return LC(this.tileset.tileset)}}}class NC extends ws{compareDistanceToCamera(t,n){return n._distanceToCamera===0&&t._distanceToCamera===0?n._centerZDepth-t._centerZDepth:n._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,n){if(super.updateTileVisibility(t,n),!t.isVisibleAndInRequestVolume)return;const s=t.children.length>0;if(t.hasTilesetContent&&s){const o=t.children[0];this.updateTileVisibility(o,n),t._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(t,n)){t._visible=!1;return}const r=t.refine===fe.REPLACE,i=t._optimChildrenWithinParent===EC.USE_OPTIMIZATION;if(r&&i&&s&&!this.anyChildrenVisible(t,n)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,n){const{parent:s}=t;return!s||s.hasTilesetContent||s.refine!==fe.ADD?!1:!this.shouldRefine(t,n,!0)}}class PC{constructor(){this.frameNumberMap=new Map}register(t,n){const s=this.frameNumberMap.get(t)||new Map,r=s.get(n)||0;s.set(n,r+1),this.frameNumberMap.set(t,s)}deregister(t,n){const s=this.frameNumberMap.get(t);if(!s)return;const r=s.get(n)||1;s.set(n,r-1)}isZero(t,n){var s;return(((s=this.frameNumberMap.get(t))===null||s===void 0?void 0:s.get(n))||0)===0}}const Ci={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class UC{constructor(){this._statusMap=void 0,this.pendingTilesRegister=new PC,this._statusMap={}}add(t,n,s,r){if(!this._statusMap[n]){const{frameNumber:i,viewport:{id:o}}=r;this._statusMap[n]={request:t,callback:s,key:n,frameState:r,status:Ci.REQUESTED},this.pendingTilesRegister.register(o,i),t().then(a=>{this._statusMap[n].status=Ci.COMPLETED;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),this._statusMap[n].callback(a,r)}).catch(a=>{this._statusMap[n].status=Ci.ERROR;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),s(a)})}}update(t,n){if(this._statusMap[t]){const{frameNumber:s,viewport:{id:r}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(r,s);const{frameNumber:i,viewport:{id:o}}=n;this.pendingTilesRegister.register(o,i),this._statusMap[t].frameState=n}}find(t){return this._statusMap[t]}hasPendingTiles(t,n){return!this.pendingTilesRegister.isZero(t,n)}}class HC extends ws{constructor(t){super(t),this._tileManager=void 0,this._tileManager=new UC}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,n){return t._lodJudge=FC(t,n),t._lodJudge==="DIG"}updateChildTiles(t,n){const s=t.header.children||[],r=t.children,i=t.tileset;for(const o of s){const a=`${o.id}-${n.viewport.id}`,c=r&&r.find(l=>l.id===a);if(c)c&&this.updateTile(c,n);else{let l=()=>this._loadTile(o.id,i);this._tileManager.find(a)?this._tileManager.update(a,n):(i.tileset.nodePages&&(l=()=>i.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(l,a,h=>this._onTileLoad(h,t,a),n))}}return!1}async _loadTile(t,n){const{loader:s}=n,r=n.getTileUrl(`${n.url}/nodes/${t}`),i={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await Ql(r,s,i)}_onTileLoad(t,n,s){const r=new Ei(n.tileset,t,n,s);n.children.push(r);const i=this._tileManager.find(r.id).frameState;this.updateTile(r,i),this._frameNumber===i.frameNumber&&(this.traversalFinished(i)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,i)}}const kC={description:"",ellipsoid:W.WGS84,modelMatrix:new X,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},_s="Tiles In Tileset(s)",bi="Tiles In Memory",hu="Tiles In View",fu="Tiles To Render",du="Tiles Loaded",wi="Tiles Loading",mu="Tiles Unloaded",gu="Failed Tile Loads",Au="Points/Vertices",_i="Tile Memory Use",pu="Maximum Screen Space Error";class $C{constructor(t,n){this.options=void 0,this.loadOptions=void 0,this.type=void 0,this.tileset=void 0,this.loader=void 0,this.url=void 0,this.basePath=void 0,this.modelMatrix=void 0,this.ellipsoid=void 0,this.lodMetricType=void 0,this.lodMetricValue=void 0,this.refine=void 0,this.root=null,this.roots={},this.asset={},this.description="",this.properties=void 0,this.extras=null,this.attributions={},this.credits={},this.stats=void 0,this.contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.dynamicScreenSpaceErrorComputedDensity=0,this.maximumMemoryUsage=32,this.gpuMemoryUsageInBytes=0,this.memoryAdjustedScreenSpaceError=0,this._cacheBytes=0,this._cacheOverflowBytes=0,this._frameNumber=0,this._queryParams={},this._extensionsUsed=[],this._tiles={},this._pendingCount=0,this.selectedTiles=[],this.traverseCounter=0,this.geometricError=0,this.lastUpdatedVieports=null,this._requestedTiles=[],this._emptyTiles=[],this.frameStateData={},this._traverser=void 0,this._cache=new qT,this._requestScheduler=void 0,this.updatePromise=null,this.tilesetInitializationPromise=void 0,this.options={...kC,...n},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||gl(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new VT({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new gT({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let s=t;return this.queryParams.length&&(s=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),s}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const s=[];for(const r of n){const i=r.id;this._needTraverse(i)?s.push(i):this.traverseCounter--}for(const r of n){const i=r.id;if(this.roots[i]||(this.roots[i]=this._initializeTileHeaders(this.tileset,null)),!s.includes(i))continue;const o=nE(r,this._frameNumber);this._traverser.traverse(this.roots[i],o,this.options)}}_needTraverse(t){let n=t;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[t]),n===t}_onTraversalEnd(t){const n=t.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const s=this.frameStateData[n],r=Object.values(this._traverser.selectedTiles),[i,o]=sE(r,t,this.options.maximumTilesSelected);s.selectedTiles=i;for(const a of o)a.unselect();s._requestedTiles=Object.values(this._traverser.requestedTiles),s._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const n=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,n){if(t.length!==n.length)return!0;const s=new Set(t.map(o=>o.id)),r=new Set(n.map(o=>o.id));let i=t.filter(o=>!r.has(o.id)).length>0;return i=i||n.filter(o=>!s.has(o.id)).length>0,i}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,n)=>t._unloadTile(n))}_updateStats(){let t=0,n=0;for(const s of this.selectedTiles)s.contentAvailable&&s.content&&(t++,s.content.pointCount?n+=s.content.pointCount:n+=s.content.vertexCount);this.stats.get(hu).count=this.selectedTiles.length,this.stats.get(fu).count=t,this.stats.get(Au).count=n,this.stats.get(pu).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===xt.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===xt.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===xt.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const n=this.tileset.fullExtent;if(n){const{xmin:r,xmax:i,ymin:o,ymax:a,zmin:c,zmax:l}=n;this.cartographicCenter=new T(r+(i-r)/2,o+(a-o)/2,c+(l-c)/2),this.cartesianCenter=new T,W.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=bl(n,this.cartographicCenter,this.cartesianCenter);return}const s=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(s){const[r,i,o,a]=s;this.cartographicCenter=new T(r+(o-r)/2,i+(a-i)/2,0),this.cartesianCenter=new T,W.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=cE(s,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new T,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:n}=t.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new T,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?(this.cartographicCenter=new T,W.WGS84.cartesianToCartographic(n,this.cartographicCenter)):this.cartographicCenter=new T(0,0,-W.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=aE(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(_s),this.stats.get(wi),this.stats.get(bi),this.stats.get(hu),this.stats.get(fu),this.stats.get(du),this.stats.get(mu),this.stats.get(gu),this.stats.get(Au),this.stats.get(_i,"memory"),this.stats.get(pu)}_initializeTileHeaders(t,n){const s=new Ei(this,t.root,n);if(n&&(n.children.push(s),s.depth=n.depth+1),this.type===xt.TILES3D){const i=[];for(i.push(s);i.length>0;){const o=i.pop();this.stats.get(_s).incrementCount();const a=o.header.children||[];for(const c of a){var r;const l=new Ei(this,c,o);if((r=l.contentUrl)!==null&&r!==void 0&&r.includes("?session=")){const h=new URL(l.contentUrl).searchParams.get("session");h&&(this._queryParams.session=h)}o.children.push(l),l.depth=o.depth+1,i.push(l)}}}return s}_initializeTraverser(){let t;switch(this.type){case xt.TILES3D:t=NC;break;case xt.I3S:t=HC;break;default:t=ws}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let n;try{this._onStartTileLoading(),n=await t.loadContent()}catch(s){this._onTileLoadError(t,s instanceof Error?s:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,n)}}_onTileLoadError(t,n){this.stats.get(gu).incrementCount();const s=n.message||n.toString(),r=t.url;console.error(`A 3D tile failed to load: ${t.url} ${s}`),this.options.onTileError(t,s,r)}_onTileLoad(t,n){if(n){if(this.type===xt.I3S){var s,r;const i=((s=this.tileset)===null||s===void 0||(r=s.nodePagesTile)===null||r===void 0?void 0:r.nodesInNodePages)||0;this.stats.get(_s).reset(),this.stats.get(_s).addCount(i)}t&&t.content&&XT(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===xt.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===xt.TILES3D){var n;const{extensionsRemoved:s=[]}=((n=t.content)===null||n===void 0?void 0:n.gltf)||{};s.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),s.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),s.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(wi).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(wi).decrementCount()}_addTileToCache(t){this._cache.add(this,t,n=>n._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(du).incrementCount(),this.stats.get(bi).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(_i).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(bi).decrementCount(),this.stats.get(mu).incrementCount(),this.stats.get(_i).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const n=t.pop();for(const s of n.children)t.push(s);this._destroyTile(n)}this.root=null}_destroySubtree(t){const n=t,s=[];for(s.push(n);s.length>0;){t=s.pop();for(const r of t.children)s.push(r);t!==n&&this._destroyTile(t)}n.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const n=new URLSearchParams(t.queryString),s=Object.fromEntries(n.entries());this._queryParams={...this._queryParams,...s}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}function VC(e){let t=0;for(const s in e.attributes){const r=e.getAttribute(s);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}function yu(e){const n=document.createElement("canvas");n.width=64,n.height=64;const s=n.getContext("2d");s.rect(0,0,64,64);const r=s.createLinearGradient(0,0,64,64);for(let o=0;o<e.length;o++){const a=e[o];r.addColorStop(a[0],"#"+a[1].getHexString())}s.fillStyle=r,s.fill();const i=new p.CanvasTexture(n);return i.needsUpdate=!0,i.minFilter=p.LinearFilter,i.wrapS=p.RepeatWrapping,i.wrapT=p.RepeatWrapping,i.repeat.set(2,2),i}function Bu(e){e.updateMatrix(),e.updateMatrixWorld(),e.matrixWorldInverse.copy(e.matrixWorld).invert();const t=new p.Frustum;return t.setFromProjectionMatrix(new p.Matrix4().multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),t}function JC(e){const t=new p.Group,n=new p.PlaneGeometry(10,5),s=new p.Vector3(...e.projectPointOntoPlane([0,0,0])),r=new p.Vector3(e.normal.x,e.normal.y,e.normal.z),i=new p.Vector3().copy(s).add(r);n.lookAt(i),n.translate(s.x,s.y,s.z);const o=new p.MeshBasicMaterial({color:65535,side:p.DoubleSide}),a=new p.Mesh(n,o),c=new p.ArrowHelper(r,s,5,16776960);return t.add(c),t.add(a),t}function Tu(e){const{boundingVolume:t}=e;let n=0;e.content&&(n=Math.min(e.content.byteLength/5e5,1));const s=new p.Color(n,1,0),r=new p.BoxGeometry(1,1,1),i=new p.Matrix4;t.halfAxes?i.copy(Eu(t.halfAxes)):t.radius&&r.scale(t.radius*2,t.radius*2,t.radius*2),r.applyMatrix4(i);const o=new p.EdgesGeometry(r),a=new p.LineSegments(o,new p.LineBasicMaterial({color:s}));return a.position.copy(new p.Vector3(...t.center)),a}function Eu(e){const t=e;return new p.Matrix4().fromArray([t[0]*2,t[1]*2,t[2]*2,0,t[3]*2,t[4]*2,t[5]*2,0,t[6]*2,t[7]*2,t[8]*2,0,0,0,0,1])}function WC(e,t){const r=2*Math.PI*6378137/2,i=t*r/180;let o=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return o=o*r/180,new p.Vector2(i,o)}function jC(e){let t=0;if(e.userData.mimeType=="image/ktx2"&&e.mipmaps){for(let n=0;n<e.mipmaps.length;n++)t+=e.mipmaps[n].data.byteLength;return t}else if(e.image){const{image:n}=e,s=4;let r=[n.width,n.height];for(;r[0]>1||r[1]>1;)t+=r[0]*r[1]*s,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return t+=1*1*s,t}else return}function Cu(e){return VC(e)}const bu={SPECTRAL:[[0,new p.Color(.3686,.3098,.6353)],[.1,new p.Color(.1961,.5333,.7412)],[.2,new p.Color(.4,.7608,.6471)],[.3,new p.Color(.6706,.8667,.6431)],[.4,new p.Color(.902,.9608,.5961)],[.5,new p.Color(1,1,.749)],[.6,new p.Color(.9961,.8784,.5451)],[.7,new p.Color(.9922,.6824,.3804)],[.8,new p.Color(.9569,.4275,.2627)],[.9,new p.Color(.8353,.2431,.3098)],[1,new p.Color(.6196,.0039,.2588)]],PLASMA:[[0,new p.Color(.241,.015,.61)],[.1,new p.Color(.387,.001,.654)],[.2,new p.Color(.524,.025,.653)],[.3,new p.Color(.651,.125,.596)],[.4,new p.Color(.752,.227,.513)],[.5,new p.Color(.837,.329,.431)],[.6,new p.Color(.907,.435,.353)],[.7,new p.Color(.963,.554,.272)],[.8,new p.Color(.992,.681,.195)],[.9,new p.Color(.987,.822,.144)],[1,new p.Color(.94,.975,.131)]],YELLOW_GREEN:[[0,new p.Color(.1647,.2824,.3451)],[.1,new p.Color(.1338,.3555,.4227)],[.2,new p.Color(.061,.4319,.4864)],[.3,new p.Color(0,.5099,.5319)],[.4,new p.Color(0,.5881,.5569)],[.5,new p.Color(.137,.665,.5614)],[.6,new p.Color(.2906,.7395,.5477)],[.7,new p.Color(.4453,.8099,.5201)],[.8,new p.Color(.6102,.8748,.485)],[.9,new p.Color(.7883,.9323,.4514)],[1,new p.Color(.9804,.9804,.4314)]],VIRIDIS:[[0,new p.Color(.267,.005,.329)],[.1,new p.Color(.283,.141,.458)],[.2,new p.Color(.254,.265,.53)],[.3,new p.Color(.207,.372,.553)],[.4,new p.Color(.164,.471,.558)],[.5,new p.Color(.128,.567,.551)],[.6,new p.Color(.135,.659,.518)],[.7,new p.Color(.267,.749,.441)],[.8,new p.Color(.478,.821,.318)],[.9,new p.Color(.741,.873,.15)],[1,new p.Color(.993,.906,.144)]],INFERNO:[[0,new p.Color(.077,.042,.206)],[.1,new p.Color(.225,.036,.388)],[.2,new p.Color(.373,.074,.432)],[.3,new p.Color(.522,.128,.42)],[.4,new p.Color(.665,.182,.37)],[.5,new p.Color(.797,.255,.287)],[.6,new p.Color(.902,.364,.184)],[.7,new p.Color(.969,.516,.063)],[.8,new p.Color(.988,.683,.072)],[.9,new p.Color(.961,.859,.298)],[1,new p.Color(.988,.998,.645)]],GRAYSCALE:[[0,new p.Color(0,0,0)],[1,new p.Color(1,1,1)]],TURBO:[[0,new p.Color(.18995,.07176,.23217)],[.07,new p.Color(.25107,.25237,.63374)],[.13,new p.Color(.27628,.42118,.89123)],[.2,new p.Color(.25862,.57958,.99876)],[.27,new p.Color(.15844,.73551,.92305)],[.33,new p.Color(.09267,.86554,.7623)],[.4,new p.Color(.19659,.94901,.59466)],[.47,new p.Color(.42778,.99419,.38575)],[.53,new p.Color(.64362,.98999,.23356)],[.6,new p.Color(.80473,.92452,.20459)],[.67,new p.Color(.93301,.81236,.22667)],[.73,new p.Color(.99314,.67408,.20348)],[.8,new p.Color(.9836,.49291,.12849)],[.87,new p.Color(.92105,.31489,.05475)],[.93,new p.Color(.81608,.18462,.01809)],[1,new p.Color(.66449,.08436,.00424)]],RAINBOW:[[0,new p.Color(.278,0,.714)],[1/6,new p.Color(0,0,1)],[2/6,new p.Color(0,1,1)],[3/6,new p.Color(0,1,0)],[4/6,new p.Color(1,1,0)],[5/6,new p.Color(1,.64,0)],[1,new p.Color(1,0,0)]],CONTOUR:[[0,new p.Color(0,0,0)],[.03,new p.Color(0,0,0)],[.04,new p.Color(1,1,1)],[1,new p.Color(1,1,1)]]},zC=`
  varying vec3 vColor;
  uniform float alpha;

  void main() {
    if (vColor == vec3(0.0, 0.0, 0.0)) {
      discard;
    } else {
      gl_FragColor = vec4( vColor, alpha);
    }
  }
`,KC=`
  varying vec3 vColor;
  uniform sampler2D gradient;
  uniform sampler2D grayscale;
  attribute float intensity;
  attribute float classification;
  uniform vec3 rootCenter;
  uniform vec3 rootNormal;
  uniform vec2 elevationRange;
  uniform int coloring;
  uniform bool hideGround;
  uniform float maxIntensity;
  uniform float intensityContrast;
  uniform float pointSize;

  #ifdef USE_COLOR
  vec3 getRGB() {
      vec3 rgb = color;
      return rgb;
  }
  #endif

  vec3 getElevation(){
    vec4 world = modelMatrix * vec4( position, 1.0 );
    float diff = abs(dot(rootNormal, (vec3(world) - rootCenter)));
    float w = max(diff - elevationRange.x,0.0) / max(elevationRange.y - elevationRange.x,1.0);
    vec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;

    return cElevation;
  }

  vec3 getIntensity(){
    // TODO: real contrast enhancement. Check https://github.com/yuki-koyama/enhancer/blob/master/shaders/enhancer.fs
    float intmod = pow(intensity, intensityContrast);
    vec3 cIntensity = texture2D(grayscale, vec2(intmod / maxIntensity ,1.0-(intmod / maxIntensity))).rgb;
    return cIntensity;
  }

  vec3 getClassification(){
    float classNormalized = classification / 255.0;
    vec3 cClassification = texture2D(gradient, vec2(classNormalized * 5.0,1.0-classNormalized * 5.0)).rgb;
    return cClassification;
  }

  vec3 getColor(){
      vec3 color;
      if (hideGround && classification == 2.0) {
         return vec3(0.0, 0.0, 0.0);               
      }

      if (coloring == 1) {
        color = getIntensity();
      }
      else if (coloring == 2) {
        color = getClassification();
      } else if (coloring == 3) {
        color = getElevation();
      } 
      #ifdef USE_COLOR
      else if (coloring == 4) {
        color = getRGB();
      }
      #endif
      else {
        color = vec3(1.0, 1.0, 1.0);
      }
      return color;
  }

  void main() {
      vColor = getColor();

      gl_PointSize = pointSize;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }
`;var Mi=(e=>(e[e.Intensity=1]="Intensity",e[e.Classification=2]="Classification",e[e.Elevation=3]="Elevation",e[e.RGB=4]="RGB",e[e.White=5]="White",e))(Mi||{}),dn=(e=>(e[e.FlatTexture=1]="FlatTexture",e[e.ShadedTexture=2]="ShadedTexture",e[e.ShadedNoTexture=3]="ShadedNoTexture",e))(dn||{}),vt=(e=>(e[e.Reset=1]="Reset",e[e.Mercator=2]="Mercator",e[e.WGS84Cartesian=3]="WGS84Cartesian",e))(vt||{});const qC=bu.RAINBOW,XC=typeof document<"u"?yu(qC):null,QC=bu.GRAYSCALE,YC=typeof document<"u"?yu(QC):null,ZC={throttleRequests:!0,maxRequests:64,updateInterval:.1,maxConcurrency:1,maximumScreenSpaceError:16,memoryAdjustedScreenSpaceError:!0,maximumMemoryUsage:400,memoryCacheOverflow:128,viewDistanceScale:1,skipLevelOfDetail:!1,updateTransforms:!0,shading:dn.FlatTexture,transparent:!1,pointCloudColoring:Mi.White,pointSize:1,worker:!0,wireframe:!1,debug:!1,gltfLoader:null,basisTranscoderPath:null,dracoDecoderPath:null,material:null,computeNormals:!1,shaderCallback:null,geoTransform:vt.Reset,preloadTilesCount:null};class tb{static async load(t){const n={...ZC,...t.options},{url:s}=t,r=n.updateInterval,i=5,o={};if(n.cesiumIONToken){o["cesium-ion"]={accessToken:n.cesiumIONToken};const R=await xc.preload(s,o);o.fetch={headers:R.headers}}n.googleApiKey&&(o.fetch={headers:{"X-GOOG-API-KEY":n.googleApiKey}}),t.loadingManager&&t.loadingManager.itemStart(s);const a=await Ps(s,en,{...o}),c={},l={},u=[],h=new p.Group,f=new p.Group;n.debug||(f.visible=!1);const d={pointSize:{type:"f",value:n.pointSize},gradient:{type:"t",value:XC},grayscale:{type:"t",value:YC},rootCenter:{type:"vec3",value:new p.Vector3},rootNormal:{type:"vec3",value:new p.Vector3},coloring:{type:"i",value:n.pointCloudColoring},hideGround:{type:"b",value:!0},elevationRange:{type:"vec2",value:new p.Vector2(0,400)},maxIntensity:{type:"f",value:1},intensityContrast:{type:"f",value:1},alpha:{type:"f",value:1}},m=new p.ShaderMaterial({uniforms:d,vertexShader:KC,fragmentShader:zC,transparent:n.transparent,vertexColors:!0});let g=null,A=null,y,b,E;n.gltfLoader?y=n.gltfLoader:(y=new Fu.GLTFLoader,n.basisTranscoderPath&&(b=new Du.KTX2Loader,b.detectSupport(t.renderer),b.setTranscoderPath(n.basisTranscoderPath+"/"),b.setWorkerLimit(1),y.setKTX2Loader(b)),n.dracoDecoderPath&&(E=new Lu.DRACOLoader,E.setDecoderPath(n.dracoDecoderPath+"/"),E.setWorkerLimit(n.maxConcurrency),y.setDRACOLoader(E)));const C=new p.MeshBasicMaterial({transparent:n.transparent}),_={maximumMemoryUsage:n.maximumMemoryUsage,maximumScreenSpaceError:n.maximumScreenSpaceError,memoryAdjustedScreenSpaceError:n.memoryAdjustedScreenSpaceError,memoryCacheOverflow:n.memoryCacheOverflow,viewDistanceScale:n.viewDistanceScale,skipLevelOfDetail:n.skipLevelOfDetail,updateTransforms:n.updateTransforms,throttleRequests:n.throttleRequests,maxRequests:n.maxRequests,contentLoader:async R=>{let P=null;switch(R.type){case pi.POINTCLOUD:{P=nb(R,m,n,Ht);break}case pi.SCENEGRAPH:case pi.MESH:{P=await eb(y,R,C,n,Ht);break}}if(P&&(P.visible=!1,c[R.id]=P,h.add(c[R.id]),n.debug)){const K=Tu(R);f.add(K),l[R.id]=K}},onTileLoad:async R=>{B&&(n.geoTransform==vt.Reset&&!x&&(R==null?void 0:R.depth)<=i&&zt(R),B._frameNumber++,ee(B,c,A,g))},onTileUnload:R=>{u.push(R)},onTileError:(R,P)=>{console.error("Tile error",R.id,P)}},B=new $C(a,{..._,loadOptions:{...o,maxConcurrency:n.maxConcurrency,worker:n.worker,gltf:{loadImages:!1},"3d-tiles":{loadGLTF:!1}}}),F=new p.Matrix4,v=new p.Matrix4,O=new p.Vector3;let x=!1;if(B.root.boundingVolume?(B.root.header.boundingVolume.region&&(console.warn("Cannot apply a model matrix to bounding volumes of type region. Tileset stays in original geo-coordinates."),n.geoTransform=vt.WGS84Cartesian),v.setPosition(B.root.boundingVolume.center[0],B.root.boundingVolume.center[1],B.root.boundingVolume.center[2])):console.warn("Bounding volume not found, no transformations applied"),n.debug){const R=Tu(B.root);f.add(R),l[B.root.id]=R}let D=!1,N=!1;d.rootCenter.value.copy(O),d.rootNormal.value.copy(new p.Vector3(0,0,1).normalize()),B.stats.get("Loader concurrency").count=n.maxConcurrency,B.stats.get("Maximum mem usage").count=n.maximumMemoryUsage;let G=0,S=null,j=null;const me=new p.Vector3(1/0,1/0,1/0);let jt=null;h.updateMatrixWorld(!0);const gt=new p.Matrix4().copy(h.matrixWorld),Ht=new p.Matrix4().copy(gt).invert();if((n.geoTransform==vt.Reset||n.geoTransform==vt.Mercator)&&(zt(B.root),ge()),n.debug&&(l[B.root.id].applyMatrix4(F),f.matrixWorld.copy(h.matrixWorld)),n.geoTransform==vt.Mercator){const R=WC(B.cartographicCenter[1],B.cartographicCenter[0]);O.set(R.x,0,-R.y),h.position.copy(O),h.updateMatrixWorld(!0)}else n.geoTransform==vt.WGS84Cartesian&&(h.applyMatrix4(v),h.updateMatrixWorld(!0),O.copy(h.position));function zt(R){if(!R.boundingVolume.halfAxes)return;const P=R.boundingVolume.halfAxes,K=new p.Matrix4().extractRotation(Eu(P)).premultiply(new p.Matrix4().extractRotation(Ht));if(!new p.Euler().setFromRotationMatrix(K).equals(new p.Euler)){x=!0;const Ft=new p.Vector3(v.elements[12],v.elements[13],v.elements[14]);v.extractRotation(K),v.setPosition(Ft),ge()}}function ge(){F.copy(v).invert(),F.premultiply(gt),F.copy(gt).multiply(new p.Matrix4().copy(v).invert()),B.modelMatrix=new pt(F.toArray())}function ee(R,P,K,st){if(D)return;(!jt||st.aspect!=j)&&(jt=new Pn({fov:st.fov/180*Math.PI,aspectRatio:st.aspect,near:st.near,far:st.far}).sseDenominator,j=st.aspect,n.debug&&console.log("Updated sse denonimator:",jt));const Ms=Bu(st).planes.map(Q=>new Lt(Q.normal.toArray(),Q.constant)),sb=new $e(Ms),_u=new p.Vector2;K.getSize(_u);const Mu={camera:{position:me.toArray()},height:_u.y,frameNumber:R._frameNumber,sseDenominator:jt,cullingVolume:sb,viewport:{id:0}};R._cache.reset(),R._traverser.traverse(R.root,Mu,R.options);for(const Q of R.tiles)Q.selected?P[Q.id]?P[Q.id].visible=!0:console.error("TILE SELECTED BUT NOT LOADED!!",Q.id):P[Q.id]&&(P[Q.id].visible=!1);for(;u.length>0;){const Q=u.pop();P[Q.id]&&Q.contentState==lt.UNLOADED&&(h.remove(P[Q.id]),Ri(P[Q.id]),delete P[Q.id]),l[Q.id]&&(Ri(l[Q.id]),f.remove(l[Q.id]),delete l[Q.id])}const Si=R.stats.get("Tiles Loaded").count,Ru=R.stats.get("Tiles Loading").count;return t.onProgress&&t.onProgress(Si,Si+Ru),t.loadingManager&&!N&&Ru==0&&(n.preloadTilesCount==null||Si>=n.preloadTilesCount)&&(N=!0,t.loadingManager.itemEnd(t.url)),Mu}return{model:h,runtime:{getTileset:()=>B,getStats:()=>B.stats,showTiles:R=>{f.visible=R},setWireframe:R=>{n.wireframe=R,h.traverse(P=>{P instanceof p.Mesh&&(P.material.wireframe=R)})},setDebug:R=>{n.debug=R,f.visible=R},setShading:R=>{n.shading=R},getTileBoxes:()=>f,setViewDistanceScale:R=>{B.options.viewDistanceScale=R,B._frameNumber++,ee(B,c,A,g)},setHideGround:R=>{d.hideGround.value=R},setPointCloudColoring:R=>{d.coloring.value=R},setElevationRange:R=>{d.elevationRange.value.set(R[0],R[1])},setMaxIntensity:R=>{d.maxIntensity.value=R},setIntensityContrast:R=>{d.intensityContrast.value=R},setPointAlpha:R=>{d.alpha.value=R},getLatLongHeightFromPosition:R=>{const P=B.ellipsoid.cartesianToCartographic(new p.Vector3().copy(R).applyMatrix4(new p.Matrix4().copy(F).invert()).toArray());return{lat:P[1],long:P[0],height:P[2]}},getPositionFromLatLongHeight:R=>{const P=B.ellipsoid.cartographicToCartesian([ks(R.long),ks(R.lat),R.height]);return new p.Vector3(...P).applyMatrix4(F)},orientToGeocoord:R=>{const P=[R.long,R.lat,R.height],K=B.ellipsoid.cartographicToCartesian(P),st=new p.Matrix4().fromArray(B.ellipsoid.eastNorthUpToFixedFrame(K)),Ft=new p.Matrix4().makeRotationFromEuler(new p.Euler(Math.PI/2,Math.PI/2,0)),Ms=new p.Matrix4().copy(st).multiply(Ft).invert();B.modelMatrix=new pt(Ms.toArray()),h.applyMatrix4(Ms),h.updateMatrixWorld(!0)},getCameraFrustum:R=>{const K=Bu(R).planes.map(Ft=>new Lt(Ft.normal.toArray(),Ft.constant)).map(Ft=>JC(Ft)),st=new p.Group;for(const Ft of K)st.add(Ft);return st},update:function(R,P,K){if(g=K,A=P,G+=R,B&&G>=r){if(!gt.equals(h.matrixWorld)){G=0,gt.copy(h.matrixWorld),(n.geoTransform==vt.Reset||n.geoTransform==vt.Mercator)&&ge();const st=new p.Vector3().setFromMatrixPosition(gt);d.rootCenter.value.copy(st),d.rootNormal.value.copy(new p.Vector3(0,0,1).applyMatrix4(gt).normalize()),Ht.copy(gt).invert(),n.debug&&(l[B.root.id].matrixWorld.copy(F),l[B.root.id].applyMatrix4(gt))}S==null?S=new p.Matrix4().copy(K.matrixWorld):(!K.matrixWorld.equals(S)||K.aspect!=j)&&(G=0,B._frameNumber++,K.getWorldPosition(me),S.copy(K.matrixWorld),ee(B,c,P,K))}},dispose:function(){for(D=!0,B._destroy();h.children.length>0;){const R=h.children[0];Ri(R),h.remove(R)}for(;f.children.length>0;){const R=f.children[0];f.remove(R),R.geometry.dispose(),R.material.dispose()}b&&b.dispose(),E&&E.dispose()}}}}}async function eb(e,t,n,s,r){return new Promise((i,o)=>{const a=new p.Matrix4().makeRotationAxis(new p.Vector3(1,0,0),Math.PI/2),c=t.content.gltfUpAxis!=="Z",l=new p.Matrix4().fromArray(t.computedTransform).premultiply(r);c&&l.multiply(a),t.content.byteLength||(t.content.byteLength=t.content.gltfArrayBuffer.byteLength),e.parse(t.content.gltfArrayBuffer,t.contentUrl?t.contentUrl.substr(0,t.contentUrl.lastIndexOf("/")+1):"",u=>{const h=u.scenes[0];h.applyMatrix4(l),t.content.texturesByteLength=0,t.content.geometriesByteLength=0,h.traverse(f=>{if(f.type=="Mesh"){const d=f;t.content.geometriesByteLength+=Cu(d.geometry);const m=d.material,g=m.map,A=jC(g);A&&(t.content.texturesByteLength+=A),s.material?(d.material=s.material.clone(),m.dispose()):s.shading==dn.FlatTexture&&(d.material=n.clone(),m.dispose()),s.shading!=dn.ShadedNoTexture?d.material.type=="ShaderMaterial"?d.material.uniforms.map={value:g}:d.material.map=g:(g&&g.dispose(),d.material.map=null),s.shaderCallback&&(d.onBeforeRender=(y,b,E,C,_,B)=>{s.shaderCallback(y,_)}),d.material.wireframe=s.wireframe,s.computeNormals&&d.geometry.computeVertexNormals()}}),t.content.gpuMemoryUsageInBytes=t.content.texturesByteLength+t.content.geometriesByteLength,i(h)},u=>{o(new Error(`error parsing gltf in tile ${t.id}: ${u}`))})})}function nb(e,t,n,s){const r={rtc_center:e.content.rtcCenter,points:e.content.attributes.positions,intensities:e.content.attributes.intensity,classifications:e.content.attributes.classification,rgb:null,rgba:null},{colors:i}=e.content.attributes;i&&i.size===3&&(r.rgb=i.value),i&&i.size===4&&(r.rgba=i.value);const o=new p.BufferGeometry;o.setAttribute("position",new p.Float32BufferAttribute(r.points,3));const a=new p.Matrix4().fromArray(e.computedTransform).premultiply(s);r.rgba?o.setAttribute("color",new p.Float32BufferAttribute(r.rgba,4)):r.rgb&&o.setAttribute("color",new p.Uint8BufferAttribute(r.rgb,3,!0)),r.intensities&&o.setAttribute("intensity",new p.BufferAttribute(r.intensities,1,!0)),r.classifications&&o.setAttribute("classification",new p.Uint8BufferAttribute(r.classifications,1,!1)),e.content.geometriesByteLength=Cu(o),e.content.gpuMemoryUsageInBytes=e.content.geometriesByteLength;const c=new p.Points(o,n.material||t);if(r.rtc_center){const l=r.rtc_center;a.multiply(new p.Matrix4().makeTranslation(l[0],l[1],l[2]))}return c.applyMatrix4(a),c}function wu(e){var t,n,s,r;(t=e==null?void 0:e.uniforms)!=null&&t.map?(s=(n=e==null?void 0:e.uniforms)==null?void 0:n.map.value)==null||s.dispose():e.map&&((r=e.map)==null||r.dispose()),e.dispose()}function Ri(e){e.traverse(t=>{if(t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)wu(t.material);else for(const n of t.material)wu(n)});for(let t=e.children.length-1;t>=0;t--){const n=e.children[t];e.remove(n)}}ut.GeoTransform=vt,ut.Loader3DTiles=tb,ut.PointCloudColoring=Mi,ut.Shading=dn,Object.defineProperty(ut,Symbol.toStringTag,{value:"Module"})});
